---
title: Azure SQL Database를 사용하여 전역 사용 가능 서비스 디자인 | Microsoft Docs
description: Azure SQL Database를 사용하여 항상 사용 가능한 서비스를 위한 애플리케이션 디자인에 대해 알아봅니다.
keywords: 클라우드 재해 복구, 재해 복구 솔루션, 앱 데이터 백업, 지역에서 복제, 무중단 업무 방식 계획
services: sql-database
ms.service: sql-database
ms.subservice: development
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: anosov1960
ms.author: sashan
ms.reviewer: carlrab
manager: craigg
ms.date: 12/04/2018
ms.openlocfilehash: 46232afcaf9504d4cfbd80160e2d7e7ea958d600
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61488189"
---
# <a name="designing-globally-available-services-using-azure-sql-database"></a>Azure SQL Database를 사용하여 전역적으로 사용 가능 서비스 디자인

Azure SQL Database에서 클라우드 서비스를 빌드하고 배포하는 경우 [활성 지역 복제](sql-database-active-geo-replication.md) 또는 [자동 장애 조치(Failover) 그룹](sql-database-auto-failover-group.md)을 사용하여 지역 오류 및 심각한 서비스 중단에 대한 복원 기능을 제공합니다. 동일한 기능을 사용하여 데이터에 로컬로 액세스하도록 최적화된 전역 분산 애플리케이션을 만들 수 있습니다. 이 문서에서는 일반적인 애플리케이션 패턴에 초점을 맞추고 각 옵션의 이점 및 장단점을 설명합니다.

> [!NOTE]
> 프리미엄 또는 중요 비즈니스용 데이터베이스 및 탄력적 풀을 사용하는 경우, 영역 중복 배포 구성으로 변환하여 지역 중단 시 탄력적으로 복원할 수 있습니다. [영역 중복 데이터베이스](sql-database-high-availability.md)를 참조하세요.  

## <a name="scenario-1-using-two-azure-regions-for-business-continuity-with-minimal-downtime"></a>시나리오 1: 두 Azure 지역을 사용하여 가동 중지 시간을 최소화하고 비즈니스 연속성 유지

이 시나리오에서는 애플리케이션에 다음과 같은 특징이 있습니다.

* 애플리케이션이 한 Azure 지역에서 활성
* 모든 데이터베이스 세션에서 데이터에 대한 읽기 및 쓰기 액세스(RW) 필요
* 대기 시간 및 트래픽 비용을 줄이도록 웹 계층 및 데이터 계층 배치
* 근본적으로 가동 중단 시간은 데이터 손실보다 이러한 애플리케이션에 더 높은 비즈니스 위험이 있음

이 경우 애플리케이션 배포 토폴로지는 모든 애플리케이션 구성 요소가 하나의 단위로 장애 조치해야 할 때 지역 재해를 처리하기 위해 최적화됩니다. 아래 다이어그램은 이 토폴로지를 보여줍니다. 지리적 중복 구성을 위해 애플리케이션의 리소스는 A와 B 지역에 배포되어 있습니다. 그러나 지역 B의 리소스는 지역 A가 실패할 때까지 사용되지 않습니다. 데이터베이스 연결, 복제 및 장애 조치를 관리하기 위해 두 지역 간에 장애 조치 그룹이 구성됩니다. 두 지역의 웹 서비스는 읽기-쓰기 수신기 **&lt;failover-group-name&gt;.database.windows.net**(1)을 통해 데이터베이스에 액세스하도록 구성되었습니다. 트래픽 관리자는 [우선 순위 라우팅 메서드](../traffic-manager/traffic-manager-configure-priority-routing-method.md)를 사용하도록 설정됩니다(2).  

> [!NOTE]
> [Azure Traffic Manager](../traffic-manager/traffic-manager-overview.md)는 이 문서 전체에서 설명을 위한 용도로만 사용됩니다. 우선 순위 라우팅 메서드를 지원하는 모든 부하 분산 솔루션을 사용할 수 있습니다.

다음 다이어그램은 작동 중단 전의 이 구성을 보여 줍니다.

![시나리오 1. 중단 전 구성.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario1-a.png)

주 지역에서 가동 중단된 후 SQL Database 서비스는 주 데이터베이스에 액세스할 수 없음을 검색하여 자동 장애 조치 정책(1)의 매개 변수를 기반으로 하여 보조 지역으로 장애 조치를 트리거합니다. 애플리케이션 SLA에 따라 가동 중단 감지와 장애 조치 자체 사이의 시간을 구성할 수 있습니다. 장애 조치 그룹이 데이터베이스 장애 조치를 트리거하기 전에 트래픽 관리자가 엔드포인트 장애 조치를 시작할 수 있습니다. 이 경우 웹 애플리케이션은 즉시 데이터베이스에 다시 연결할 수 없습니다. 그러나 데이터베이스 장애 조치가 완료되는 즉시 자동으로 다시 연결합니다. 실패 지역이 복원되고 온라인으로 돌아오면 기존의 기본 항목이 자동으로 새로운 보조로 연결됩니다. 아래 다이어그램은 장애 조치 후의 구성을 나타냅니다.

> [!NOTE]
> 장애 조치 후 커밋된 모든 트랜잭션은 재연결 중 손실됩니다. 장애 조치 완료 후 지역 B의 애플리케이션을 다시 연결하고 사용자 요청 처리를 다시 시작할 수 있습니다. 웹 애플리케이션과 주 데이터베이스 모두 이제 지역 B이며 배치된 상태로 유지됩니다.

![시나리오 1. 장애 조치 후 구성](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario1-b.png)

영역 B에서 중단이 발생할 경우 주 및 보조 데이터베이스 간 복제 프로세스가 일시 중지되나 둘 사이의 연결은 그대로 유지됩니다(1). 트래픽 관리자가 지역 B와의 연결이 끊어졌음을 탐지하고 엔드포인트 웹 앱 2를 성능 저하(2)로 표시합니다. 이 경우 애플리케이션 성능에는 영향이 없으나 데이터베이스가 노출되므로, 이후 지역 A도 실패한다면 데이터 손실 위험이 더 높아집니다.

> [!NOTE]
> 재해 복구의 경우 애플리케이션 배포를 두 지역으로 제한하여 구성하는 것이 좋습니다. 대부분의 경우 Azure 지역이 두 개뿐이기 때문입니다. 이 구성은 두 영역에서 동시에 발생하는 치명적인 오류로부터 애플리케이션을 보호하지 않습니다. 이러한 발생 가능성이 없는 실패 시 [지리적 복원 작업](sql-database-disaster-recovery.md#recover-using-geo-restore)을 사용하여 세 번째 지역에서 데이터베이스를 복구할 수 있습니다.
>

 작동 중단이 완화되면 보조 데이터베이스가 주 데이터베이스와 자동으로 다시 동기화됩니다. 동기화 중에는 주 데이터베이스의 성능에 영향이 있을 수 있습니다. 특정한 영향은 장애 조치 후 새로운 주 데이터베이스가 확보하게 되는 데이터의 크기에 따라 결정됩니다. 다음 다이어그램은 보조 지역의 작동 중단을 보여 줍니다.

![시나리오 1. 보조 지역에서 중단 후 구성](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario1-c.png)

이 설계 패턴의 주요 **장점** 은 다음과 같습니다.

* 동일한 웹 애플리케이션은 모든 지역 관련 구성 및 장애 조치 관리를 위한 추가 논리가 없이 두 지역 모두에 배포됩니다.
* 웹 애플리케이션과 데이터베이스가 항상 동일한 위치에 배치되므로 애플리케이션의 성능은 장애 조치의 영향을 받지 않습니다.

지역 B의 애플리케이션 리소스가 대부분의 시간 동안 덜 사용되는 것이 **적정 수준**입니다.

## <a name="scenario-2-azure-regions-for-business-continuity-with-maximum-data-preservation"></a>시나리오 2: 최고 수준의 데이터 보존과 비즈니스 연속을 위한 Azure 지역

이 옵션은 다음 특성을 가진 애플리케이션에 가장 적합합니다.

* 어떤 경우든 데이터 손실은 비즈니스에 큰 위험이 됩니다. 치명적인 실패에 의한 가동 중단의 경우 데이터베이스 장애 조치는 최후의 수단으로만 사용할 수 있습니다.
* 애플리케이션에서 작업의 읽기 전용 및 읽기-쓰기 모드를 지원하며, 일정 기간 동안 "읽기 전용 모드"에서 작동할 수 있습니다.

이 패턴에서 읽기-쓰기 연결에 대한 시간 제한 오류가 발생하기 시작하면 애플리케이션이 읽기 전용 모드로 전환됩니다. 웹 애플리케이션은 두 지역 모두에 배포되며, 읽기-쓰기 수신기 엔드포인트에 대한 연결과 읽기 전용 수신기 엔드포인트에 대한 다른 연결을 포함합니다(1). 트래픽 관리자 프로필은 [우선 순위 라우팅](../traffic-manager/traffic-manager-configure-priority-routing-method.md)을 사용해야 합니다. 각 지역의 애플리케이션 엔드포인트에 대해 [엔드포인트 모니터링](../traffic-manager/traffic-manager-monitoring.md)을 활성화해야 합니다(2).

다음 다이어그램은 작동 중단 전의 이 구성을 보여 줍니다.

![시나리오 2. 중단 전 구성.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario2-a.png)

트래픽 관리자에서 지역 A에 대한 연결 장애를 검색하면 사용자 트래픽을 지역 B의 애플리케이션 인스턴스로 자동 전환합니다. 이 패턴을 사용하면 데이터 손실이 있는 유예 기간을 충분히 높은 값(예: 24시간)으로 설정하는 것이 중요합니다. 이 시간 내에 가동 중단이 완화되면 데이터 손실이 방지됩니다. 지역 B의 웹 애플리케이션이 활성화되면 읽기-쓰기 작업이 실패하기 시작합니다. 이 시점에서 읽기 전용 모드로 전환해야 합니다(1). 이 모드에서는 요청이 자동으로 보조 데이터베이스로 라우팅됩니다. 치명적인 오류로 중단된 경우 대개는 유예 기간 동안 완화될 수 없습니다. 만료되면 장애 조치 그룹이 장애 조치를 트리거합니다. 이후 읽기-쓰기 수신기를 사용할 수 있게 되고 이 수신기에 대한 연결 실패가 중지됩니다(2). 다음 다이어그램에서는 복구 과정의 두 단계를 보여 줍니다.

> [!NOTE]
> 주 지역의 가동 중단이 유예 기간 내에 완화되면 트래픽 관리자에서 주 지역의 연결 복원을 검색하고 사용자 트래픽을 지역 A의 애플리케이션 인스턴스로 다시 전환합니다. 이전 다이어그램에서 본 것처럼 해당 애플리케이션 인스턴스는 지역 A의 주 데이터베이스를 사용하여 읽기-쓰기 모드에서 다시 시작되어 작동합니다.

![시나리오 2. 재해 복구 단계](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario2-b.png)

지역 B에서 중단이 발생한 경우 트래픽 관리자가 지역 B의 끝점 웹 앱 2 실패를 탐지하고 성능 저하되었다고 표시합니다(1). 그 동안 장애 조치 그룹이 읽기 전용 수신기를 지역 A로 전환합니다(2). 이 중단은 최종 사용자 환경에 영향을 미치지 않으나 중단 기간 중 주 데이터베이스가 노출됩니다. 다음 다이어그램은 보조 지역에서의 실패를 보여 줍니다.

![시나리오 2. 보조 지역의 중단](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario2-c.png)

가동 중단이 완화되면 보조 데이터베이스는 즉시 주 데이터베이스와 동기화되고, 읽기 전용 수신기는 지역 B의 보조 데이터베이스로 다시 전환됩니다. 동기화하는 동안 동기화해야 하는 데이터의 양에 따라 주 데이터베이스의 동기화 성능에 약간 영향을 줄 수 있습니다.

이 디자인 패턴에는 다음과 같은 여러 **장점**이 있습니다.

* 임시 작동 중단 동안 데이터 손실 방지
* 가동 중지 시간은 트래픽 관리자가 구성 가능한 연결 실패를 얼마나 빨리 감지하는지에 따라 달라짐

애플리케이션은 읽기 전용 모드에서 작동할 수 있어야 하는 것이 **적정 수준**입니다.

## <a name="scenario-3-application-relocation-to-a-different-geography-without-data-loss-and-near-zero-downtime"></a>시나리오 3: 데이터 손실이 없으면서 가동 중지 시간이 거의 없이 다른 지역에 애플리케이션 재배치

이 시나리오에서는 애플리케이션에 다음과 같은 특징이 있습니다.

* 최종 사용자가 서로 다른 지역에서 애플리케이션에 액세스
* 애플리케이션에 최신 업데이트가 적용된 전체 동기화의 영향을 받지 않는 읽기 전용 워크로드가 있음
* 대부분의 사용자에 대해 동일 지역에서 데이터에 대한 쓰기 액세스를 지원해야 함
* 최종 사용자 환경에 읽기 대기 시간 중요

이러한 요구 사항에 부합하기 위해, 사용자 디바이스가 **항상** 데이터 탐색, 분석 등 읽기 전용 작업을 위해 동일한 지역에 배포된 애플리케이션에 연결해야 합니다. 반면 OLTP 작업은 **대부분** 동일한 지역에서 처리됩니다. 예를 들어 일과 중에는 OLTP 작업이 동일한 지역에서 처리되지만 업무 시간 외에는 다른 지역에서 처리될 수 있습니다. 최종 사용자 작업이 대부분 일과 시간 중에 일어난다면 대부분의 시간 동안 대부분의 사용자에게 최적 성능을 보장할 수 있습니다. 다음 다이어그램은 이 토폴로지를 보여 줍니다.

애플리케이션의 리소스는 사용 요청이 많은 각 지역에 배포되어야 합니다. 예를 들어 애플리케이션이 미국, 유럽 및 동남아에서 활발히 사용된다면 이 지역 모두에 애플리케이션을 배포해야 합니다. 업무 시간이 끝나면 주 데이터베이스가 한 지역에서 다음 지역으로 동적으로 전환됩니다. 이 방법을 "해바라기"라고 합니다. OLTP 워크로드는 항상 읽기-쓰기 수신기 **&lt;failover-group-name&gt;.database.windows.net**를 통해 데이터베이스에 연결합니다(1). 읽기 전용 워크로드는 데이터베이스 서버 엔드포인트 **&lt;server-name&gt;.database.windows.net**를 통해 직접 로컬 데이터베이스에 연결합니다(2). 트래픽 관리자에는 [성능 라우팅 메서드](../traffic-manager/traffic-manager-configure-performance-routing-method.md)가 구성되어 있습니다. 이를 통해 최종 사용자 디바이스는 가장 가까운 지역의 웹 서비스에 연결됩니다. 각각의 웹 서비스와 끝점에 대해 끝점 모니터링이 활성화된 상태로 트래픽 관리자가 설정되어야 합니다(3).

> [!NOTE]
> 장애 조치 그룹 구성은 장애 조치에 사용할 지역을 정의합니다. 새로운 주 항목이 다른 지역에 있으므로 해당 지역이 다시 온라인이 되기 전까지는 장애 조치로 인해 OLTP와 읽기 전용 워크로드에 대한 대기 시간이 더 길어집니다.

![시나리오 3. 미국 동부에서 기본으로 구성 ](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario3-a.png)

일과를 마치면(예: 현지 시간 밤 11시) 활성 데이터베이스가 다음 지역으로 전환됩니다(북유럽). 이 작업은 [Azure 예약 서비스](../scheduler/scheduler-intro.md)로 완전히 자동화할 수 있습니다.  이 작업에는 다음 단계가 필요합니다.

* 익숙한 장애 조치를 사용하여 장애 조치 그룹의 주 서버를 북유럽으로 전환(1)
* 미 동부 및 북유럽 사이의 장애 조치 그룹 제거
* 이름이 같은 북유럽과 동아시아 간 새 장애 조치 그룹 만들기(2)
* 북유럽의 주 및 동아시아의 보조를 이 장애 조치 그룹에 추가(3)

다음 다이어그램은 계획된 장애 조치 후의 새 구성을 보여 줍니다.

![시나리오 3. 주를 북유럽으로 전환](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario3-b.png)

예를 들어 가동 중단이 북유럽에서 발생한 경우 장애 조치 그룹에서 자동 데이터베이스 장애 조치를 시작하며 이를 통해 효과적으로 일정에 앞서 애플리케이션을 다음 지역으로 이동할 수 있습니다(1).  이 경우 미국 동부는 북유럽이 온라인이 되기 전까지 유일하게 남은 보조 지역이 됩니다. 나머지 두 지역은 역할 전환을 통해 세 지역 모두의 고객을 서비스합니다. Azure Scheduler를 그에 맞게 조절해야 합니다. 나머지 지역이 유럽의 사용자 트래픽을 추가적으로 받게 되므로 애플리케이션 성능에 영향이 있습니다. 대기 시간이 추가될 뿐 아니라 최종 사용자의 연결 수도 증대합니다. 북유럽에서의 작동 중단이 완화되면 보조 데이터베이스가 현재의 주 데이터베이스와 즉시 동기화됩니다. 다음 다이어그램에서는 북유럽에서의 가동 중단을 보여 줍니다.

![시나리오 3. 북유럽에서의 가동 중단](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario3-c.png)

> [!NOTE]
> 대기 시간이 길어져 유럽 지역 최종 사용자 환경이 저하되면 시간을 줄일 수 있습니다. 이를 위해 북유럽의 오프라인 애플리케이션 인스턴스 대체 항목으로 애플리케이션 사본을 미리 배포하여 다른 로컬 지역(서유럽)에 보조 데이터베이스를 만들어야 합니다. 북유럽이 온라인으로 돌아오면 서유럽을 계속 사용할지 또는 해당 애플리케이션 사본을 제거하고 다시 북유럽으로 전환할지 판단할 수 있습니다.

이 설계의 주요 **장점** 은 다음과 같습니다.

* 읽기 전용 애플리케이션 워크로드가 항상 가장 가까운 지역의 데이터에 액세스합니다.
* 읽기-쓰기 애플리케이션 워크로드가 각 지역에서 가장 활발한 시간 동안 가장 가까운 지역의 데이터에 액세스합니다.
* 애플리케이션이 여러 지역에 배포되므로 중대한 중단 시간 없이 지역 중 한 곳의 손실을 감당할 수 있게 됩니다.

하지만 몇 가지 **장단점**이 있습니다.

* 대기 시간이 길어지므로 국지적 작동 중단이 지역에 영향을 미칩니다. 읽기-쓰기 및 읽기 전용 워크로드 모두 다른 지역의 애플리케이션에서 서비스합니다.
* 읽기 전용 워크로드는 각 지역의 다른 끝점에 연결해야 합니다.

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a>비즈니스 연속성 계획: 클라우드 재해 복구에 대한 애플리케이션 디자인 선택

특정 클라우드 재해 복구 전략은 애플리케이션의 요구 사항을 최상으로 충족하도록 이러한 디자인 패턴을 결합하거나 확장할 수 있습니다.  앞에서 설명한 대로 선택한 전략은 고객 및 애플리케이션 배포 토폴로지에 제공하려는 SLA에 따라 달라집니다. 결정에 도움을 주기 위해 다음 테이블에서는 복구 지점 목표(RPO) 및 예상 복구 시간(ERT)에 따라 선택 항목을 비교합니다.

| 패턴 | RPO | ERT |
|:--- |:--- |:--- |
| 배치된 데이터베이스 액세스로 재해 복구에 대한 활성-수동 배포 |읽기-쓰기 액세스 < 5초 |장애 감지 시간 + DNS TTL |
| 애플리케이션 부하 분산에 대한 활성-활성 배포 |읽기-쓰기 액세스 < 5초 |장애 감지 시간 + DNS TTL |
| 데이터 보존에 대한 활성-수동 배포 |읽기 전용 액세스 < 5초 | 읽기 전용 액세스 = 0 |
||읽기-쓰기 액세스 = 0 | 읽기-쓰기 액세스 = 장애 감지 시간 + 데이터 손실이 있는 유예 기간 |
|||

## <a name="next-steps"></a>다음 단계

* 비즈니스 연속성의 개요 및 시나리오를 보려면 [비즈니스 연속성 개요](sql-database-business-continuity.md)
* 활성 지역 복제에 대한 자세한 내용은 [활성 지역 복제](sql-database-active-geo-replication.md)를 참조하세요.
* 자동 장애 조치(failover) 그룹에 대해 알아보려면 [자동 장애 조치(failover) 그룹](sql-database-auto-failover-group.md)을 참조하세요.
* 탄력적 풀의 활성 지역 복제에 대한 자세한 내용은 [탄력적 풀 재해 복구 전략](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md)을 참조하세요.
