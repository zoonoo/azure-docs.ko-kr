---
title: Azure IoT Hub 장치 프로 비전 서비스의 다시 구축 장치
description: DPS (장치 프로 비전 서비스) 인스턴스로 장치를 다시 구축 하는 방법 및이 작업을 수행 해야 하는 이유를 알아봅니다.
author: wesmc7777
ms.author: wesmc
ms.date: 04/04/2019
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
ms.openlocfilehash: 0ded494debab19daa15a953715b1ab7b0b10ad18
ms.sourcegitcommit: 5ab4f7a81d04a58f235071240718dfae3f1b370b
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 12/10/2019
ms.locfileid: "74974907"
---
# <a name="how-to-reprovision-devices"></a>장치를 다시 구축 하는 방법

IoT 솔루션의 수명 주기 동안 IoT hub 간에 장치를 이동 하는 것이 일반적입니다. 이러한 이동에 대 한 이유는 다음과 같은 경우에 발생할 수 있습니다.

* **지리적**위치: 장치 간에 이동할 때 장치를 각 위치에 가까운 IoT hub로 마이그레이션하기 때문에 네트워크 대기 시간이 향상 됩니다.

* **다중 테 넌 트**: 동일한 IoT 솔루션 내에서 장치를 사용 하 고 새 고객 또는 고객 사이트에 다시 할당 또는 임대할 수 있습니다. 이 새 고객은 다른 IoT hub를 사용 하 여 서비스 될 수 있습니다.

* **솔루션 변경**: 장치를 새 IoT 솔루션 또는 업데이트 된 IoT 솔루션으로 이동할 수 있습니다. 이렇게 재할당 하려면 장치가 다른 백 엔드 구성 요소에 연결 된 새 IoT hub와 통신 해야 할 수 있습니다. 

* **격리**: 솔루션 변경과 유사 합니다. 제대로 작동 하지 않거나, 손상 되었거나, 최신 상태가 아닌 장치를 IoT hub에 다시 할당할 수 있습니다 .이 경우 모든 it가 업데이트 되 고 준수 상태가 됩니다. 장치가 정상적으로 작동 하면 해당 장치가 기본 허브로 다시 마이그레이션됩니다.

다시 프로 비전에 대 한 보다 자세한 개요는 [장치 다시 프로 비전 개념 IoT Hub](concepts-device-reprovision.md)을 참조 하세요.


## <a name="configure-the-enrollment-allocation-policy"></a>등록 할당 정책 구성

할당 정책은 등록에 연결 된 장치를 다시 프로 비전 한 후 IoT hub에 할당 또는 할당 하는 방법을 결정 합니다.

다음 단계는 장치 등록에 대 한 할당 정책을 구성 합니다.

1. [Azure Portal](https://portal.azure.com) 에 로그인 하 고 장치 프로 비전 서비스 인스턴스로 이동 합니다.

2. **등록 관리**를 클릭 하 고 다시 프로 비전에 대해 구성할 등록 그룹 또는 개별 등록을 클릭 합니다. 

3. **허브에 장치를 할당 하는 방법 선택**에서 다음 할당 정책 중 하나를 선택 합니다.

    * **가장 낮은 대기 시간**:이 정책은 장치를 연결 된 IoT Hub에 할당 하 여 장치와 IoT Hub 간에 대기 시간이 가장 저렴 한 통신을 발생 하 게 합니다. 이 옵션을 사용 하면 장치에서 위치에 따라 가장 가까운 IoT hub와 통신할 수 있습니다. 
    
    * **균등 가중치 배포**:이 정책은 연결 된 각 iot hub에 할당 된 할당 가중치에 따라 연결 된 iot hub에 장치를 배포 합니다. 이 정책을 사용 하면 해당 허브에 설정 된 할당 가중치에 따라 연결 된 허브 그룹에서 장치를 부하 분산할 수 있습니다. 장치를 하나의 IoT Hub에만 프로 비전 하는 경우이 설정을 권장 합니다. Ez az alapértelmezett beállítás. 
    
    * **정적 구성**:이 정책에는 프로 비전 할 장치에 대 한 등록 항목에 필요한 IoT Hub 표시 되어야 합니다. 이 정책을 사용 하면 장치를 할당 하려는 단일 특정 IoT hub를 지정할 수 있습니다.

4. **이 그룹을 할당할 수 있는 iot Hub 선택**에서 할당 정책에 포함할 연결 된 iot hub를 선택 합니다. 필요에 따라 **새 IoT Hub 링크** 단추를 사용 하 여 연결 된 새 Iot hub를 추가 합니다.

    **가장 낮은 대기 시간** 할당 정책을 사용 하는 경우 선택 하는 허브는 장치 할당에 가장 가까운 허브를 결정 하는 대기 시간 평가에 포함 됩니다.

    균일 하 **게 가중치가** 적용 된 배포 할당 정책을 사용 하면 구성 된 할당 가중치 및 현재 장치 부하를 기반으로 선택한 허브에서 장치 부하가 분산 됩니다.

    **정적 구성** 할당 정책을 사용 하 여 장치를 할당 하려는 IoT hub를 선택 합니다.

4. **저장**을 클릭 하거나 다음 섹션으로 이동 하 여 다시 프로 비전 정책을 설정 합니다.

    ![등록 할당 정책 선택](./media/how-to-reprovision/enrollment-allocation-policy.png)



## <a name="set-the-reprovisioning-policy"></a>다시 프로 비전 정책 설정

1. [Azure Portal](https://portal.azure.com) 에 로그인 하 고 장치 프로 비전 서비스 인스턴스로 이동 합니다.

2. **등록 관리**를 클릭 하 고 다시 프로 비전에 대해 구성할 등록 그룹 또는 개별 등록을 클릭 합니다.

3. **다른 IoT hub에 다시 프로 비전 할 때 장치 데이터를 처리 하는 방법 선택**에서 다음 다시 프로 비전 정책 중 하나를 선택 합니다.

    * **데이터 다시 프로 비전 및 마이그레이션**:이 정책은 등록 항목과 연결 된 장치가 새 프로 비전 요청을 제출할 때 작업을 수행 합니다. 등록 항목 구성에 따라 장치가 다른 IoT hub에 다시 할당 될 수 있습니다. 장치에서 IoT hub를 변경 하는 경우 초기 IoT hub를 사용 하 여 장치 등록이 제거 됩니다. 해당 초기 IoT hub의 모든 장치 상태 정보는 새 IoT hub로 마이그레이션됩니다. 마이그레이션하는 동안 장치 상태가 **할당** 중으로 보고 됩니다.

    * **다시 프로 비전 하 고 초기 구성으로 다시 설정**:이 정책은 등록 항목과 연결 된 장치가 새 프로 비전 요청을 제출할 때 작업을 수행 합니다. 등록 항목 구성에 따라 장치가 다른 IoT hub에 다시 할당 될 수 있습니다. 장치에서 IoT hub를 변경 하는 경우 초기 IoT hub를 사용 하 여 장치 등록이 제거 됩니다. 장치가 프로 비전 될 때 제공 된 프로 비전 서비스 인스턴스가 수신 하는 초기 구성 데이터가 새 IoT hub에 제공 됩니다. 마이그레이션하는 동안 장치의 상태는 **할당**중으로 보고 됩니다.

4. **저장** 을 클릭 하 여 변경 내용에 따라 장치의 다시 프로 비전를 사용 하도록 설정 합니다.

    ![등록 할당 정책 선택](./media/how-to-reprovision/reprovisioning-policy.png)



## <a name="send-a-provisioning-request-from-the-device"></a>장치에서 프로 비전 요청 보내기

이전 섹션에서 변경한 구성 변경 내용에 따라 장치를 다시 프로 비전 하려면 이러한 장치에서 다시 프로 비전를 요청 해야 합니다. 

장치에서 프로 비전 요청을 제출 하는 빈도는 시나리오에 따라 달라 집니다. 그러나 재부팅 시 프로 비전 서비스 인스턴스로 프로 비전 요청을 보내도록 장치를 프로그래밍 하 고 요청 시 프로 비전을 수동으로 트리거하는 [방법을](../iot-hub/iot-hub-devguide-direct-methods.md) 지원 하는 것이 좋습니다. [Desired 속성](../iot-hub/iot-hub-devguide-device-twins.md#desired-property-example)을 설정 하 여 프로 비전을 트리거할 수도 있습니다. 

등록 항목에 대 한 다시 프로 비전 정책은 장치 프로 비전 서비스 인스턴스가 이러한 프로 비전 요청을 처리 하는 방법 및 다시 프로 비전 중에 장치 상태 데이터를 마이그레이션해야 하는지 여부를 결정 합니다. 개별 등록 및 등록 그룹에 대해 동일한 정책을 사용할 수 있습니다.

부팅 시퀀스 중 장치에서 프로 비전 요청을 보내는 예제 코드는 [시뮬레이션 된 장치 자동 프로 비전](quick-create-simulated-device.md)을 참조 하세요.


## <a name="next-steps"></a>Következő lépések

- 다시 프로 비전에 대 한 자세한 내용은 [IoT Hub Device 다시 프로 비전 개념](concepts-device-reprovision.md) 을 참조 하세요. 
- 프로 비전 해제에 대 한 자세한 내용은 [이전에 자동 프로 비전 된 장치의 프로 비전](how-to-unprovision-devices.md) 을 해제 하는 방법 











