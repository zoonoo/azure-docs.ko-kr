---
title: Azure IoT Hub Device Provisioning Service의 보안 개념 | Microsoft Docs
description: Device Provisioning Service 및 IoT Hub를 사용하는 디바이스에 해당하는 보안 프로비전 개념 설명
author: nberdy
ms.author: nberdy
ms.date: 04/04/2019
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: briz
ms.openlocfilehash: e35330874c647eba2cddde694563c8a1d9e83df5
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/23/2019
ms.locfileid: "60775120"
---
# <a name="iot-hub-device-provisioning-service-security-concepts"></a>IoT Hub Device Provisioning Service 보안 개념 

IoT Hub Device Provisioning Service는 지정된 IoT 허브에 대한 제로 터치 디바이스 프로비저닝을 구성하도록 사용하는 IoT Hub에 대한 도우미 서비스입니다. Device Provisioning 서비스를 사용하여 안전하고 확장 가능한 방식으로 수백만 개의 디바이스를 [자동 프로비전](concepts-auto-provisioning.md)할 수 있습니다. 이 문서는 디바이스 프로비저닝과 관련된 *보안* 개념의 개요를 제공합니다. 이 문서는 배포를 위한 디바이스 준비에 관련된 모든 사람에게 적합합니다.

## <a name="attestation-mechanism"></a>증명 메커니즘

증명 메커니즘은 디바이스의 ID 확인에 사용되는 방법입니다. 증명 메커니즘은 지정된 디바이스로 사용할 증명 방법을 프로비전 서비스에 알려 주는 등록 목록과 관련되어 있기도 합니다.

> [!NOTE]
> IoT Hub는 해당 서비스에서 비슷한 개념에 대해 "인증 체계"를 사용합니다.

Device Provisioning Service는 다음과 같은 형식의 증명을 지원합니다.
* 표준 X.509 인증서 인증 흐름을 기반으로 하는 **X.509 인증서**
* nonce 문제를 기반으로 하는 **TPM(신뢰할 수 있는 플랫폼 모듈)** 은 서명된 SAS(공유 액세스 서명) 토큰을 표시하기 위해 키에 TPM 표준을 사용합니다. 이 증명 형식을 사용하는 경우 디바이스에 실제 TPM이 필요하지는 않지만, [TPM 사양](https://trustedcomputinggroup.org/work-groups/trusted-platform-module/)에 따라 인증 키를 사용하여 증명을 해야 합니다.
* 해시된 서명과 포함된 만료 날짜가 들어 있는 SAS(공유 액세스 서명) [보안 토큰](../iot-hub/iot-hub-devguide-security.md#security-tokens)을 기반으로 하는 **대칭 키**. 자세한 내용은 [대칭 키 증명](concepts-symmetric-key-attestation.md)을 참조하세요.


## <a name="hardware-security-module"></a>하드웨어 보안 모듈

하드웨어 보안 모듈 또는 HSM은 안전한 디바이스 비밀의 하드웨어 기반 저장소를 위해 사용되며 가장 안전한 형태의 비밀 저장소입니다. X.509 인증서 및 SAS 토큰은 HSM에 저장될 수 있습니다. HSM은 증명 메커니즘 및 프로비전 지원에 사용될 수 있습니다.

> [!TIP]
> 디바이스에 비밀을 안전하게 저장하는 데 디바이스와 함께 HSM을 사용하는 것이 좋습니다.

디바이스 비밀은 소프트웨어(메모리)에도 저장될 수 있지만 HSM보다 덜 안전한 형태의 저장소입니다.

## <a name="trusted-platform-module"></a>신뢰할 수 있는 플랫폼 모듈

TPM은 플랫폼을 인증하는 데 사용되는 키를 안전하게 저장하기 위한 표준을 참조할 수 있거나 표준을 구현하는 모듈과 상호 작용하는 데 사용되는 I/O 인터페이스를 참조할 수 있습니다. TPM은 별도 하드웨어, 통합된 하드웨어, 펌웨어 기반 또는 소프트웨어 기반으로 존재할 수 있습니다. [TPM 및 TPM 증명](/windows-server/identity/ad-ds/manage/component-updates/tpm-key-attestation)에 대해 자세히 알아봅니다. Device Provisioning Service는 TPM 2.0만 지원합니다.

TPM 증명은 인증 및 저장소 루트 키를 사용하여 서명된 SAS(공유 액세스 서명) 토큰을 제공하는 nonce 챌린지를 기준으로 진행됩니다.

### <a name="endorsement-key"></a>인증 키

인증 키는 내부적으로 생성되거나 제조 시간에 삽입된 TPM 내부에 포함된 비대칭 키이며, 모든 TPM에서 고유합니다. 인증 키를 변경하거나 제거할 수 없습니다. 인증 키의 비공개 부분 TPM 외부로 공개되지 않는 반면 인증 키의 공개 부분은 정품 TPM을 인식하는 데 사용됩니다. [인증 키](https://technet.microsoft.com/library/cc770443(v=ws.11).aspx)에 대해 자세히 알아봅니다.

### <a name="storage-root-key"></a>저장소 루트 키

스토리지 루트 키는 TPM에 저장되고 이러한 키를 TPM 없이 사용할 수 없도록 애플리케이션에 의해 생성된 TPM 키를 보호하는 데 사용됩니다. 저장소 루트 키는 TPM의 소유권을 가져올 때 생성됩니다. 새 사용자가 소유권을 가져올 수 있도록 TPM을 삭제하는 경우 새 저장소 루트 키가 생성됩니다. [저장소 루트 키](https://technet.microsoft.com/library/cc753560(v=ws.11).aspx)에 대해 자세히 알아봅니다.

## <a name="x509-certificates"></a>X.509 인증서

X.509 인증서를 증명 메커니즘으로 사용하면 프로덕션의 크기를 조정하고 디바이스 프로비전을 간소화할 수 있습니다. X.509 인증서는 일반적으로 체인의 각 인증서가 다음으로 높고, 그 다음으로 높은 등등의 우선 순위에 있는 인증서의 개인 키로 서명되는 신뢰의 인증서 체인에 정렬되며, 자체 서명된 루트 인증서에서 종료됩니다. 이 방식을 사용하는 경우 신뢰할 수 있는 루트 CA(인증 기관)에서 생성한 루트 인증서에서 각각의 중간 CA를 거쳐 디바이스에 설치된 최종 엔터티 “리프” 인증서로의 위임된 신뢰 체인이 설정됩니다. 자세한 내용은 [X.509 CA 인증서를 사용하여 디바이스 인증](/azure/iot-hub/iot-hub-x509ca-overview)을 참조하세요. 

인증서 체인은 종종 디바이스와 관련된 논리적 또는 물리적 계층 일부를 나타냅니다. 예를 들어, 제조업체는 다음과 같은 작업을 수행할 수 있습니다.
- 자체 서명된 루트 CA 인증서 발급
- 루트 인증서를 사용하여 각 공장에 대한 고유한 중간 CA 인증서 생성
- 각 공장 인증서를 사용하여 공장의 각 생산 라인에 대한 고유한 중간 CA 인증서 생성
- 마지막으로 생산 라인 인증서를 사용하여 해당 라인에서 제조된 각 디바이스에 대해 고유한 디바이스(최종 엔터티) 인증서 생성 

자세한 내용은 [IoT 업계의 X.509 CA 인증서에 대한 개념적 이해](/azure/iot-hub/iot-hub-x509ca-concept)를 참조하세요. 

### <a name="root-certificate"></a>루트 인증서

루트 인증서는 CA(인증 기관)를 나타내는 자체 서명된 X.509 인증서입니다. 인증서 체인의 종점 또는 트러스트 앵커입니다. 루트 인증서는 조직에서 자체적으로 발급하거나 루트 인증 기관에서 구입할 수 있습니다. 자세한 내용은 [X.509 CA 인증서 얻기](/azure/iot-hub/iot-hub-security-x509-get-started#get-x509-ca-certificates)를 참조하세요. 또한 루트 인증서는 루트 CA 인증서라고도 합니다.

### <a name="intermediate-certificate"></a>중간 인증서

중간 인증서는 루트 인증서(또는 해당 체인에 루트 인증서가 있는 다른 중간 인증서)에서 서명한 X.509 인증서입니다. 체인의 마지막 중간 인증서는 리프 인증서에 서명하는 데 사용됩니다. 또한 중간 인증서는 중간 CA 인증서라고도 합니다.

### <a name="end-entity-leaf-certificate"></a>최종 엔터티 “리프” 인증서

리프 인증서 또는 최종 엔터티 인증서는 인증서 보유자를 식별합니다. 인증서 체인에는 루트 인증서와 0개 이상의 중간 인증서가 있습니다. 리프 인증서는 다른 인증서에 서명하는 데 사용되지 않습니다. 디바이스를 프로비전 서비스에 고유하게 식별하며, 때로는 디바이스 인증서라고도 합니다. 인증하는 동안 디바이스는 이 인증서와 관련된 개인 키를 사용하여 서비스의 소유 챌린지 증명에 응답합니다.

리프 인증서 사용을 [개별 등록](./concepts-service.md#individual-enrollment) 항목 요구 사항이는 **주체 이름** 개별 등록 항목의 등록 ID로 설정 되어야 합니다. 리프 인증서를 사용는 [등록 그룹](./concepts-service.md#enrollment-group) 항목이 있어야 합니다 **주체 이름** 에 표시 됩니다는 원하는 장치 ID로 설정 합니다 **등록 레코드** 에 대 한 등록 그룹의 인증 된 장치입니다.

자세한 내용은 [X.509 CA 인증서로 서명된 디바이스 인증](/azure/iot-hub/iot-hub-x509ca-overview#authenticating-devices-signed-with-x509-ca-certificates)을 참조하세요.

## <a name="controlling-device-access-to-the-provisioning-service-with-x509-certificates"></a>X.509 인증서를 사용하여 프로비전 서비스에 대한 디바이스 액세스 제어

프로비전 서비스는 X.509 증명 메커니즘을 사용하는 디바이스에 대한 액세스를 제어하는 데 사용할 수 있는 두 가지 유형의 등록 항목을 공개합니다.  

- [개별 등록](./concepts-service.md#individual-enrollment) 항목은 특정 디바이스와 연결된 디바이스 인증서로 구성됩니다. 이러한 항목은 특정 디바이스에 대한 등록을 제어합니다.
- [등록 그룹](./concepts-service.md#enrollment-group) 항목은 특정 중간 또는 루트 CA 인증서와 연결됩니다. 이러한 항목은 인증서 체인에 해당 중간 또는 루트 인증서가 있는 모든 디바이스에 대한 등록을 제어합니다. 

디바이스가 프로비전 서비스에 연결되면 이 서비스에서 덜 구체적인 등록 항목보다 높은 우선 순위를 더 구체적인 등록 항목에 지정합니다. 즉 디바이스에 대한 개별 등록이 있으면 프로비전 서비스에서 해당 항목을 적용합니다. 디바이스에 대한 개별 등록이 없고 디바이스의 인증서 체인에 있는 첫 번째 중간 인증서에 대한 등록 그룹이 있으면, 서비스에서 체인의 해당 항목, 그 다음 우선 순위의 항목 등등으로 적용하면서 루트까지 연결합니다. 이 서비스는 적용 가능한 첫 번째 항목을 다음과 같이 적용합니다.

- 발견된 첫 번째 등록 항목을 사용할 수 있으면 서비스에서 해당 디바이스를 프로비전합니다.
- 발견된 첫 번째 등록 항목을 사용할 수 없으면 서비스에서 해당 디바이스를 프로비전하지 않습니다.  
- 디바이스의 인증서 체인에 있는 인증서에 대한 등록 항목이 없으면 서비스에서 해당 디바이스를 프로비전하지 않습니다. 

이 메커니즘과 인증서 체인의 계층 구조는 개별 디바이스 및 디바이스 그룹에 대한 액세스를 제어하는 방법에 강력한 유연성을 제공합니다. 예를 들어 다음과 같은 인증서 체인이 있는 5개의 디바이스를 가정합니다. 

- *디바이스 1*: 루트 인증서 -&gt; 인증서 A -&gt; 디바이스 1 인증서
- *디바이스 2*: 루트 인증서 -&gt; 인증서 A -&gt; 디바이스 2 인증서
- *디바이스 3*: 루트 인증서 -&gt; 인증서 A -&gt; 디바이스 3 인증서
- *디바이스 4*: 루트 인증서 -&gt; 인증서 B -&gt; 디바이스 4 인증서
- *디바이스 5*: 루트 인증서 -&gt; 인증서 B -&gt; 디바이스 5 인증서

처음에는 루트 인증서에 대해 사용할 수 있는 단일 그룹 등록 항목을 만들어 5개 디바이스 모두에 대한 액세스를 사용하도록 설정할 수 있습니다. 나중에 인증서 B가 손상되는 경우 *디바이스 4* 및 *디바이스 5*가 등록되지 않도록 인증서 B에 대해 사용할 수 없는 등록 그룹 항목을 만들 수 있습니다. 나중에 *디바이스 3*이 여전히 손상되는 경우 해당 인증서에 대해 사용할 수 없는 개별 등록 항목을 만들 수 있습니다. 이렇게 하면 *디바이스 3*에 대한 액세스가 취소되지만, *디바이스 1* 및 *디바이스 2*는 등록할 수 있습니다.