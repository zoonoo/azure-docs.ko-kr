---
title: Azure VM 백업 정보
description: Azure VM 백업에 대해 알아보고 몇 가지 모범 사례를 확인합니다.
author: rayne-wiselman
manager: carmonm
ms.service: backup
ms.topic: conceptual
ms.date: 03/04/2019
ms.author: raynew
ms.openlocfilehash: bf6aa07319b8029744a5c8898a4104d330fbb1d1
ms.sourcegitcommit: c72ddb56b5657b2adeb3c4608c3d4c56e3421f2c
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/24/2019
ms.locfileid: "68465224"
---
# <a name="about-azure-vm-backup"></a>Azure VM 백업 정보

이 문서에서는 [Azure Backup 서비스](backup-introduction-to-azure-backup.md) 에서 Azure vm (가상 머신)을 백업 하는 방법을 설명 합니다.

## <a name="backup-process"></a>백업 프로세스

다음은 Azure Backup Azure Vm에 대 한 백업을 완료 하는 방법입니다.

1. 백업용으로 선택 된 Azure Vm의 경우 지정한 백업 일정에 따라 백업 작업이 시작 Azure Backup.
1. 첫 번째 백업 중에 VM이 실행 되는 경우 백업 확장이 VM에 설치 됩니다.
    - Windows Vm의 경우 _VMSnapshot_ 확장을 설치 합니다.
    - Linux Vm의 경우 _VMSnapshotLinux_ 확장이 설치 됩니다.
1. 를 실행 하는 Windows Vm의 경우 VSS (Windows 볼륨 섀도 복사본 서비스)를 사용 하 여 백업 하 여 VM의 앱 일치 스냅숏을 사용 합니다.
    - 기본적으로 백업은 전체 VSS 백업을 수행 합니다.
    - 백업이 응용 프로그램에 일관 된 스냅숏을 만들 수 없는 경우 VM이 중지 된 동안에는 응용 프로그램 쓰기가 발생 하지 않기 때문에 기본 저장소의 파일 일치 스냅숏을 사용 합니다.
1. Linux Vm의 경우 백업은 파일 일치 백업을 수행 합니다. 앱 일치 스냅숏의 경우 사전/사후 스크립트를 수동으로 사용자 지정 해야 합니다.
1. 백업은 스냅숏을 만든 후 데이터를 자격 증명 모음으로 전송 합니다.
    - 백업은 각 VM 디스크를 병렬로 백업 하 여 최적화 됩니다.
    - Azure Backup 백업 되는 각 디스크에 대해 디스크의 블록을 읽고 이전 백업 이후에 변경 된 데이터 블록만 식별 하 여 전송 합니다 (델타).
    - 스냅샷 데이터가 자격 증명 모음에 즉시 복사되지 않을 수 있습니다. 사용량이 많은 시간에는 몇 시간이 걸릴 수 있습니다. 일별 백업 정책에서 VM의 총 백업 시간은 24 시간 미만입니다.
 1. Azure Backup 후에 Windows VM에 대 한 변경 내용은 다음과 같습니다.
    -   Microsoft Visual C++ 2013 재배포 가능 패키지 (x64)-12.0.40660가 VM에 설치 됩니다.
    -   VSS (볼륨 섀도 복사본 서비스)의 시작 유형이 수동에서 자동으로 변경 됨
    -   Iaasvmprovider 서비스가 Windows 서비스가 추가 되었습니다.

1. 데이터 전송이 완료 되 면 스냅숏이 제거 되 고 복구 지점이 생성 됩니다.

![Azure 가상 머신 백업 아키텍처](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

## <a name="encryption-of-azure-vm-backups"></a>Azure VM 백업 암호화

Azure Backup을 사용하여 Azure VM을 백업하면 미사용 상태의 VM이 SSE(스토리지 서비스 암호화)를 사용하여 암호화됩니다. Azure Backup Azure Disk Encryption를 사용 하 여 암호화 된 Azure Vm을 백업할 수도 있습니다.

**암호화** | **세부 정보** | **지원**
--- | --- | ---
**Azure 디스크 암호화** | Azure Disk Encryption은 Azure Vm의 OS 및 데이터 디스크를 모두 암호화 합니다.<br/><br/> Azure Disk Encryption는 키 자격 증명 모음에 비밀으로 보호는 BEKs (BitLocker 암호화 키)와 통합 됩니다. Azure Disk Encryption은 KEKs (Azure Key Vault 키 암호화 키)와도 통합 됩니다. | Azure Backup는 BEKs 전용으로 암호화 된 관리 되는 Azure Vm 또는 KEKs와 함께 BEKs를 사용 하 여 암호화 된 Azure Vm의 백업을 지원 합니다.<br/><br/> BEKs와 KEKs는 모두 백업 및 암호화 됩니다.<br/><br/> KEKs 및 BEKs가 백업 되기 때문에 필요한 권한이 있는 사용자는 필요한 경우 키와 암호를 키 자격 증명 모음으로 다시 복원할 수 있습니다. 이러한 사용자는 암호화 된 VM을 복구할 수도 있습니다.<br/><br/> 암호화 된 키와 암호는 권한이 없는 사용자 또는 Azure에서 읽을 수 없습니다.
**SSE** | SSE를 사용 Azure Storage는 데이터를 저장 하기 전에 데이터를 자동으로 암호화 하 여 미사용 암호화를 제공 합니다. 또한 데이터를 검색 하기 전에 암호를 해독 Azure Storage 합니다. | Azure Backup은 Azure Vm의 미사용 암호화에 SSE를 사용 합니다.

관리 및 관리 되지 않는 Azure Vm의 경우 Backup은 BEKs로 암호화 된 Vm 또는 KEKs와 함께 BEKs로 암호화 된 Vm을 모두 지원 합니다.

백업 된 BEKs (비밀) 및 KEKs (키)는 암호화 됩니다. 권한 있는 사용자가 키 자격 증명 모음으로 다시 복원 하는 경우에만 읽고 사용할 수 있습니다. 권한 없는 사용자와 Azure 모두 백업 키 또는 비밀을 읽거나 사용할 수 없습니다.

BEKs도 백업 됩니다. 따라서 BEKs가 손실 되 면 권한 있는 사용자가 키 자격 증명 모음에 BEKs를 복원 하 고 암호화 된 Vm을 복구할 수 있습니다. 필요한 사용 권한 수준의 사용자만 암호화 된 Vm 또는 키와 암호를 백업 하 고 복원할 수 있습니다.

## <a name="snapshot-creation"></a>스냅샷 만들기

Azure Backup는 백업 일정에 따라 스냅숏을 생성 합니다.

- **Windows Vm:** Windows Vm의 경우 Backup 서비스는 VSS와 조정 하 여 VM 디스크의 앱 일치 스냅숏을 만듭니다.

  - 기본적으로 Azure Backup은 전체 VSS 백업을 만듭니다. [자세히 알아보기](https://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx).
  - Azure Backup VSS 복사 백업을 사용 하도록 설정을 변경 하려면 명령 프롬프트에서 다음 레지스트리 키를 설정 합니다.

    **REG ADD "HKLM\SOFTWARE\Microsoft\BcdrAgent" /v USEVSSCOPYBACKUP /t REG_SZ /d TRUE /f**

- **Linux Vm:** Linux Vm의 앱 일치 스냅숏을 사용 하려면 Linux 사전 스크립트 및 사후 스크립트 프레임 워크를 사용 하 여 일관성을 유지 하기 위해 고유한 사용자 지정 스크립트를 작성 합니다.

  - Azure Backup는 사용자가 작성 한 사전/사후 스크립트만 호출 합니다.
  - 사전 스크립트 및 사후 스크립트가 성공적으로 실행 되는 경우 Azure Backup 복구 지점을 응용 프로그램에 일관 된 것으로 표시 합니다. 그러나 사용자 지정 스크립트를 사용 하는 경우 궁극적으로 응용 프로그램 일관성을 담당 하 게 됩니다.
  - 스크립트를 구성 하는 방법에 [대해 자세히 알아보세요](backup-azure-linux-app-consistent.md) .

### <a name="snapshot-consistency"></a>스냅샷 일관성

다음 표에서는 다양 한 유형의 스냅숏 일관성에 대해 설명 합니다.

**스냅숏** | **세부 정보** | **복구** | **고려 사항**
--- | --- | --- | ---
**애플리케이션 일관성** | 앱 일관성이 있는 백업은 메모리 콘텐츠 및 보류 중인 I/O 작업을 캡처합니다. 앱 일치 스냅숏은 VSS 기록기 (또는 Linux 용 사전/사후 스크립트)를 사용 하 여 백업이 발생 하기 전에 앱 데이터의 일관성을 유지 합니다. | 앱 일치 스냅숏을 사용 하 여 VM을 복구 하는 경우 VM이 부팅 됩니다. 데이터 손상 또는 손실이 없습니다. 앱이 일관성 있는 상태로 시작됩니다. | Windows: 모든 VSS 기록기가 성공함<br/><br/> Linux: 사전/사후 스크립트가 구성 및 성공함
**파일 시스템 일치** | 파일 시스템 일치 백업은 모든 파일의 스냅숏을 동시에 가져와서 일관성을 제공 합니다.<br/><br/> | 파일 시스템 일치 스냅숏을 사용 하 여 VM을 복구 하는 경우 VM이 부팅 됩니다. 데이터 손상 또는 손실이 없습니다. 앱은 자체 “수정” 메커니즘을 구현하여 복원된 데이터가 일관성 있는지 확인해야 합니다. | Windows: 일부 VSS 기록기가 실패함 <br/><br/> Linux: 기본값 (사전/사후 스크립트가 구성 되지 않았거나 실패 한 경우)
**크래시 일관성** | 크래시 일관성 스냅숏은 일반적으로 백업 시 Azure VM이 종료 되는 경우에 발생 합니다. 백업 시 디스크에 이미 존재하는 데이터만 캡처 및 백업됩니다.<br/><br/> 크래시 일관성이 있는 복구 지점은 운영 체제 또는 앱의 데이터 일관성을 보장하지 않습니다. | 보장은 없지만 VM은 일반적으로 부팅 된 다음 디스크 검사를 시작 하 여 손상 오류를 수정 합니다. 크래시 전에 디스크로 전송 되지 않은 모든 메모리 내 데이터 또는 쓰기 작업은 손실 됩니다. 앱이 고유한 데이터 확인을 구현합니다. 예를 들어 데이터베이스 앱은 확인을 위해 트랜잭션 로그를 사용할 수 있습니다. 트랜잭션 로그에 데이터베이스에 없는 항목이 있는 경우 데이터베이스 소프트웨어는 데이터가 일치 될 때까지 트랜잭션을 롤백합니다. | VM이 종료 상태

## <a name="backup-and-restore-considerations"></a>백업 및 복원 고려 사항

**고려 사항** | **세부 정보**
--- | ---
**디스크** | VM 디스크의 백업이 동시에 진행 됩니다. 예를 들어 VM에 4 개의 디스크가 있는 경우 Backup 서비스는 4 개의 디스크를 모두 병렬로 백업 하려고 시도 합니다. 백업은 증분 방식입니다(변경된 데이터만 백업).
**일정 계획** |  백업 트래픽을 줄이려면 하루 중 다른 시간에 다른 Vm을 백업 하 고 시간이 겹치지 않도록 해야 합니다. VM을 동시에 백업하면 트래픽 정체가 발생합니다.
**백업 준비** | 백업을 준비 하는 데 필요한 시간을 염두에 두십시오. 준비 시간에는 백업 확장을 설치 또는 업데이트 하 고 백업 일정에 따라 스냅숏을 트리거하는 작업이 포함 됩니다.
**데이터 전송** | Azure Backup에서 이전 백업의 증분 변경 내용을 식별 하는 데 필요한 시간을 고려 합니다.<br/><br/> 증분 백업에서 Azure Backup는 블록의 체크섬을 계산 하 여 변경 내용을 확인 합니다. 블록을 변경 하는 경우 자격 증명 모음으로 전송 하도록 표시 됩니다. 서비스는 식별 된 블록을 분석 하 여 전송할 데이터의 양을 더 최소화 하려고 합니다. 변경 된 모든 블록을 평가한 후에는 Azure Backup 자격 증명 모음에 변경 내용을 전송 합니다.<br/><br/> 스냅샷을 생성하는 시간과 자격 증명 모음으로 복사하는 시간 사이에 지연이 있을 수 있습니다.<br/><br/> 사용량이 많은 시간에는 백업이 처리 되는 데 최대 8 시간이 걸릴 수 있습니다. VM에 대한 백업 시간은 일별 백업의 경우 24시간 미만입니다.
**초기 백업**: | 증분 백업의 총 백업 시간은 24 시간 미만 이지만 첫 번째 백업에는 그렇지 않을 수 있습니다. 초기 백업에 필요한 시간은 데이터의 크기 및 백업이 처리 되는 시기에 따라 달라 집니다.
**복원 큐** | Azure Backup는 여러 저장소 계정의 복원 작업을 동시에 처리 하 고, 복원 요청을 큐에 넣습니다.
**복원 복사** | 복원 프로세스 동안 데이터가 자격 증명 모음에서 스토리지 계정으로 복사됩니다.<br/><br/> 총 복원 시간은 IOPS (초당 I/o 작업 수) 및 저장소 계정의 처리량에 따라 달라 집니다.<br/><br/> 복사 시간을 단축하려면 다른 애플리케이션 쓰기 및 읽기로 로드되지 않은 저장소 계정을 선택합니다.

### <a name="backup-performance"></a>Backup 성능

이러한 일반적인 시나리오는 총 백업 시간에 영향을 줄 수 있습니다.

- **보호 된 Azure VM에 새 디스크 추가:** VM이 증분 백업을 진행 하 고 새 디스크를 추가 하는 경우 백업 시간이 늘어납니다. 기존 디스크의 델타 복제와 함께 새 디스크의 초기 복제로 인해 총 백업 시간이 24 시간 이상 지속 될 수 있습니다.
- **조각난 디스크:** 디스크 변경이 연속으로 수행 되는 경우 백업 작업이 더 빠릅니다. 변경 내용이 디스크 전체에 분산되고 조각화되면 백업이 더 느려집니다.
- **디스크 변동:** 증분 백업에 사용 되는 보호 된 디스크의 일일 변동 수가 200 GB 보다 많은 경우 백업을 완료 하는 데 시간이 오래 걸릴 수 있습니다 (8 시간 초과).
- **백업 버전:** 최신 버전의 백업 (인스턴트 복원 버전 이라고 함)에서는 변경 내용을 식별 하기 위한 체크섬 비교 보다 최적화 된 프로세스를 사용 합니다. 하지만 인스턴트 복원을 사용 중이 고 백업 스냅숏을 삭제 한 경우 백업은 체크섬 비교로 전환 됩니다. 이 경우 백업 작업은 24 시간 (또는 실패)을 초과 합니다.

## <a name="best-practices"></a>모범 사례

VM 백업을 구성 하는 경우 다음 방법을 따르는 것이 좋습니다.

- 정책에 설정 된 기본 일정 시간을 수정 합니다. 예를 들어 정책의 기본 시간이 12:00 AM 인 경우 리소스가 최적으로 사용 되도록 몇 분 간격으로 시간을 증가 시킵니다.
- Premium storage를 사용 하는 Vm 백업의 경우 최신 버전의 Azure Backup ([즉시 복원](backup-instant-restore-capability.md))을 실행 하는 것이 좋습니다. 최신 버전을 실행 하지 않는 경우 백업은 총 저장소 공간의 50%를 기준으로 할당 됩니다. 백업 서비스는 동일한 저장소 계정에 스냅숏을 복사 하 고 자격 증명 모음으로 전송 하기 위해이 공간이 필요 합니다.
- 단일 자격 증명 모음에서 Vm을 복원 하는 경우에는 다른 [범용 v2 저장소 계정을](https://docs.microsoft.com/azure/storage/common/storage-account-upgrade) 사용 하 여 대상 저장소 계정이 제한 되지 않도록 하는 것이 좋습니다. 예를 들어 각 VM에는 다른 저장소 계정이 있어야 합니다. 예를 들어 10 개의 Vm을 복원 하는 경우 10 개의 서로 다른 저장소 계정을 사용 합니다.
- 스냅숏이 동일한 저장소 계정에 있으므로 범용 v1 저장소 계층 (스냅숏)의 복원이 몇 분 안에 완료 됩니다. 범용 v2 저장소 계층 (자격 증명 모음)에서 복원은 몇 시간이 걸릴 수 있습니다. 범용 v1 저장소에서 데이터를 사용할 수 있는 경우 빠른 복원 기능을 사용 하 여 빠른 [복원](backup-instant-restore-capability.md) 기능을 사용 하는 것이 좋습니다. 자격 증명 모음에서 데이터를 복원 해야 하는 경우에는 더 많은 시간이 소요 됩니다.
- 저장소 계정 당 디스크 수 제한은 IaaS (infrastructure as a service) VM에서 실행 되는 응용 프로그램에서 디스크에 액세스 하는 정도를 기준으로 합니다. 일반적으로 단일 저장소 계정에 5-10 개의 디스크가 있는 경우 일부 디스크를 별도의 저장소 계정으로 이동 하 여 부하를 분산 합니다.

## <a name="backup-costs"></a>백업 비용

Azure Backup으로 백업된 Azure VM에는 [Azure Backup 가격 책정](https://azure.microsoft.com/pricing/details/backup/)이 적용됩니다.

첫 번째 성공적인 백업이 완료 될 때까지 청구는 시작 되지 않습니다. 이때 스토리지와 보호된 인스턴스 둘 다에 대한 요금 청구가 시작됩니다. VM에 대 한 백업 데이터가 자격 증명 모음에 저장 된 경우에는 요금이 계속 청구 됩니다. VM에 대한 보호를 중지하지만, 자격 증명 모음에 VM에 대한 백업 데이터가 있는 경우 요금은 계속 청구됩니다.

지정된 VM에 대한 요금 청구는 보호가 중지되고 모든 백업 데이터가 삭제된 경우에만 중단됩니다. 보호가 중지되고 활성 백업 작업이 없으면 마지막으로 성공한 VM 백업이 월별 청구에 사용되는 보호된 인스턴스 크기가 됩니다.

보호 된 인스턴스 크기 계산은 VM의 *실제* 크기를 기반으로 합니다. VM의 크기는 임시 저장소를 제외 하 고 VM에 있는 모든 데이터의 합계입니다. 가격은 VM에 연결 된 각 데이터 디스크에 대해 지원 되는 최대 크기가 아니라 데이터 디스크에 저장 된 실제 데이터를 기반으로 합니다.

마찬가지로, 백업 저장소 요금은 Azure Backup에 저장 된 데이터의 양을 기준으로 합니다. 즉, 각 복구 지점에 있는 실제 데이터의 합계입니다.

예를 들어 최대 크기가 각각 2TB 인 두 개의 추가 데이터 디스크가 있는 A2 표준 크기의 VM을 사용 합니다. 다음 표에서는 각 디스크에 저장 된 실제 데이터를 보여 줍니다.

**디스크** | **최대 크기** | **표시되는 실제 데이터**
--- | --- | ---
OS 디스크 | 4,095GB | 17GB
로컬/임시 디스크 | 135GB | 5GB(백업에 포함되지 않음)
데이터 디스크 1 | 4,095GB | 30GB
데이터 디스크 2 | 4,095GB | 0GB

이 경우 VM의 실제 크기는 17GB+30GB+0GB=47GB입니다. 이 보호 된 인스턴스 크기 (47 g b)는 월별 청구의 기반이 됩니다. VM의 데이터 양이 증가 함에 따라 청구 변경 내용이 일치 하는 데 사용 되는 보호 된 인스턴스 크기입니다.

## <a name="next-steps"></a>다음 단계

이제 [AZURE VM 백업을 준비](backup-azure-arm-vms-prepare.md)합니다.
