---
title: Azure Monitor 로그 배포 디자인 | Microsoft Docs
description: 이 문서에서는 Azure Monitor에서 작업 영역 배포를 준비하는 고객을 위한 고려 사항 및 권장 사항에 대해 설명합니다.
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 09/20/2019
ms.openlocfilehash: 8502c35a145e4a041f9d44b8396fe16f5db3febc
ms.sourcegitcommit: 77d7639e83c6d8eb6c2ce805b6130ff9c73e5d29
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/05/2021
ms.locfileid: "106384207"
---
# <a name="designing-your-azure-monitor-logs-deployment"></a>Azure Monitor 로그 배포 디자인

Azure Monitor는 Azure 리소스이며 데이터가 수집되고 집계되고 관리 경계 역할을 수행하는 컨테이너인 Log Analytics 작업 영역에 [로그](data-platform-logs.md) 데이터를 저장합니다. Azure 구독에서 하나 이상의 작업 영역을 배포할 수 있지만, 초기 배포에서 Microsoft 지침을 준수하여 조직의 요구 사항을 충족하는 비용 효율적이고 관리 가능하며 확장성 있는 배포를 제공하기 위해 알아야 하는 몇 가지 고려 사항이 있습니다.

작업 영역의 데이터는 테이블로 구성되며, 각 테이블에는 서로 다른 종류의 데이터가 저장되고 데이터를 생성하는 리소스를 기반으로 하는 고유한 속성 세트가 있습니다. 대부분의 데이터 원본은 Log Analytics 작업 영역에 있는 자체 테이블에 씁니다.

![작업 영역 데이터 모델의 예](./media/design-logs-deployment/logs-data-model-01.png)

Log Analytics 작업 영역이 제공하는 정보:

* 데이터 스토리지에 대한 지리적 위치
* 권장되는 디자인 전략 중 하나에 따라 다양한 사용자에게 액세스 권한을 부여하여 데이터 격리
* 설정 구성 범위(예: [가격 책정 계층](./manage-cost-storage.md#changing-pricing-tier), [보존](./manage-cost-storage.md#change-the-data-retention-period) 및 [데이터 최대 가용량 사용](./manage-cost-storage.md#manage-your-maximum-daily-data-volume))

작업 영역은 물리적 클러스터에서 호스팅됩니다. 시스템은 기본적으로 이러한 클러스터를 만들고 관리합니다. 하루에 4TB 넘게 수집하는 고객은 작업 영역을 위한 전용 클러스터를 만들어야 합니다. 이를 통해 고객은 더 효율적으로 제어하고 더 높은 수집 속도를 달성할 수 있습니다.

이 문서에서는 디자인 및 마이그레이션 고려 사항, 액세스 제어 개요, IT 조직에 권장되는 디자인 구현을 이해하는 방법에 대해 자세히 설명합니다.



## <a name="important-considerations-for-an-access-control-strategy"></a>액세스 제어 전략에 대한 중요한 고려 사항

필요한 작업 영역 수를 식별하는 것은 다음 요구 사항 중 하나 이상의 영향을 받습니다.

* 글로벌 회사이며 데이터 주권 또는 규정 준수 때문에 특정 지역에 저장된 로그 데이터가 필요합니다.
* Azure를 사용하고 있으며 작업 영역을 자신이 관리하는 Azure 리소스와 같은 지역에 두어서 아웃바운드 데이터 전송 요금을 피하려고 합니다.
* 여러 부서 또는 비즈니스 그룹을 관리하고, 각각 자체의 데이터를 표시하지만 다른 부서 또는 비즈니스 그룹의 데이터는 표시하지 않으려고 합니다. 또한 통합된 부서 간 보기 또는 비즈니스 그룹 보기에 대한 비즈니스 요구 사항은 없습니다.

오늘날의 IT 조직은 중앙 집중식 구조, 분산 구조 또는 두 구조의 중간형인 하이브리드 구조에 따라 모델링됩니다. 결과적으로 다음과 같은 작업 영역 배포 모델이 이러한 조직 구조 중 하나에 매핑하는 데 일반적으로 사용되었습니다.

* **중앙 집중식**: 모든 로그는 중앙 작업 영역에 저장되고, 단일 팀에서 관리하며, Azure Monitor는 팀별로 차별화된 액세스를 제공합니다. 이 시나리오에서는 로그를 관리하고, 리소스 간에 검색하고, 상호 연결하는 것이 쉽습니다. 작업 영역은 구독의 여러 리소스에서 수집된 데이터의 양에 따라 다른 사용자에 대한 액세스 제어를 유지하기 위한 추가 관리 오버헤드와 함께 크게 증가할 수 있습니다. 이 모델을 "허브 및 스포크"라고 합니다.
* **분산**: 각 팀에는 직접 소유하고 관리하는 리소스 그룹에 만든 자체의 작업 영역이 있으며, 로그 데이터는 리소스별로 분리됩니다. 이 시나리오에서는 작업 영역을 안전하게 유지할 수 있으며, 액세스 제어는 리소스 액세스와 일치하지만 로그를 상호 연결하는 것이 어렵습니다. 많은 리소스에 대한 광범위한 보기가 필요한 사용자는 데이터를 의미 있는 방식으로 분석할 수 없습니다.
* **하이브리드**: 많은 조직에서 두 배포 모델을 동시에 구현하므로 보안 감사 규정 준수 요구 사항은 이 시나리오를 더 복잡하게 만듭니다. 이로 인해 일반적으로 로그 범위에 차이가 있는 복잡하고, 비용이 많이 들며, 유지 관리하기가 어려운 구성으로 이어집니다.

Log Analytics 에이전트를 사용하여 데이터를 수집할 때 에이전트 배포를 계획하려면 다음 사항을 잘 알고 있어야 합니다.

* Windows 에이전트에서 데이터를 수집하기 위해 System Center Operations Manager 관리 그룹에 보고하는 동안에도 [하나 이상의 작업 영역에 보고하도록 각 에이전트를 구성](./../agents/agent-windows.md)할 수 있습니다. Windows 에이전트는 최대 4개의 작업 영역에 보고할 수 있습니다.
* Linux 에이전트는 멀티호밍을 지원하지 않으며 단일 작업 영역에만 보고할 수 있습니다.

System Center Operations Manager 2012 R2 이상을 사용하는 경우

* 각 Operations Manager 관리 그룹을 [하나의 작업 영역에만 연결](../agents/om-agents.md)할 수 있습니다. 
* 관리 그룹에 보고하는 Linux 컴퓨터는 Log Analytics 작업 영역에 직접 보고하도록 구성해야 합니다. Linux 컴퓨터가 이미 작업 영역에 직접 보고하고 있으며 Operations Manager로 모니터링하려는 경우 다음 단계에 따라 [Operations Manager 관리 그룹에 보고](../agents/agent-manage.md#configure-agent-to-report-to-an-operations-manager-management-group)하세요. 
* Windows 컴퓨터에 Log Analytics Windows 에이전트를 설치하고 작업 영역과 통합된 Operations Manager 및 다른 작업 영역 모두에 보고하도록 할 수 있습니다.

## <a name="access-control-overview"></a>액세스 제어 개요

Azure RBAC(Azure 역할 기반 액세스 제어)를 사용하면 작업 영역의 모니터링 데이터 작업에 필요한 액세스 권한만 사용자와 그룹에 부여할 수 있습니다. 이렇게 하면 단일 작업 영역을 사용하여 모든 리소스에서 사용하도록 설정된 수집된 데이터를 저장하는 IT 조직 운영 모델에 맞출 수 있습니다. 예를 들어 Azure VM(가상 머신)에서 호스팅되는 인프라 서비스를 담당하는 팀에 액세스 권한을 부여하면 해당 팀은 VM에서 생성된 로그에만 액세스할 수 있습니다. 이는 새로운 리소스 컨텍스트 로그 모델을 따릅니다. 이 모델의 기준은 Azure 리소스에서 내보내는 모든 로그 레코드에 대한 것이며, 이 리소스에 자동으로 연결됩니다. 로그는 리소스에 따라 범위 지정 및 Azure RBAC를 따르는 중앙 작업 영역으로 전달됩니다.

사용자가 액세스할 수 있는 데이터는 다음 표에 나열된 요인의 조합에 따라 결정됩니다. 각 요인은 아래 섹션에 설명되어 있습니다.

| 요인 | 설명 |
|:---|:---|
| [액세스 모드](#access-mode) | 사용자가 작업 영역에 액세스하는 데 사용하는 방법입니다.  사용 가능한 데이터의 범위와 적용되는 액세스 제어 모드를 정의합니다. |
| [액세스 제어 모드](#access-control-mode) | 권한이 작업 영역에서 적용되는지, 아니면 리소스 수준에서 적용되는지 여부를 정의하는 작업 영역에 대한 설정입니다. |
| [권한](./manage-access.md) | 작업 영역 또는 리소스에 대해 개별 사용자 또는 사용자 그룹에 적용되는 권한입니다. 사용자가 액세스할 수 있는 데이터를 정의합니다. |
| [테이블 수준 Azure RBAC](./manage-access.md#table-level-azure-rbac) | 액세스 모드 또는 액세스 제어 모드에 관계없이 모든 사용자에게 적용되는 세분화된 선택적 권한입니다. 사용자가 액세스할 수 있는 데이터 형식을 정의합니다. |

## <a name="access-mode"></a>액세스 모드

*액세스 모드* 는 사용자가 Log Analytics 작업 영역에 액세스하는 방법을 나타내며, 액세스할 수 있는 데이터 범위를 정의합니다. 

사용자는 다음 두 가지 방법으로 데이터에 액세스할 수 있습니다.

* **작업 영역 컨텍스트**: 권한이 있는 작업 영역에서 모든 로그를 볼 수 있습니다. 이 모드의 쿼리 범위는 작업 영역의 모든 테이블에 있는 모든 데이터로 지정됩니다. 이는 Azure Portal의 **Azure Monitor** 메뉴에서 **로그** 를 선택하는 경우와 같이 작업 영역을 범위로 사용하여 로그에 액세스할 때 사용되는 액세스 모드입니다.

    ![작업 영역의 Log Analytics 컨텍스트](./media/design-logs-deployment/query-from-workspace.png)

* **리소스 컨텍스트**: Azure Portal의 리소스 메뉴에서 **로그** 를 선택하는 경우와 같이 특정 리소스, 리소스 그룹 또는 구독에 대한 작업 영역에 액세스하는 경우 액세스 권한이 있는 모든 테이블의 리소스에 대한 로그만 볼 수 있습니다. 이 모드의 쿼리 범위는 해당 리소스와 연결된 데이터로만 지정됩니다. 또한 이 모드는 세분화된 Azure RBAC를 사용하도록 설정합니다.

    ![리소스의 Log Analytics 컨텍스트](./media/design-logs-deployment/query-from-resource.png)

    > [!NOTE]
    > 로그는 관련 리소스와 적절하게 연결된 경우에만 리소스 컨텍스트 쿼리에 사용할 수 있습니다. 현재 다음과 같은 리소스에는 제한이 있습니다.
    > - Azure 외부의 컴퓨터 - [서버용 Azure Arc](../../azure-arc/servers/index.yml)를 통해서만 리소스 컨텍스트를 지원합니다.
    > - Service Fabric
    > - Application Insights - [작업 영역 기반 Application Insights 리소스](../app/create-workspace-resource.md)를 사용하는 경우에만 리소스 컨텍스트를 지원합니다.
    >
    > 쿼리를 실행하고 관심 있는 레코드를 검사하여 로그가 해당 리소스에 제대로 연결되어 있는지 테스트할 수 있습니다. 올바른 리소스 ID가 [_ResourceId](./log-standard-columns.md#_resourceid) 속성에 있으면 데이터를 리소스 중심 쿼리에 사용할 수 있습니다.

Azure Monitor는 로그 검색을 수행하는 컨텍스트에 따라 자동으로 올바른 모드를 결정합니다. 범위는 항상 Log Analytics의 왼쪽 위 섹션에 표시됩니다.

### <a name="comparing-access-modes"></a>액세스 모드 비교

다음 표에는 액세스 모드가 요약되어 있습니다.

| 문제 | 작업 영역-컨텍스트 | 리소스-컨텍스트 |
|:---|:---|:---|
| 각 모델의 대상은 누구인가요? | 중앙 관리. 데이터 수집을 구성해야 하는 관리자와 다양한 리소스에 액세스해야 하는 사용자입니다. 또한 현재 Azure 외부의 리소스에 대한 로그에 액세스해야 하는 사용자에게도 필요합니다. | 애플리케이션 팀. 모니터링되는 Azure 리소스의 관리자입니다. |
| 사용자가 로그를 보는 데 필요한 것은 무엇인가요? | 작업 영역에 대한 권한. [작업 영역 권한을 사용하여 액세스 관리](./manage-access.md#manage-access-using-workspace-permissions)의 **작업 영역 권한** 을 참조하세요. | 리소스에 대한 읽기 액세스 권한. [Azure 권한을 사용하여 액세스 관리](./manage-access.md#manage-access-using-azure-permissions)의 **리소스 권한** 을 참조하세요. 권한은 포함하는 리소스 그룹에서와 같이 상속하거나 리소스에 직접 할당할 수 있습니다. 리소스의 로그에 대한 권한이 자동으로 할당됩니다. |
| 권한의 범위는 어떻게 되나요? | 작업 영역. 작업 영역에 대한 액세스 권한이 있는 사용자는 권한이 있는 테이블에서 작업 영역의 모든 로그를 쿼리할 수 있습니다. [테이블 액세스 제어](./manage-access.md#table-level-azure-rbac)를 참조하세요. | Azure 리소스. 사용자는 작업 영역에서 액세스할 수 있는 특정 리소스, 리소스 그룹 또는 구독에 대한 로그를 쿼리할 수 있지만, 다른 리소스에 대한 로그는 쿼리할 수 없습니다. |
| 사용자가 로그에 액세스하려면 어떻게 해야 하나요? | <ul><li>**Azure Monitor** 메뉴에서 **로그** 를 시작합니다.</li></ul> <ul><li>**Log Analytics 작업 영역** 메뉴에서 **로그** 를 시작합니다.</li></ul> <ul><li>Azure Monitor [통합 문서](../visualizations.md#workbooks)에서</li></ul> | <ul><li>Azure 리소스의 메뉴에서 **로그** 를 시작합니다.</li></ul> <ul><li>**Azure Monitor** 메뉴에서 **로그** 를 시작합니다.</li></ul> <ul><li>**Log Analytics 작업 영역** 메뉴에서 **로그** 를 시작합니다.</li></ul> <ul><li>Azure Monitor [통합 문서](../visualizations.md#workbooks)에서</li></ul> |

## <a name="access-control-mode"></a>액세스 제어 모드

*액세스 제어 모드* 는 작업 영역에 대한 권한을 결정하는 방법을 정의하는 각 작업 영역의 설정입니다.

* **작업 영역 권한 필요**: 이 제어 모드는 세분화된 Azure RBAC를 허용하지 않습니다. 사용자가 작업 영역에 액세스하려면 작업 영역 또는 특정 테이블에 대한 권한을 부여받아야 합니다.

    사용자가 작업 영역 컨텍스트 모드에 따라 작업 영역에 액세스하는 경우 액세스 권한이 부여된 테이블의 모든 데이터에 액세스할 수 있습니다. 사용자가 리소스 컨텍스트 모드에 따라 작업 영역에 액세스하는 경우 액세스 권한이 부여된 테이블의 해당 리소스에 대한 데이터에만 액세스할 수 있습니다.

    이는 2019년 3월 이전에 만든 모든 작업 영역에 대한 기본 설정입니다.

* **리소스 또는 작업 영역 권한 사용**: 이 제어 모드는 세분화된 Azure RBAC를 허용합니다. 사용자는 Azure `read` 권한을 할당하여 볼 수 있는 리소스와 연결된 데이터에만 액세스할 수 있습니다. 

    사용자가 작업 영역 컨텍스트 모드에서 작업 영역에 액세스하는 경우 작업 영역 권한이 적용됩니다. 사용자가 리소스 컨텍스트 모드에서 작업 영역에 액세스하는 경우 리소스 권한만 확인되고 작업 영역 권한은 무시됩니다. 작업 영역 권한에서 사용자를 제거하고 해당 리소스 권한을 인식할 수 있도록 허용하여 사용자에 대해 Azure RBAC를 사용하도록 설정합니다.

    이는 2019년 3월 이후에 만든 모든 작업 영역에 대한 기본 설정입니다.

    > [!NOTE]
    > 사용자에게 작업 영역에 대한 리소스 권한만 있는 경우 작업 영역 액세스 모드가 **리소스 또는 작업 영역 권한 사용** 으로 설정되어 있다고 가정하여 리소스 컨텍스트 모드를 사용하는 작업 영역에만 액세스할 수 있습니다.

포털에서 PowerShell을 사용하거나 Resource Manager 템플릿을 사용하여 액세스 제어 모드를 변경하는 방법에 대한 자세한 내용은 [액세스 제어 모드 구성](./manage-access.md#configure-access-control-mode)을 참조하세요.

## <a name="scale-and-ingestion-volume-rate-limit"></a>스케일링 및 수집 볼륨 속도 제한

Azure Monitor는 점점 더 빠른 속도로 매월 페타바이트 단위의 데이터를 보내는 수천 명의 고객에게 서비스를 제공하는 대규모 데이터 서비스입니다. 작업 영역은 스토리지 공간에 제한되지 않으며 페타바이트 단위의 데이터까지 확장할 수 있습니다. 스케일링으로 인해 작업 영역을 분할할 필요가 없습니다.

Azure Monitor 고객과 Azure Monitor 백 엔드 인프라를 보호하고 격리하기 위해 급증 및 폭주 상황으로부터 보호하도록 설계된 기본 수집 속도 제한이 있습니다. 속도 제한 기본값은 약 **6GB/분** 이며, 정상적인 수집이 가능하도록 설계되었습니다. 수집 볼륨 제한 측정에 대한 자세한 내용은 [Azure Monitor 서비스 제한](../service-limits.md#data-ingestion-volume-rate)을 참조하세요.

하루에 4TB 미만을 수집하는 고객은 일반적으로 이러한 제한을 충족하지 않습니다. 더 많은 볼륨을 수집하거나 정상 작업의 일환으로 급증 상황에 있는 고객은 수집 속도 제한을 높일 수 있는 [전용 클러스터](./logs-dedicated-clusters.md)로 이동하는 것이 좋습니다.

수집 속도 제한이 활성화되거나 임계값의 80%에 도달하면 이벤트가 작업 영역의 *작업* 테이블에 추가됩니다. 이를 모니터링하고 경고를 만드는 것이 좋습니다. 자세한 내용은 [데이터 수집 볼륨 속도](../service-limits.md#data-ingestion-volume-rate)를 참조하세요.


## <a name="recommendations"></a>권장 사항

![리소스 컨텍스트 디자인 예](./media/design-logs-deployment/workspace-design-resource-context-01.png)

이 시나리오에서는 IT 조직의 구독에서 데이터 주권 또는 규정 준수의 제약을 받지 않거나 리소스가 배포되는 지역에 매핑해야 하는 단일 작업 영역의 디자인에 대해 설명합니다. 이를 통해 조직의 보안 및 IT 관리 팀은 Azure 액세스 관리와의 향상된 통합 및 더 안전한 액세스 제어를 활용할 수 있습니다.

여러 팀에서 유지 관리하는 인프라 및 애플리케이션을 지원하는 모든 리소스, 모니터링 솔루션 및 인사이트(예: Application Insights 및 VM 인사이트)는 수집된 로그 데이터를 IT 조직의 중앙 집중식 공유 작업 영역으로 전달하도록 구성됩니다. 각 팀의 사용자에게는 액세스 권한이 부여된 리소스의 로그에 대한 액세스 권한이 부여됩니다.

작업 영역 아키텍처가 배포되면 [Azure Policy](../../governance/policy/overview.md)를 사용하여 이를 Azure 리소스에 적용할 수 있습니다. 정책을 정의하고 Azure 리소스에 대한 규정 준수를 보장하는 방법을 보장하여 모든 리소스 로그를 특정 작업 영역에 보냅니다. 예를 들어 Azure 가상 머신 또는 가상 머신 확장 집합을 사용하면 작업 영역 규정 준수를 평가하고 결과를 보고하는 기존 정책을 사용하거나, 규정을 준수하지 않는 경우 수정하도록 사용자 지정할 수 있습니다.  

## <a name="workspace-consolidation-migration-strategy"></a>작업 영역 통합 마이그레이션 전략

이미 여러 작업 영역을 배포했으며 리소스 컨텍스트 액세스 모델로 통합하는 데 관심이 있는 고객의 경우 권장 액세스 모델로 점진적으로 마이그레이션하는 방법을 사용하는 것이 좋으며, 이를 빠르거나 공격적으로 시도하지 않는 것이 좋습니다. 적절한 타임라인에 따라 계획, 마이그레이션, 유효성 검사 및 사용 중지를 단계별 방식으로 수행하면 계획되지 않은 인시던트 또는 클라우드 작업에 대한 예기치 않은 영향을 방지할 수 있습니다. 규정 준수 또는 비즈니스상의 이유로 데이터 보존 정책이 없는 경우 프로세스 중에 데이터를 마이그레이션하는 작업 영역에 보존하는 적절한 기간을 평가해야 합니다. 공유 작업 영역에 보고하도록 리소스를 다시 구성하는 동안 필요에 따라 원래 작업 영역에서 데이터를 분석할 수 있습니다. 마이그레이션이 완료되면 보존 기간이 끝나기 전에 원래 작업 영역에서 데이터를 보존하도록 관리하는 경우 해당 데이터를 삭제하지 않습니다.

이 모델로의 마이그레이션을 계획하는 동안 다음 사항을 고려합니다.

* 데이터 보존과 관련된 업계 규정 및 내부 정책을 이해합니다.
* 애플리케이션 팀에서 기존 리소스 컨텍스트 기능 내에서 작업할 수 있는지 확인합니다.
* 애플리케이션 팀의 리소스에 액세스 권한을 식별하고, 프로덕션 환경에서 구현하기 전에 개발 환경에서 테스트합니다.
* **리소스 또는 작업 영역 권한 사용** 을 사용하도록 작업 영역을 구성합니다.
* 작업 영역을 읽고 쿼리할 수 있는 애플리케이션 팀 권한을 제거합니다.
* 원래 작업 영역에 배포된 모든 모니터링 솔루션, 인사이트(예: 컨테이너 인사이트 및/또는 VM용 Azure Monitor), Automation 계정 및 업데이트 관리, VM 시작/중지 등과 같은 관리 솔루션을 사용하도록 설정하고 구성합니다.

## <a name="next-steps"></a>다음 단계

이 가이드에서 권장하는 보안 권한 및 제어를 구현하려면 [로그에 대한 액세스 관리](./manage-access.md)를 검토합니다.
