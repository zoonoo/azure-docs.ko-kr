---
title: Azure Log Analytics의 네트워크 성능 모니터 솔루션에 포함된 성능 모니터 기능 | Microsoft Docs
description: 네트워크 성능 모니터의 성능 모니터 기능을 사용하면 네트워크의 다양한 지점 간 네트워크 연결을 모니터링할 수 있습니다. 클라우드 배포 및 온-프레미스 위치, 여러 데이터 센터, 지점, 업무에 중요한 다중 계층 애플리케이션 또는 마이크로 서비스를 모니터링할 수 있습니다.
services: log-analytics
documentationcenter: ''
author: abshamsft
manager: carmonm
editor: ''
ms.assetid: 5b9c9c83-3435-488c-b4f6-7653003ae18a
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.topic: conceptual
ms.date: 02/20/2018
ms.author: abshamsft
ms.openlocfilehash: de9e6d5c8c6b4dc9652ae64c9a4fd0e38d7a7b87
ms.sourcegitcommit: 61c8de2e95011c094af18fdf679d5efe5069197b
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/23/2019
ms.locfileid: "62109541"
---
# <a name="network-performance-monitor-solution-performance-monitoring"></a>네트워크 성능 모니터 솔루션: 성능 모니터링

[네트워크 성능 모니터](network-performance-monitor.md)의 성능 모니터 기능을 사용하면 네트워크의 다양한 지점 간 네트워크 연결을 모니터링할 수 있습니다. 클라우드 배포 및 온-프레미스 위치, 여러 데이터 센터, 지점, 업무에 중요한 다중 계층 애플리케이션 또는 마이크로 서비스를 모니터링할 수 있습니다. 성능 모니터를 사용하여 사용자가 불만을 제기하기 전에 네트워크 문제를 감지할 수 있습니다. 다음 작업을 수행할 수 있다는 주요 이점이 있습니다. 

- 다양한 서브넷에서 손실 및 대기 시간을 모니터링하고 경고를 설정합니다.
- 네트워크의 모든 경로(중복 경로 포함)를 모니터링합니다.
- 복제하기 어려운 일시적 및 특정 시점의 네트워크 문제를 해결합니다.
- 성능 저하의 원인이 되는 네트워크의 특정 세그먼트를 확인합니다.
- SNMP 없이 네트워크의 상태를 모니터링합니다.


![네트워크 성능 모니터](media/network-performance-monitor-performance-monitor/npm-performance-monitor.png)

## <a name="configuration"></a>구성
네트워크 성능 모니터에 대한 구성을 열려면 [네트워크 성능 모니터 솔루션](network-performance-monitor.md)을 열고 **구성**을 선택합니다.

![네트워크 성능 모니터 구성](media/network-performance-monitor-performance-monitor/npm-configure-button.png)

### <a name="create-new-networks"></a>새 네트워크 만들기

네트워크 성능 모니터의 네트워크는 서브넷의 논리적 컨테이너입니다. 이 네트워크는 사용자의 요구에 따라 네트워크 인프라 모니터링을 구성하도록 지원합니다. 이해하기 쉬운 이름으로 네트워크를 만들고 비즈니스 논리에 따라 서브넷을 추가할 수 있습니다. 예를 들어, London이라는 네트워크를 만들고 London 데이터 센터의 모든 서브넷을 추가할 수 있습니다. 또는 *ContosoFrontEnd*라는 네트워크를 만들고 앱의 프런트 엔드로 작동하는 Contoso라는 모든 서브넷을 이 네트워크에 추가할 수 있습니다. 이 솔루션은 작업 환경에서 검색된 모든 서브넷을 포함하는 기본 네트워크를 자동으로 만듭니다. 

네트워크를 만들 때마다 서브넷을 추가합니다. 그러면 해당 서브넷은 기본 네트워크에서 제거됩니다. 네트워크를 삭제하면 그 안의 모든 서브넷은 자동으로 기본 네트워크로 돌아갑니다. 기본 네트워크는 사용자 정의 네트워크에 포함되지 않은 모든 서브넷의 컨테이너 역할을 합니다. 기본 네트워크는 편집 또는 삭제할 수 없으며 언제나 시스템에 유지됩니다. 사용자 지정 네트워크는 필요한 만큼 만들 수 있습니다. 대부분의 경우 조직의 서브넷은 둘 이상의 네트워크에 정렬됩니다. 하나 이상의 네트워크를 만들어 비즈니스 논리에 맞게 서브넷을 그룹화합니다.

새 네트워크를 만들려면


1. **네트워크** 탭을 선택합니다.
1. 네트워크 추가를 선택한 다음,  **네트워크** 이름과 설명을 입력합니다. 
2. 하나 이상의 서브넷을 선택하고 **추가** 를 선택합니다. 
3. **저장** 을 선택하여 구성을 저장합니다. 


### <a name="create-monitoring-rules"></a>모니터링 규칙 만들기 

성능 모니터는 2개의 하위 네트워크 간 또는 2개의 네트워크 간의 네트워크 연결 성능 임계값을 초과할 때 상태 이벤트를 생성합니다. 시스템은 자동으로 이러한 임계값을 학습할 수 있습니다. 사용자 지정 임계값을 제공할 수도 있습니다. 시스템은 한 쌍의 네트워크 또는 서브네트워크 링크 간에 발생한 손실 또는 대기 시간이 시스템에서 학습한 임계값을 위반할 때마다 상태 이벤트를 생성하는 기본 규칙을 자동으로 만듭니다. 이 프로세스는 사용자가 모니터링 규칙을 명시적으로 만들지 않은 경우 솔루션에서 네트워크 인프라를 모니터링하는 데 도움이 됩니다. 기본 규칙을 사용하도록 설정하면 모든 노드는 모니터링이 가능하도록 설정된 다른 모든 노드로 가상 트랜잭션을 보냅니다. 기본 규칙은 소규모 네트워크의 경우에 유용합니다. 소수의 서버에서 마이크로 서비스를 실행하고 있고 이 모든 서버가 서로 연결되어야 하는 시나리오를 예로 들 수 있습니다.

>[!NOTE]
> 기본 규칙을 사용하지 않도록 설정하고 사용자 지정 모니터링 규칙을 만드는 것이 좋습니다(특히, 많은 수의 노드를 모니터링에 사용하는 대규모 네트워크의 경우). 사용자 지정 모니터링 규칙은 솔루션에서 생성되는 트래픽 양을 줄이고 네트워크 모니터링을 구성하는 데 도움이 될 수 있습니다.

비즈니스 논리에 따라 모니터링 규칙을 만듭니다. 본사에 대한 두 지점 사이트의 네트워크 연결 성능을 모니터링하려는 경우를 예로 들 수 있습니다. 지점 site1의 모든 서브넷을 네트워크 O1로 그룹화합니다. 그런 후 지점 site2의 모든 서브넷을 네트워크 O2로 그룹화합니다. 마지막으로, 본사의 모든 서브넷을 네트워크 H로 그룹화합니다. 그런 후 O1과 H 간에 1개, O2와 H 간에 1개씩, 2개의 모니터링 규칙을 만듭니다. 

사용자 지정 모니터링 규칙을 만들려면

1. **모니터** 탭에서 **규칙 추가**를 선택하고 규칙 이름과 설명을 입력합니다.
2. 목록에서 모니터링할 네트워크 또는 서브네트워크 링크 쌍을 선택합니다. 
3. 네트워크 드롭다운 목록에서 원하는 서브네트워크를 포함하는 네트워크를 선택합니다. 그런 다음, 해당 서브네트워크 드롭다운 목록에서 서브네트워크를 선택합니다. 네트워크 링크의 모든 서브네트워크를 모니터링하려면 **모든 서브네트워크**를 선택합니다. 마찬가지로 원하는 다른 서브네트워크를 선택합니다. 선택한 서브네트워크 중에서 특정 서브네트워크 링크에 대한 모니터링을 제외하려면 **제외 추가**를 선택합니다. 
4. ICMP 및 TCP 프로토콜 중 가상 트랜잭션 실행에 사용할 프로토콜을 선택합니다. 
5. 선택한 항목에 대해 상태 이벤트를 만들지 않으려는 경우 **이 규칙이 적용되는 링크에서 상태 모니터링 사용**을 선택 취소합니다. 
6. 모니터링 조건을 선택합니다. 상태 이벤트 생성에 대한 사용자 지정 임계값을 설정하려면 임계값을 입력합니다. 조건 값이 선택한 네트워크 또는 서브네트워크 쌍에 선택된 임계값을 초과할 경우 상태 이벤트가 생성됩니다. 
7. **저장**을 선택하여 구성을 저장합니다. 

모니터링 규칙을 저장한 후에는 **경고 만들기**를 선택하여 규칙을 경고 관리와 통합할 수 있습니다. 검색 쿼리를 사용하여 경고 규칙이 자동으로 만들어집니다. 다른 필수 매개 변수는 자동으로 채워집니다. 경고 규칙을 사용하면 네트워크 성능 모니터 내에 있는 기존 경고 외에도 이메일 기반 경고를 수신할 수 있습니다. 또한 경고를 통해 Runbook으로 수정 작업을 트리거하거나 웹후크를 사용하여 기존 서비스 관리 솔루션과 통합할 수 있습니다. **경고 관리**를 선택하여 경고 설정을 편집합니다. 

이제 성능 모니터 규칙을 추가로 만들거나 솔루션 대시보드로 이동하여 기능을 사용할 수 있습니다.

### <a name="choose-the-protocol"></a>프로토콜 선택

네트워크 성능 모니터는 가상 트랜잭션을 사용하여 패킷 손실 및 연결 대기 시간과 같은 네트워크 성능 메트릭을 계산합니다. 이 개념에 대한 이해를 돕기 위해 네트워크 링크의 한 쪽 끝에 연결된 네트워크 성능 모니터 에이전트를 살펴보겠습니다. 이 네트워크 성능 모니터 에이전트는 네트워크의 다른 끝에 연결된 두 번째 네트워크 성능 모니터 에이전트로 프로브 패킷을 전송합니다. 두 번째 에이전트는 응답 패킷을 사용하여 회신합니다. 이 프로세스는 몇 번 반복됩니다. 첫 번째 네트워크 성능 모니터 에이전트는 응답 수 및 각 응답을 수신하는 데 소요된 시간을 측정하여 연결 대기 시간 및 패킷 삭제를 평가합니다. 

이러한 패킷의 형식, 크기 및 시퀀스는 모니터링 규칙을 만들 때 선택하는 프로토콜에 의해 결정됩니다. 패킷의 프로토콜을 기반으로 중간 네트워크 디바이스(라우터, 스위치 등)는 이러한 패킷을 다르게 처리할 수 있습니다. 따라서 프로토콜 선택은 결과의 정확성이 영향을 미칩니다. 프로토콜 선택은 네트워크 성능 모니터 솔루션을 배포한 후 수동 단계를 수행해야 하는지 여부도 결정합니다. 

네트워크 성능 모니터에서는 ICMP 및 TCP 프로토콜 중 가상 트랜잭션 수행에 사용할 프로토콜을 선택할 수 있습니다. 가상 트랜잭션 규칙을 만들 때 ICMP를 선택하면 네트워크 성능 모니터 에이전트는 ICMP 에코 메시지를 사용하여 네트워크 대기 시간 및 패킷 손실을 계산합니다. ICMP 에코는 기본 Ping 유틸리티에서 보낸 것과 같은 메시지를 사용합니다. TCP를 프로토콜로 사용하는 경우 네트워크 성능 모니터 에이전트는 네트워크를 통해 TCP SYN 패킷을 보냅니다. 그 후, TCP 핸드셰이크가 완료되면 RST 패킷을 사용하여 연결이 제거됩니다. 

프로토콜을 선택하기 전에 다음 정보를 고려하세요. 

* **여러 네트워크 경로 검색.** TCP는 여러 경로 검색 시 보다 정확하며 각 서브넷에 필요한 에이전트 수가 더 적습니다. 예를 들어 TCP를 사용하는 하나 또는 두 개의 에이전트는 서브넷 간의 모든 중복 경로를 검색할 수 있습니다. ICMP를 사용하여 비슷한 결과를 달성하려면 에이전트가 여러 개 필요합니다. ICMP 사용 시 두 서브넷 간에 경로가 여러 개이면 원본 또는 대상 서브넷에 5개 이상의 에이전트가 필요합니다.

* **결과의 정확성.** 라우터와 스위치는 ICMP 에코 패킷에 TCP 패킷보다 낮은 우선 순위를 할당하는 경향이 있습니다. 특정 상황에서 네트워크 장치에 부하가 심하면 TCP에서 가져온 데이터가 애플리케이션에 발생하는 손실과 대기 시간을 보다 철저하게 반영합니다. 이것은 대부분의 애플리케이션 트래픽이 TCP를 통해 흐르기 때문입니다. 이런 경우 ICMP는 TCP보다 덜 정확한 결과를 제공합니다. 

* **방화벽 구성.** TCP 프로토콜에서는 TCP 패킷이 대상 포트에 전송되어야 합니다. 네트워크 성능 모니터 에이전트에서 사용되는 기본 포트는 8084입니다. 에이전트를 구성할 때 포트를 변경할 수 있습니다. 네트워크 방화벽 또는 NSG(네트워크 보안 그룹) 규칙(Azure에서)이 포트에서 트래픽을 허용하는지 확인합니다. 에이전트가 설치된 컴퓨터의 로컬 방화벽이 이 포트에 트래픽을 허용하는지도 확인해야 합니다. PowerShell 스크립트를 사용하여 Windows를 실행하는 컴퓨터에서 방화벽 규칙을 구성할 수 있지만 네트워크 방화벽을 수동으로 구성해야 합니다. 반면, ICMP는 포트를 사용하여 작동하지 않습니다. 대부분의 엔터프라이즈 시나리오에서 ICMP 트래픽은 방화벽을 통해 Ping 유틸리티와 같은 네트워크 진단 도구를 사용할 수 있도록 허용됩니다. 한 컴퓨터에서 다른 컴퓨터에 Ping을 할 수 있으면 방화벽을 수동으로 구성하지 않고도 ICMP 프로토콜을 사용할 수 있습니다.

>[!NOTE] 
> 일부 방화벽은 ICMP를 차단하여 보안 정보 및 이벤트 관리 시스템에서 대량의 이벤트가 다시 전송되는 결과를 가져올 수 있습니다. 사용자가 선택한 프로토콜이 네트워크 방화벽 또는 NSG에 의해 차단되지 않는지 확인합니다. 차단되면 네트워크 성능 모니터가 네트워크 세그먼트를 모니터링할 수 없습니다. 모니터링을 위해 TCP를 사용하는 것이 좋습니다. 예를 들어 다음과 같이 TCP를 사용할 수 없는 시나리오에서는 ICMP를 사용합니다. 
>
> - Windows 클라이언트에서는 TCP 원시 소켓이 허용되지 않으므로 Windows 클라이언트 기반 노드를 사용하는 경우.
> - 네트워크 방화벽 또는 NSG에서 TCP를 차단하는 경우.
> - 프로토콜을 전환하는 방법을 모르는 경우.

배포하는 동안 ICMP를 사용하도록 선택한 경우에는 기본 모니터링 규칙을 편집하여 TCP로 언제든 전환할 수 있습니다.

1. **네트워크 성능** > **모니터** > **구성** > **모니터**로 이동합니다. 그런 다음,  **기본 규칙**을 선택합니다. 
2. **프로토콜** 섹션으로 스크롤하여 사용할 프로토콜을 선택합니다. 
3. **저장**을 선택하여 설정을 적용합니다. 

기본 규칙에서 특정 프로토콜을 사용하더라도 다른 프로토콜로 새 규칙을 만들 수 있습니다. 일부 규칙에서는 ICMP를 사용하고 다른 규칙에서는 TCP를 사용하는 혼합 규칙을 만들 수도 있습니다. 

## <a name="walkthrough"></a>연습 

이제 상태 이벤트의 근본 원인에 대한 간단한 조사 방법을 살펴보겠습니다.

솔루션 대시보드에서 상태 이벤트에 네트워크 링크가 비정상이라고 표시됩니다. 이 문제를 조사하려면 **모니터링 중인 네트워크 링크** 타일을 선택합니다.

드릴다운 페이지에 **DMZ2-DMZ1** 네트워크 링크가 비정상이라고 표시됩니다. 이 네트워크 링크에 대한 **서브넷 링크 보기**를 선택합니다. 


드릴다운 페이지에는 **DMZ2-DMZ1** 네트워크 링크의 모든 서브네트워크 링크가 표시됩니다. 두 서브네트워크 링크에서 대기 시간이 임계값을 초과해 네트워크 링크가 비정상 상태가 되었습니다. 또한 두 서브네트워크 링크의 대기 시간 추세도 볼 수 있습니다. 그래프에서 시간 선택 컨트롤을 사용하여 필요한 시간 범위만 자세히 확인합니다. 대기 시간이 최고점에 도달한 시간대를 확인할 수 있습니다. 나중에 이 시간대의 로그를 검색하여 문제를 조사합니다. **노드 링크 보기**를 선택하여 자세히 드릴다운합니다. 
 
 ![서브네트워크 링크 페이지](media/network-performance-monitor-performance-monitor/subnetwork-links.png) 

이전 페이지와 마찬가지로, 특정 서브네트워크 링크의 드릴다운 페이지에는 해당 노드 링크가 나열됩니다. 여기에서도 이전 단계와 유사한 작업을 할 수 있습니다. 두 노드 간 토폴로지를 보려면 **토폴로지 보기**를 선택합니다. 
 
 ![노드 링크 페이지](media/network-performance-monitor-performance-monitor/node-links.png) 

선택된 두 노드 사이의 모든 패스가 토폴로지 맵에 그려져 있습니다. 토폴로지 맵에서 두 노드 간 경로의 홉 단위 토폴로지를 시각화할 수 있습니다. 이를 통해 두 노드 간 존재하는 경로 수와 데이터 패킷이 사용하는 패스를 분명히 확인할 수 있습니다. 네트워크 성능 병목은 빨간색으로 표시되어 있습니다. 문제가 있는 네트워크 연결 또는 장애가 발생한 네트워크 디바이스를 찾으려면 토폴로지 맵에서 빨간색으로 표시된 요소를 찾습니다. 

 ![토폴로지 맵을 포함하는 토폴로지 대시보드](media/network-performance-monitor-performance-monitor/topology-dashboard.png) 

각 패스의 손실, 대기 시간, 홉 수는 **작업** 창에서 검토할 수 있습니다. 비정상 패스의 세부 정보를 보려면 스크롤 막대를 사용합니다. 필터를 사용하여 비정상 홉이 있는 경로를 선택하고 선택한 경로에 대한 토폴로지만 그려지도록 합니다. 토폴로지 맵을 확대 또는 축소하려면 마우스 휠을 사용합니다. 

다음 그림에서 특정 네트워크 섹션의 문제 영역에 대한 근본 원인이 빨간색 경로 및 홉에 표시됩니다. 토폴로지 맵에서 노드를 선택하여 FQDN, IP 주소 등의 노드 속성을 표시합니다. 홉을 선택하면 홉의 IP 주소가 표시됩니다. 
 
![노드 속성이 선택된 토폴로지 맵](media/network-performance-monitor-performance-monitor/topology-dashboard-root-cause.png) 

## <a name="next-steps"></a>다음 단계
자세한 네트워크 성능 데이터 레코드를 보려면 [로그 검색](../../azure-monitor/log-query/log-query-overview.md)을 수행합니다.
