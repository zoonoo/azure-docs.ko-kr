---
title: 통합 문서를 사용 하 여 대화형 보고서 VM용 Azure Monitor 만들기 | Microsoft Docs
description: VM용 Azure Monitor에 대해 미리 정의 되 고 사용자 지정 매개 변수가 있는 통합 문서로 복잡 한 보고를 간소화 합니다.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 10/15/2019
ms.openlocfilehash: 7ec24f1eca0b2cf1d5ea2c171573f7c5e47319af
ms.sourcegitcommit: 747a20b40b12755faa0a69f0c373bd79349f39e3
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 02/27/2020
ms.locfileid: "77670681"
---
# <a name="create-interactive-reports-azure-monitor-for-vms-with-workbooks"></a>통합 문서를 사용 하 여 대화형 보고서 VM용 Azure Monitor 만들기

통합 문서는 텍스트, [로그 쿼리](../log-query/query-language.md), 메트릭 및 매개 변수를 풍부한 대화형 보고서로 결합 합니다. 통합 문서는 동일한 Azure 리소스에 대한 액세스 권한이 있는 다른 팀 멤버에 의해 편집될 수 있습니다.

통합 문서는 다음과 같은 시나리오에 유용 합니다.

* 관심 있는 메트릭을 미리 알지 못하는 경우 (CPU 사용률, 디스크 공간, 메모리, 네트워크 종속성 등) 가상 머신의 사용 현황을 살펴보세요. 다른 사용 현황 분석 도구와 달리 통합 문서를 사용 하면 여러 종류의 시각화 및 분석을 결합 하 여 이러한 종류의 자유 형식 탐색에 유용 하 게 사용할 수 있습니다.
* 주요 카운터 및 기타 로그 이벤트에 대 한 메트릭을 표시 하 여 최근에 프로 비전 된 VM이 수행 되는 방식을 팀에 설명 합니다.
* 팀의 다른 멤버와 VM의 크기 조정 실험 결과를 공유 합니다. 텍스트를 사용 하 여 실험의 목표를 설명 하 고, 실험을 평가 하는 데 사용 되는 각 사용 메트릭과 분석 쿼리를 표시 하 고 각 메트릭이 위 또는 아래에 있는지 여부에 대 한 명확한 호출을 표시할 수 있습니다.
* VM 사용에 대 한 가동 중단의 영향 보고, 데이터 결합, 텍스트 설명 및 향후 중단을 방지 하는 다음 단계에 대 한 논의를 보고 합니다.

VM용 Azure Monitor는 시작 하기 위한 몇 가지 통합 문서가 포함 되어 있으며 다음 표에 요약 되어 있습니다.

| 통합 문서 | Description | 범위 |
|----------|-------------|-------|
| 성능 | 사용 하도록 설정한 모든 Log Analytics 성능 카운터를 활용 하는 단일 통합 문서에서 상위 N 개 목록 및 차트 보기의 사용자 지정 가능한 버전을 제공 합니다.| 대규모 |
| 성능 카운터 | 광범위 한 성능 카운터 집합에 대 한 상위 N 개 차트 뷰입니다. | 대규모 |
| Connections | 연결에서는 모니터링 되는 Vm의 인바운드 및 아웃 바운드 연결에 대 한 자세한 보기를 제공 합니다. | 대규모 |
| 활성 포트 | 모니터링 되는 Vm의 포트에 바인딩된 프로세스 및 선택한 기간 동안 해당 활동의 목록을 제공 합니다. | 대규모 |
| 포트 열기 | 모니터링 되는 Vm에서 열린 포트 수와 열려 있는 포트에 대 한 세부 정보를 제공 합니다. | 대규모 |
| 실패한 연결 | 모니터링 되는 Vm의 실패 한 연결 수, 실패 추세 및 시간이 지남에 따라 오류 백분율이 늘어나는 경우를 표시 합니다. | 대규모 |
| 보안 및 감사 | IP 끝점이 전역적으로 상주 하는 전체 연결, 악의적인 연결에 대해 보고 하는 TCP/IP 트래픽 분석입니다.  모든 기능을 사용 하도록 설정 하려면 보안 검색을 사용 하도록 설정 해야 합니다. | 대규모 |
| TCP 트래픽 | 모니터링 되는 Vm에 대 한 순위를 매겨진 보고서 이며,이를 통해 표 형태로 보내고 받고 총 네트워크 트래픽을 추세 선으로 표시 합니다. | 대규모 |
| 트래픽 비교 | 이 통합 문서를 사용 하면 단일 컴퓨터 또는 컴퓨터 그룹에 대 한 네트워크 트래픽 추세를 비교할 수 있습니다. | 대규모 |
| 성능 | 사용 하도록 설정한 모든 Log Analytics 성능 카운터를 활용 하는 사용자 지정 가능한 버전의 성능 보기를 제공 합니다. | 단일 VM | 
| Connections | 연결은 VM에서 인바운드 및 아웃 바운드 연결에 대 한 자세한 보기를 제공 합니다. | 단일 VM |
 
## <a name="starting-with-a-template-or-saved-workbook"></a>템플릿 또는 저장된 통합 문서 시작

통합 문서는 독립적으로 편집할 수 있는 차트, 테이블, 텍스트 및 입력 컨트롤로 구성된 섹션으로 구성됩니다. 통합 문서에 대 한 이해를 돕기 위해 먼저 템플릿을 열고 사용자 지정 통합 문서를 만드는 과정을 살펴보겠습니다. 

1. [Azure Portal](https://portal.azure.com)에 로그인합니다.

2. **Virtual Machines**를 선택합니다.

3. 목록에서 VM을 선택합니다.

4. VM 페이지에 **모니터링** 섹션에서 **인사이트(미리 보기)** 를 선택합니다.

5. VM insights 페이지에서 **성능** 또는 **맵** 탭을 선택 하 고 페이지의 링크에서 **통합 문서 보기** 를 선택 합니다. 

    ![통합 문서에 대한 탐색 스크린샷](media/vminsights-workbooks/workbook-option-01.png)

6. 드롭다운 목록에서 목록 맨 아래에 있는 **갤러리로 이동** 을 선택 합니다.

    ![통합 문서 드롭다운 목록의 스크린샷](media/vminsights-workbooks/workbook-dropdown-gallery-01.png)

    시작 하는 데 도움이 되는 미리 작성 된 많은 통합 문서를 포함 하는 통합 문서 갤러리를 시작 합니다.

7. **빠른 시작** 제목 아래에 있는 **기본 템플릿**부터 시작하겠습니다.

    ![통합 문서 갤러리 스크린샷](media/vminsights-workbooks/workbook-gallery-01.png)

## <a name="editing-workbook-sections"></a>통합 문서 섹션 편집

통합 문서에는 **편집 모드** 및 **읽기 모드**라는 두 가지 모드가 있습니다. 기본 템플릿 통합 문서가 처음 시작 되 면 **편집 모드**에서 열립니다. 다른 방법으로는 숨겨진 모든 단계와 매개 변수를 포함 하 여 통합 문서의 모든 내용을 표시 합니다. **읽기 모드**는 간소화된 보고서 스타일 보기를 제공합니다. 읽기 모드를 사용 하면 수정이 필요한 경우에만 기본 메커니즘을 사용 하 여 보고서를 만들 때 발생 하는 복잡성을 추상화할 수 있습니다.

![VM용 Azure Monitor 통합 문서 섹션 편집 컨트롤](media/vminsights-workbooks/workbook-new-workbook-editor-01.png)

1. 섹션 편집이 완료 되 면 섹션의 왼쪽 아래 모서리에 있는 **편집 완료** 를 클릭 합니다.

2. 중복 섹션을 만들려면 **이 섹션 복제** 아이콘을 클릭합니다. 중복 섹션을 만드는 것은 이전 반복을 손실하지 않고 쿼리를 반복하는 좋은 방법입니다.

3. 통합 문서에서 섹션을 이동하려면 **위로 이동** 또는 **아래로 이동** 아이콘을 클릭합니다.

4. 섹션을 영구적으로 제거하려면 **제거** 아이콘을 클릭합니다.

## <a name="adding-text-and-markdown-sections"></a>텍스트 및 Markdown 섹션 추가

통합 문서에 제목, 설명 및 해설을 추가하면 테이블 및 차트의 집합을 설명으로 전환할 수 있습니다. 통합 문서의 텍스트 섹션은 머리글, 굵게, 기울임꼴 및 글머리 기호 목록과 같은 텍스트 서식 지정에 대해 [Markdown 구문](https://daringfireball.net/projects/markdown/)을 지원합니다.

통합 문서에 텍스트 섹션을 추가하려면 통합 문서의 맨 아래 또는 섹션의 맨 아래에 있는 **텍스트 추가** 단추를 사용합니다.

## <a name="adding-query-sections"></a>쿼리 추가 섹션

![통합 문서의 쿼리 섹션](media/vminsights-workbooks/005-workbook-query-section.png)

통합 문서에 쿼리 섹션을 추가하려면 통합 문서의 맨 아래 또는 섹션의 맨 아래에 있는 **쿼리 추가** 단추를 사용합니다.

쿼리 섹션은 매우 유연하고 다음과 같은 질문에 응답하는 데 사용할 수 있습니다.

* 네트워크 트래픽이 증가 하는 것과 동일한 기간 동안 내 CPU 사용률이 어떻게 되나요?
* 지난 달에 사용 가능한 디스크 공간의 추세는 무엇 인가요?
* 지난 2 주 동안 VM 환경에서 발생 한 네트워크 연결 오류는 몇 개입니까? 

또한 통합 문서를 시작한 가상 컴퓨터의 컨텍스트에서만 쿼리할 수 있습니다. 해당 리소스에 대 한 액세스 권한이 있는 한, Log Analytics 작업 영역 뿐만 아니라 여러 가상 컴퓨터에 대해 쿼리할 수 있습니다.

**작업 영역** 식별자를 사용 하 여 다른 Log Analytics 작업 영역 또는 특정 Application Insights 앱의 데이터를 포함 합니다. 리소스 간 쿼리에 대 한 자세한 내용은 [공식 지침](../log-query/cross-workspace-query.md)을 참조 하세요.

### <a name="advanced-analytic-query-settings"></a>고급 분석 쿼리 설정

각 섹션에는 **매개 변수 추가** 단추 오른쪽에 있는 ![통합 문서 섹션 편집 컨트롤](media/vminsights-workbooks/006-settings.png) 아이콘을 통해 액세스할 수 있는 고유한 고급 설정이 있습니다.

![VM용 Azure Monitor 통합 문서 섹션 편집 컨트롤](media/vminsights-workbooks/007-settings-expanded.png)

|         |          |
| ---------------- |:-----|
| **사용자 지정 너비**    | 항목의 크기를 임의로 설정 하므로 많은 항목을 한 줄에 맞추고 차트 및 테이블을 다양 한 대화형 보고서로 더 잘 구성할 수 있습니다.  |
| **조건부로 표시** | 읽기 모드의 경우 매개 변수를 기반으로 단계를 숨기도록 지정 합니다. |
| **매개 변수 내보내기**| 표 또는 차트에서 선택한 행을 허용 하 여 이후 단계에서 값을 변경 하거나 표시 되도록 합니다.  |
| **편집하고 있지 않을 때 쿼리 표시** | 읽기 모드의 경우에도 차트 또는 테이블 위에 쿼리를 표시 합니다.
| **편집하고 있지 않을 때 분석에서 열기 단추 표시** | 차트의 오른쪽 모서리에 파란색 분석 아이콘을 추가 하 여 한 번의 클릭으로 액세스를 허용 합니다.|

이러한 설정 중 대부분은 매우 간단하지만 **매개 변수 내보내기**를 이해하려면 이 기능을 사용할 수 있는 통합 문서를 검사하는 것이 좋습니다.

미리 작성 된 통합 문서 중 하나인 **TCP 트래픽**은 VM의 연결 메트릭에 대 한 정보를 제공 합니다.

통합 문서의 첫 번째 섹션은 로그 쿼리 데이터를 기반으로 합니다. 또한 두 번째 섹션은 로그 쿼리 데이터를 기반으로 하지만 첫 번째 테이블의 행을 선택 하면 차트의 내용이 대화형으로 업데이트 됩니다.

![VM용 Azure Monitor 통합 문서 섹션 편집 컨트롤](media/vminsights-workbooks/008-workbook-tcp-traffic.png)

**항목을 선택 하면** 테이블의 로그 쿼리에서 사용 되는 매개 변수 고급 설정을 내보냅니다 .를 사용 하 여 동작을 수행할 수 있습니다.

![VM용 Azure Monitor 통합 문서 섹션 편집 컨트롤](media/vminsights-workbooks/009-settings-export.png)

그런 다음 두 번째 로그 쿼리는 행을 선택 하 여 섹션 머리글과 차트에서 사용 되는 값 집합을 만들 때 내보낸 값을 활용 합니다. 선택 된 행이 없으면 섹션 머리글과 차트를 숨깁니다. 

예를 들어 두 번째 섹션의 hidden 매개 변수는 표에서 선택한 행의 다음 참조를 사용 합니다.

```
VMConnection
| where TimeGenerated {TimeRange}
| where Computer in ("{ComputerName}") or '*' in ("{ComputerName}") 
| summarize Sent = sum(BytesSent), Received = sum(BytesReceived) by bin(TimeGenerated, {TimeRange:grain})
```

## <a name="adding-metrics-sections"></a>메트릭 추가 섹션

메트릭 섹션에서는 Azure Monitor 메트릭 데이터를 대화형 보고서로 통합할 수 있는 모든 권한을 제공합니다. VM용 Azure Monitor 미리 작성 된 통합 문서는 일반적으로 메트릭 데이터가 아닌 분석 쿼리 데이터를 포함 합니다.  메트릭 데이터를 사용 하 여 통합 문서를 만들어 두 기능 모두를 모두 한 곳에서 최대한 활용할 수 있도록 선택할 수 있습니다. 액세스 권한이 있는 구독에 있는 리소스에서 메트릭 데이터를 가져올 수 있는 기능도 있습니다.

다음은 CPU 성능에 대 한 그리드 시각화를 제공 하기 위해 통합 문서로 끌어오는 가상 머신 데이터의 예입니다.

![VM용 Azure Monitor 통합 문서 섹션 편집 컨트롤](media/vminsights-workbooks/010-metrics-grid.png)

## <a name="adding-parameter-sections"></a>매개 변수 추가 섹션

통합 문서 매개 변수를 사용하면 쿼리 또는 텍스트 섹션을 수동으로 편집하지 않고 통합 문서에서 값을 변경할 수 있습니다. 그러면 기본 분석 쿼리 언어를 이해해야 하는 요구 사항을 제거하고 통합 문서 기반 보고의 잠재적인 대상을 크게 확장하게 됩니다.

``{parameterName}``과 같은 중괄호에서 매개 변수의 이름을 입력하여 쿼리, 텍스트 또는 다른 매개 변수 섹션에서 매개 변수 값을 대체합니다. 매개 변수 이름은 JavaScript 식별자, 알파벳 문자 또는 밑줄, 영숫자 문자 또는 밑줄 등의 유사한 규칙으로 제한 됩니다. 예를 들어 **a1**은 허용되지만, **1a**는 허용되지 않습니다.

매개 변수는 선형이며 통합 문서의 맨 위에서 시작하고 이후 단계까지 이어집니다.  나중에 통합 문서에서 선언 된 매개 변수는 이전에 선언 된 매개 변수를 재정의할 수 있습니다. 또한 쿼리를 사용 하 여 앞에서 정의한 매개 변수 값에 액세스 하는 매개 변수를 사용할 수 있습니다. 또한 매개 변수의 단계 자체 내에서 매개 변수는 왼쪽에서 오른쪽으로 이어지는 선형이며 여기서 오른쪽 매개 변수는 동일한 단계에서 이전에 선언된 매개 변수에 종속될 수 있습니다.
 
현재 지원 되는 네 가지 유형의 매개 변수는 다음과 같습니다.

|                  |      |
| ---------------- |:-----|
| **텍스트**    | 사용자가 텍스트 상자를 편집할 수 있으며, 선택적으로 기본값을 입력할 쿼리를 제공할 수 있습니다. |
| **드롭다운** | 사용자가 값 집합에서 선택할 수 있습니다. |
| **시간 범위 선택기**| 사용자가 미리 정의 된 시간 범위 값 집합에서 선택 하거나 사용자 지정 시간 범위에서 선택할 수 있습니다.|
| **리소스 선택기** | 사용자가 통합 문서에 대해 선택한 리소스에서 선택할 수 있습니다.|

### <a name="using-a-text-parameter"></a>텍스트 매개 변수 사용

텍스트 상자에 있는 사용자 형식의 값은 이스케이프 나 따옴표를 사용 하지 않고 쿼리에서 직접 대체 됩니다. 필요한 값이 문자열인 경우 쿼리는 매개 변수에 인용 부호를 표시해야 합니다(예: **'{parameter}'** ).

텍스트 매개 변수를 사용 하면 텍스트 상자의 값을 어디에서 나 사용할 수 있습니다. 테이블 이름, 열 이름, 함수 이름, 연산자 등이 될 수 있습니다.  Text 매개 변수 형식에는 **analytics 쿼리에서 기본값 가져오기**설정이 있으므로 통합 문서 작성자는 쿼리를 사용 하 여 해당 텍스트 상자의 기본값을 채울 수 있습니다.

로그 쿼리에서 기본값을 사용 하는 경우 첫 번째 행의 첫 번째 값 (0 행, 열 0)만 기본값으로 사용 됩니다. 따라서 하나의 행과 하나의 열만 반환하도록 쿼리를 제한하는 것이 좋습니다. 쿼리에서 반환된 다른 데이터는 무시됩니다. 

쿼리가 반환하는 값이 어떤 값이든지 이스케이프 또는 인용 부호 없이 직접 대체됩니다. 쿼리에서 행을 반환하지 않는 경우 매개 변수의 결과는 빈 문자열(매개 변수가 필요 없는 경우)이거나 정의되지 않습니다(매개 변수가 필수인 경우).

### <a name="using-a-drop-down"></a>드롭다운 사용

드롭다운 매개 변수 유형을 사용 하면 하나 이상의 값을 선택할 수 있는 드롭다운 컨트롤을 만들 수 있습니다.

드롭다운이 로그 쿼리 또는 JSON으로 채워집니다. 쿼리가 하나의 열을 반환 하는 경우 해당 열의 값은 모두 드롭다운 컨트롤의 값과 레이블입니다. 쿼리에서 두 개의 열을 반환 하는 경우 첫 번째 열은 값이 고 두 번째 열은 드롭다운에 표시 되는 레이블입니다. 쿼리가 세 개의 열을 반환 하는 경우 세 번째 열은 해당 드롭다운의 기본 선택 항목을 나타내는 데 사용 됩니다. 이 열은 어떤 형식이든 될 수 있지만 가장 간단한 형식은 부울 또는 숫자 형식입니다. 여기서 0은 false이고, 1은 true입니다.

열이 문자열 형식인 경우 null/비어 있는 문자열은 false로 간주되고, 다른 모든 값은 true로 간주됩니다. 단일 선택 드롭다운의 경우 true 값이 있는 첫 번째 값이 기본 선택 항목으로 사용 됩니다.  다중 선택 드롭다운의 경우 true 값이 있는 모든 값이 기본 선택 집합으로 사용 됩니다. 드롭다운의 항목은 쿼리가 반환 하는 행의 순서에 관계 없이 표시 됩니다. 

연결 개요 보고서에 있는 매개 변수를 살펴보겠습니다. **방향**옆의 편집 기호를 클릭 합니다.

![VM용 Azure Monitor 통합 문서 섹션 편집 컨트롤](media/vminsights-workbooks/011-workbook-using-dropdown.png)

그러면 **매개 변수 편집** 메뉴 항목이 시작 됩니다.

![VM용 Azure Monitor 통합 문서 섹션 편집 컨트롤](media/vminsights-workbooks/012-workbook-edit-parameter.png)

JSON을 사용 하면 콘텐츠로 채워진 임의의 테이블을 생성할 수 있습니다. 예를 들어 다음 JSON은 드롭다운에서 두 값을 생성 합니다.

```
[
    { "value": "inbound", "label": "Inbound"},
    { "value": "outbound", "label": "Outbound"}
]
```

더 적절 한 예는 드롭다운을 사용 하 여 성능 카운터 집합에서 이름으로 선택 하는 것입니다.

```
Perf
| summarize by CounterName, ObjectName
| order by ObjectName asc, CounterName asc
| project Counter = pack('counter', CounterName, 'object', ObjectName), CounterName, group = ObjectName
```

쿼리는 다음과 같이 결과를 표시합니다.

![성능 카운터 드롭다운](media/vminsights-workbooks/013-workbook-edit-parameter-perf-counters.png)

드롭다운은 대화형 보고서를 사용자 지정 하 고 만드는 매우 강력한 도구입니다.

### <a name="time-range-parameters"></a>시간 범위 매개 변수

드롭다운 매개 변수 형식을 통해 고유한 사용자 지정 시간 범위 매개 변수를 만들 수 있는 동시에 동일한 수준의 유연성이 필요하지 않는 경우 기본 시간 범위 매개 변수 형식을 사용할 수도 있습니다. 

시간 범위 매개 변수 형식에는 5분부터 최근 90일까지 이동하는 15개의 기본 범위가 포함됩니다. 사용자 지정 시간 범위 선택 영역을 허용하는 옵션이 있습니다. 이를 통해 보고서의 연산자가 시간 범위에 대해 명시적 시작 및 중지 값을 선택할 수 있습니다.

### <a name="resource-picker"></a>리소스 선택기

리소스 선택기 매개 변수 형식에서는 특정 형식의 리소스로 보고서 범위를 지정하는 기능을 제공합니다. 리소스 선택기 유형을 활용 하는 미리 작성 된 통합 문서의 예는 **성능** 통합 문서입니다.

![작업 영역 드롭다운](media/vminsights-workbooks/014-workbook-edit-parameter-workspaces.png)

## <a name="saving-and-sharing-workbooks-with-your-team"></a>팀과 통합 문서 저장 및 공유

통합 문서는 통합 문서 갤러리에 액세스 하는 방법에 따라 Log Analytics 작업 영역 또는 가상 머신 리소스 내에 저장 됩니다. 통합 문서는 사용자가 개인적으로 사용 하는 **내 보고서** 섹션 또는 리소스에 액세스할 수 있는 모든 사용자가 액세스할 수 있는 **공유 보고서** 섹션에 저장할 수 있습니다. 리소스에서 모든 통합 문서를 보려면 작업 모음에서 **열기** 단추를 클릭합니다.

현재 **내 보고서**에 있는 통합 문서를 공유하려면:

1. 작업 모음에서 **열기**를 클릭합니다.
2. 공유하려는 통합 문서 옆에 있는 "..." 단추를 클릭합니다.
3. **공유 보고서로 이동**을 클릭합니다.

링크 또는 전자 메일을 통해 통합 문서를 공유하려면 작업 모음에서 **공유**를 클릭합니다. 통합 문서를 보려면 링크의 수신자는 Azure Portal에서 이 리소스에 대한 액세스가 필요함을 명심하세요. 편집하려면 수신자는 최소한 리소스에 대한 참가자 권한이 필요합니다.

Azure 대시보드에 통합 문서에 대한 링크를 고정하려면:

1. 작업 모음에서 **열기**를 클릭합니다.
2. 고정하려는 통합 문서 옆에 있는 "..." 단추를 클릭합니다.
3. **대시보드에 고정**을 클릭합니다.

## <a name="next-steps"></a>다음 단계

- 제한 사항 및 전반적인 VM 성능을 식별 하려면 [AZURE VM 성능 보기](vminsights-performance.md)를 참조 하세요.

- 검색 된 응용 프로그램 종속성에 대 한 자세한 내용은 [View VM용 Azure Monitor Map](vminsights-maps.md)을 참조 하십시오.
