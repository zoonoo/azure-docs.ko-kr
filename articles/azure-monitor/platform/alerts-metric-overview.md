---
title: Azure Monitor에서 메트릭 경고가 작동하는 방식을 이해합니다.
description: 메트릭 경고로 수행할 수 있는 작업과 Azure Monitor에서 메트릭 경고가 작동하는 방식에 대한 개요를 제공합니다.
ms.date: 03/17/2020
ms.topic: conceptual
ms.subservice: alerts
ms.openlocfilehash: b6d8bc69a407838025c5e78e0a1c773ab457c409
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/28/2020
ms.locfileid: "79480235"
---
# <a name="understand-how-metric-alerts-work-in-azure-monitor"></a>Azure Monitor에서 메트릭 경고가 작동하는 방식 이해

Azure Monitor에서 메트릭 경고는 다차원 메트릭을 기반으로 작동합니다. 이 메트릭은 [플랫폼 메트릭](alerts-metric-near-real-time.md#metrics-and-dimensions-supported), [사용자 지정 메트릭](../../azure-monitor/platform/metrics-custom-overview.md), [메트릭으로 변환되는 Azure Monitor의 주요 로그](../../azure-monitor/platform/alerts-metric-logs.md) 및 Application Insights 메트릭일 수 있습니다. 메트릭 경고는 주기적으로 하나 이상의 메트릭 시계열에서 조건이 참인지 평가하고 평가에 부합하면 사용자에게 알립니다. 메트릭 경고는 상태를 저장합니다. 즉 상태가 변경될 때만 알림을 보냅니다.

## <a name="how-do-metric-alerts-work"></a>메트릭 경고 작동 방식

모니터링할 대상 리소스, 메트릭 이름, 조건 형식(정적 또는 동적) 및 조건(연산자 및 임계값/민감도), 경고 규칙 실행 시에 트리거할 작업 그룹을 지정하여 메트릭 경고 규칙을 정의할 수 있습니다. 조건 형식은 임계값을 결정하는 방법에 영향을 줍니다. [동적 임계값 조건 형식 및 민감도 옵션에 대해 자세히 알아보세요](alerts-dynamic-thresholds.md).

### <a name="alert-rule-with-static-condition-type"></a>정적 조건 형식이 있는 경고 규칙

다음과 같이 간단한 정적 임계값 메트릭 경고 규칙을 만들었다고 가정해 보겠습니다.

- 대상 리소스(모니터링할 Azure 리소스): myVM
- 메트릭: 백분율 CPU
- 조건 유형: 정적
- 시간 집계(원시 메트릭 값에 대해 실행되는 통계. 지원되는 시간 집계는 최소, 최대, 평균, 합계, 개수: 평균
- 기간(메트릭 값이 확인된 기간 뒤로 보기): 지난 5분 동안
- 빈도(조건이 충족되는 경우 메트릭 경고가 확인하는 빈도): 1분
- 연산자: 보다 큰
- 임계값: 70

경고 규칙이 만들어진 시점 이후 모니터는 1분 간격으로 실행되며 지난 5분 간의 메트릭 값을 살펴 이 평균이 70을 초과하는지 확인합니다. 조건에 부합하면, 즉 지난 5분의 평균 백분율 CPU가 70을 초과하면 경고 규칙에서 활성화된 알림을 생성합니다. 경고 규칙과 연결된 작업 그룹에서 이메일이나 웹후크 작업을 구성한 경우 모두 활성화된 알림을 받게 됩니다.

한 규칙에서 여러 조건을 사용하는 경우 규칙은 조건을 함께 "ands"합니다.  즉, 경고의 모든 조건이 true로 평가되고 조건 중 하나가 더 이상 true가 아닌 경우 해결될 때 경고가 발생합니다. 그리고 이러한 유형의 경고의 예로는 "CPU가 90% 이상"과 "대기열 길이가 300개 항목을 초과"하는 경우 경고가 표시됩니다. 

### <a name="alert-rule-with-dynamic-condition-type"></a>동적 조건 형식이 있는 경고 규칙

다음과 같이 간단한 동적 임계값 메트릭 경고 규칙을 만들었다고 가정해 보겠습니다.

- 대상 리소스(모니터링할 Azure 리소스): myVM
- 메트릭: 백분율 CPU
- 조건 유형: 동적
- 시간 집계(원시 메트릭 값에 대해 실행되는 통계. 지원되는 시간 집계는 최소, 최대, 평균, 합계, 개수: 평균
- 기간(메트릭 값이 확인된 기간 뒤로 보기): 지난 5분 동안
- 빈도(조건이 충족되는 경우 메트릭 경고가 확인하는 빈도): 1분
- 연산자: 보다 큰
- 감도: 중간
- 기간을 되돌아보기: 4
- 위반 건수: 4

경고 규칙이 만들어지면 동적 임계값 기계 학습 알고리즘에서 사용 가능한 기록 데이터를 가져오고 메트릭 계열 동작 패턴에 가장 적합한 임계값을 계산하며, 새 데이터를 기반으로 하여 지속적으로 학습하여 임계값을 더 정확하게 만듭니다.

경고 규칙이 만들어지는 시점부터 모니터는 1분마다 실행되고, 5분 기간으로 그룹화된 지난 20분 동안의 메트릭 값을 파악하며, 각 4개 기간에 대한 기간 값의 평균이 예상 임계값을 초과하는지 확인합니다. 지난 20분(4개의 5분 단위 기간)의 평균 CPU 백분율이 예상된 동작에서 네 번 벗어나는 조건이 충족되면 경고 규칙에서 활성화된 알림을 실행합니다. 경고 규칙과 연결된 작업 그룹에서 이메일이나 웹후크 작업을 구성한 경우 모두 활성화된 알림을 받게 됩니다.

### <a name="view-and-resolution-of-fired-alerts"></a>실행된 경고 보기 및 해결

위의 경고 규칙 실행 예는 Azure Portal의 **모든 경고** 블레이드에서도 확인할 수 있습니다.

후속 검사에서 "myVM"의 사용량이 임계값을 계속 초과하면 해당 조건이 해결될 때까지 경고 규칙이 다시 실행되지 않습니다.

잠시 후 "myVM"에 대한 사용이 다시 정상으로 내려갑니다(임계값 아래로 이동). 경고 규칙은 해결 알림을 보내기 위해 두 번 이상 조건을 모니터링합니다. 조건이 유동적인 경우 소음을 줄이기 위해 세 번 연속 경고 조건에 부합하지 않으면 경고 규칙에서 해결/비활성화 메시지를 보냅니다.

해결됨 알림은 웹후크 또는 이메일을 통해 전송되므로 Azure Portal의 경고 인스턴스 상태(모니터 상태라고도 함)도 해결됨으로 설정됩니다.

### <a name="using-dimensions"></a>차원 사용

Azure Monitor의 메트릭 경고는 하나의 규칙을 사용하여 여러 차원의 값 조합을 모니터링하는 기능도 지원합니다. 예제를 통해 여러 차원 값 조합을 사용할 수 있는 이유를 살펴 보겠습니다.

웹 사이트에 대해 App Service 계획은 있다고 가정합니다. 웹 사이트/앱을 실행하는 여러 인스턴스의 CPU 사용량을 모니터링하려 합니다. 이 작업은 다음과 같은 메트릭 경고 규칙을 사용하여 수행할 수 있습니다.

- 대상 리소스: myAppServicePlan
- 메트릭: 백분율 CPU
- 조건 유형: 정적
- 차원
  - 인스턴스 = InstanceName1, InstanceName2
- 시간 집계: 평균
- 기간: 지난 5분
- 빈도: 1분
- 연산자: GreaterThan
- 임계값: 70

이전과 같이 이 규칙은 최근 5분 동안 평균 CPU 사용량이 70%를 초과하는지 모니터링합니다. 그러나 같은 규칙으로 웹 사이트에서 실행되는 두 인스턴스를 모니터링할 수 있습니다. 각 인스턴스는 개별적으로 모니터링되며 알림도 개별적으로 받게 됩니다.

수요가 큰 웹앱이 있고 다른 인스턴스를 더 추가해야 한다고 가정합니다. 위 규칙에서는 두 인스턴스만 모니터링합니다. 그러나 다음과 같이 규칙을 만들 수 있습니다.

- 대상 리소스: myAppServicePlan
- 메트릭: 백분율 CPU
- 조건 유형: 정적
- 차원
  - 인스턴스 = *
- 시간 집계: 평균
- 기간: 지난 5분
- 빈도: 1분
- 연산자: GreaterThan
- 임계값: 70

이 규칙은 자동으로 인스턴스의 모든 값을 모니터링합니다. 즉 메트릭 경고 규칙을 다시 수정하지 않고도 그대로 인스턴스를 모니터링할 수 있습니다.

여러 차원을 모니터링하는 경우 동적 임계값 경고 규칙은 한 번에 수백 개의 메트릭 계열에 대한 맞춤형 임계값을 만들 수 있습니다. 동적 임계값으로 인해 관리할 경고 규칙이 줄어들고 경고 규칙의 관리 및 만들기에 걸리는 시간이 크게 절약할 수 있습니다.

많은 인스턴스가 있는 웹앱이 있고 가장 적합한 임계값을 알지 못한다고 가정합니다. 위의 규칙에서는 항상 70%의 임계값을 사용합니다. 그러나 다음과 같이 규칙을 만들 수 있습니다.

- 대상 리소스: myAppServicePlan
- 메트릭: 백분율 CPU
- 조건 유형: 동적
- 차원
  - 인스턴스 = *
- 시간 집계: 평균
- 기간: 지난 5분
- 빈도: 1분
- 연산자: GreaterThan
- 감도: 중간
- 기간을 되돌아보기: 1
- 위반 건수: 1

이 규칙은 지난 5분 동안의 평균 CPU 사용량이 각 인스턴스에 대해 예상된 동작을 초과하는지 모니터링합니다. 메트릭 경고 규칙을 다시 수정할 필요 없이 동일한 규칙에 따라 발생하는 인스턴스를 모니터링할 수 있습니다. 각 인스턴스에서 메트릭 계열 동작 패턴에 맞는 임계값을 가져오고, 새 데이터에 따라 지속적으로 변경되어 임계값을 더 정확하게 만듭니다. 이전과 마찬가지로 각 인스턴스는 개별적으로 모니터링되며 알림도 개별적으로 받게 됩니다.

되돌아 보기 기간과 위반 수를 늘리면 필터링 경고에서 크게 벗어나는 중요한 위반에 대한 정의만 경고하도록 허용할 수 있습니다. [동적 임계값 고급 옵션에 대해 자세히 알아보세요](alerts-dynamic-thresholds.md#what-do-the-advanced-settings-in-dynamic-thresholds-mean).

## <a name="monitoring-at-scale-using-metric-alerts-in-azure-monitor"></a>Azure Monitor에서 메트릭 경고를 사용한 모니터링 축소

지금까지 단일 메트릭 경고를 사용하여 단일 Azure 리소스와 관련된 하나 이상의 메트릭 시계열을 모니터링하는 방법을 확인했습니다. 많은 리소스에 동일한 경고 규칙을 적용하려는 경우가 많습니다. 또한 Azure Monitor는 동일한 Azure 지역에 있는 리소스에 대해 하나의 메트릭 경고 규칙을 통해 동일한 유형의 여러 리소스(동일한 유형)를 모니터링하는 것을 지원합니다. 

이 기능은 현재 다음 Azure 클라우드에서 다음 서비스에 대한 플랫폼 메트릭(사용자 지정 메트릭이 아님)에 대해 지원됩니다.

| 서비스 | 공용 Azure | 정부 | 중국 |
|:--------|:--------|:--------|:--------|
| 가상 머신  | **예** | 예 | 예 |
| SQL 서버 데이터베이스 | **예** | **예** | 예 |
| SQL 서버 탄력적 풀 | **예** | **예** | 예 |
| 데이터 박스 에지 장치 | **예** | **예** | 예 |

세 가지 방법 중 하나로 단일 메트릭 경고 규칙에 의해 모니터링 범위를 지정할 수 있습니다. 예를 들어 가상 컴퓨터를 사용하면 범위를 다음과 같이 지정할 수 있습니다.  

- 구독 내의 한 Azure 리전의 가상 시스템 목록
- 구독 내 하나 이상의 리소스 그룹에 있는 모든 가상 머신(한 Azure 지역에 있는)
- 구독의 모든 가상 머신(한 Azure 지역에 있는)

여러 리소스를 모니터링하는 메트릭 경고 규칙을 만드는 작업은 단일 리소스를 모니터링하는 [다른 메트릭 경고를 만드는](alerts-metric.md) 것과 같습니다. 차이점은 모니터링하려는 모든 리소스를 사용자가 선택한다는 것입니다. [Azure Resource Manager 템플릿](../../azure-monitor/platform/alerts-metric-create-templates.md#template-for-a-metric-alert-that-monitors-multiple-resources)을 통해 이러한 규칙을 만들 수도 있습니다. 모니터링되는 각 리소스에 대한 개별 알림을 받게 됩니다.

## <a name="typical-latency"></a>일반적인 대기 시간

메트릭 경고의 경우, 일반적으로 경고 규칙 빈도를 1분으로 설정하면 5분 안에 알림을 받게 됩니다. 알림 시스템에 부하가 높으면 대기 시간이 더 길어집니다.

## <a name="supported-resource-types-for-metric-alerts"></a>메트릭 경고에 대한 지원되는 리소스 종류

이 문서에서 지원되는 리소스 유형의 전체 목록을 찾을 수 [있습니다.](../../azure-monitor/platform/alerts-metric-near-real-time.md#metrics-and-dimensions-supported)


## <a name="next-steps"></a>다음 단계

- [Azure에서 메트릭 경고를 생성, 보기 및 관리하는 방법 알아보기](alerts-metric.md)
- [Azure Resource Manager 템플릿을 사용한 메트릭 경고 배포 방법 알아보기](../../azure-monitor/platform/alerts-metric-create-templates.md)
- [작업 그룹에 대해 자세히 알아보기](action-groups.md)
- [동적 임계값 조건 형식에 대해 자세히 알아봅니다](alerts-dynamic-thresholds.md).
