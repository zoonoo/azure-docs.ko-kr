---
title: 자동 크기 조정 모범 사례
description: Azure에서 Web Apps, Virtual Machine 확장 집합 및 Cloud Services에 대한 자동 크기 조정 패턴
author: anirudhcavale
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 07/07/2017
ms.author: ancav
ms.subservice: autoscale
ms.openlocfilehash: 3700fb90318da3787830f9b6c202436c0e45e2fe
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61063397"
---
# <a name="best-practices-for-autoscale"></a>자동 크기 조정에 대한 모범 사례
Azure Monitor 자동 크기 조정은 [가상 컴퓨터 확장 집합](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/) 및 [API Management 서비스](https://docs.microsoft.com/azure/api-management/api-management-key-concepts)에만 적용됩니다.

## <a name="autoscale-concepts"></a>자동 크기 조정 개념
* 하나의 리소스에는 *하나의* 자동 크기 조정 설정만 있을 수 있습니다.
* 자동 크기 조정 설정에는 하나 이상의 프로필이 있을 수 있으며, 각 프로필에는 하나 이상의 자동 크기 조정 규칙이 있을 수 있습니다.
* 자동 크기 조정 설정은 인스턴스 크기를 수평적으로 조정합니다. 즉, 인스턴스를 늘려 *규모를 확장*하고 인스턴스 수를 줄여 *규모를 감축*합니다.
  자동 크기 조정 설정에는 최대, 최소 및 기본 인스턴스 값이 있습니다.
* 자동 크기 조정 작업에서는 항상 규모 확장 또는 규모 감축에 대해 구성된 임계값에 도달했는지 확인하여 크기를 조정할 연관된 메트릭을 읽습니다. [Azure Monitor 자동 크기 조정 공통 메트릭](autoscale-common-metrics.md)에서 자동 크기 조정을 통해 크기를 조정할 수 있는 메트릭 목록을 볼 수 있습니다.
* 모든 임계값은 인스턴스 수준에서 계산됩니다. 예를 들어 "인스턴스 수가 2일 때 평균 CPU가 80%를 초과하면 1인스턴스만큼 규모 확장"은 모든 인스턴스에서 평균 CPU가 80%보다 높은 경우에 규모를 확장함을 의미합니다.
* 모든 자동 크기 조정 실패는 활동 로그에 기록됩니다. 그러므로 자동 크기 조정 오류가 있을 때마다 메일, SMS 또는 웹후크를 통해 알림을 받을 수 있도록 [활동 로그 경고](./../../azure-monitor/platform/activity-log-alerts.md)를 구성할 수 있습니다.
* 마찬가지로, 모든 성공한 크기 조정 작업도 활동 로그에 게시됩니다. 그러므로 성공한 자동 크기 조정 작업이 있을 때마다 메일, SMS 또는 웹후크를 통해 알림을 받을 수 있도록 활동 로그 경고를 구성할 수 있습니다. 또한 크기 조정 설정의 알림 탭을 통해 성공적인 크기 조정 작업에 대한 알림을 받도록 전자 메일 또는 웹후크 알림을 구성할 수도 있습니다.

## <a name="autoscale-best-practices"></a>자동 크기 조정 모범 사례
자동 크기 조정을 사용할 때 다음 모범 사례를 따르세요.

### <a name="ensure-the-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a>최댓값과 최솟값이 다르고 둘 사이의 간격이 적당한지 확인
최솟값=2, 최댓값=2 및 현재 인스턴스 수가 2인 설정이 있는 경우에는 발생할 수 있는 크기 조정 동작이 없습니다. 최대 인스턴스 수와 최소 인스턴스 수 간에 적당한 간격을 유지하세요(두 숫자 모두 포함). 자동 크기 조정은 항상 이러한 한도 사이에서 크기를 조정합니다.

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a>수동 크기 조정이 자동 크기 조정 최솟값 및 최댓값으로 다시 설정됨
인스턴스 수를 최댓값 위 또는 아래 값으로 수동으로 업데이트하면 자동 크기 조정 엔진이 최솟값(아래인 경우) 또는 최댓값(위인 경우)으로 다시 자동으로 크기를 조정합니다. 예를 들어 3 및 6 사이의 범위를 설정할 수 있습니다. 실행 중인 인스턴스가 하나 있는 경우 자동 크기 조정 엔진은 다음 실행 시 3개 인스턴스로 확장합니다. 마찬가지로, 크기 조정 인스턴스를 8개로 수동 설정하면 다음에 실행되는 자동 크기 조정에서는 그 다음 실행 시 6개 인스턴스로 다시 돌아갑니다.  수동 크기 조정은 자동 크기 조정 규칙을 재설정하지 않은 경우 임시적입니다.

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a>항상 증가 및 감소를 수행하는 규모 확장 및 감축 규칙 조합 사용
조합의 한 부분만 사용 하는 경우 자동 크기 조정 됩니다만 작업을 수행할 단일 방향 (out 또는 크기 조정)의 최대값에 도달 하거나 최소 인스턴스 수가 프로필에 정의 될 때까지. 이는 최적의 방법이 아니며 가용성을 보장하기 위해 사용률이 높은 시간에 이상적으로 리소스 규모를 확장할 수 있습니다. 마찬가지로 사용률이 낮은 시간에 리소스 규모를 축소하여 비용 절감을 실현할 수 있습니다.

### <a name="choose-the-appropriate-statistic-for-your-diagnostics-metric"></a>진단 메트릭에 적절한 통계 선택
진단 메트릭의 경우 크기를 조정할 메트릭으로 *평균*, *최소*, *최대* 및 *합계* 중에서 선택할 수 있습니다. 가장 일반적인 통계는 *평균*입니다.

### <a name="choose-the-thresholds-carefully-for-all-metric-types"></a>모든 메트릭 유형에 대해 신중하게 임계값 선택
현실적인 상황을 기반으로 서로 다른 규모 확장 및 규모 감축 임계값을 신중하게 선택하는 것이 좋습니다.

아래 예와 같이 확장 및 감축 조건에 동일하거나 매우 유사한 임계값을 사용하는 자동 크기 조정 설정은 *권장되지 않습니다*.

* 스레드 수가 600 이하인 경우 인스턴스 수 1개 증가
* 스레드 수가 600 이상인 경우 인스턴스 수 1개 감소

혼동스러운 동작을 초래할 수 있는 예를 살펴보겠습니다. 다음과 같은 시퀀스를 고려해 보세요.

1. 인스턴스 2개로 시작한 다음 인스턴스당 평균 스레드 수가 625로 증가했다고 가정해 보겠습니다.
2. 자동 크기 조정에서 세 번째 인스턴스를 추가하여 규모를 확장합니다.
3. 다음으로, 인스턴스 전체의 평균 스레드 수가 575로 떨어졌다고 가정해 보겠습니다.
4. 축소하기 전에 자동 크기 조정에서 감축된 경우의 최종 상태를 예측하려고 시도합니다. 예를 들어 575x3(현재 인스턴스 수) = 1,725/2(축소된 경우의 최종 인스턴스 수) = 862.5스레드입니다. 이는 평균 스레드 수가 동일하게 유지되거나 약간만 감소한 경우 자동 크기 조정에서 규모가 감축된 후 즉시 다시 확장해야 함을 의미합니다. 그러나 규모가 다시 확장된 경우 전체 프로세스가 반복되므로 무한 루프가 발생합니다.
5. 이 "느슨한" 상황을 방지하기 위해 자동 크기 조정에서는 규모를 축소하지 않습니다. 대신 건너뛰고 다음에 서비스의 작업이 실행될 때 조건을 다시 평가합니다. 이는 평균 스레드 수가 575일 때 자동 크기 조정이 작동하지 않는 것처럼 보이기 때문에 많은 사용자에게 혼동을 줄 수 있습니다.

규모 감축 동안의 예측은 확장 및 감축 작업이 지속적으로 발생하는 "플래핑" 상황을 방지하기 위한 것입니다. 규모 확장 및 감축에 대해 동일한 임계값을 선택할 때 이 동작을 염두에 두어야 합니다.

규모 확장 및 감축 임계값 사이에 적당한 간격을 선택하는 것이 좋습니다. 예를 들어, 다음과 같은 더 나은 규칙 조합을 고려합니다.

* CPU%가 80 이상인 경우 인스턴스 수 1개 증가
* CPU%가 60 이하인 경우 인스턴스 수 1개 감소

이 경우  

1. 두 개의 인스턴스로 시작한다고 가정합니다.
2. 인스턴스의 평균 CPU%가 80이 되면 자동 크기 조정에서 세 번째 인스턴스를 추가하여 규모를 확장합니다.
3. 이제 시간이 지남에 따라 CPU%가 60으로 감소했다고 가정합니다.
4. 자동 크기 조정의 규모 감축 규칙에서 규모가 감축된 경우의 최종 상태를 평가합니다. 예를 들어 60x3(현재 인스턴스 수) = 180/2(축소된 경우의 최종 인스턴스 수) = 90입니다. 따라서 자동 크기 조정에서는 즉시 다시 확장해야 하므로 규모를 감축하지 않습니다. 대신, 규모 축소를 건너뜁니다.
5. 다음 자동 크기 조정 확인 시 CPU는 계속해서 50으로 감소합니다. 다시 평가에서 50 x 3 인스턴스 = 150/2 인스턴스 = 75이며, 이는 규모 확장 임계값 80보다 낮으므로 인스턴스 2개로 성공적으로 감축합니다.

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a>특정 메트릭의 임계값 조정에 대한 고려 사항
 저장소 또는 Service Bus 큐 길이 메트릭과 같은 특정 메트릭의 경우 임계값은 현재 인스턴스 수당 사용 가능한 평균 메시지 수입니다. 이 메트릭에 대한 임계값을 신중하게 선택해야 합니다.

동작을 보다 잘 이해할 수 있도록 예를 들어 살펴보겠습니다.

* 저장소 큐 메시지 수가 50개 이상인 경우 인스턴스 수 1개 증가
* 저장소 큐 메시지 수가 10개 이하인 경우 인스턴스 수 1개 감소

다음과 같은 시퀀스를 고려해 보세요.

1. 2개의 저장소 큐 인스턴스가 있습니다.
2. 메시지가 계속 들어오고 있으며 저장소 큐를 검토했을 때 총 개수가 50개입니다. 자동 크기 조정에서 규모 확장 동작을 시작해야 한다고 생각할 수 있습니다. 그러나 인스턴스당 메시지 수는 여전히 50/2 = 25개입니다. 따라서 규모 확장이 발생하지 않습니다. 첫 번째 규모 확장이 발생하려면 저장소 큐의 총 메시지 수가 100개여야 합니다.
3. 이번에는 총 메시지 수가 100개에 도달했다고 가정합니다.
4. 규모 확장 동작으로 인해 세 번째 저장소 큐가 추가됩니다.  150/3 = 50이므로 큐의 총 메시지 수가 150개에 도달할 때까지 다음 규모 확장 동작이 발생하지 않습니다.
5. 이제 큐의 메시지 수가 작아집니다. 세 개의 인스턴스가 있는 경우, 인스턴스당 메시지 수는 규모 감축 임계값인 30/3 = 10개이므로 첫 번째 규모 감축 동작은 모든 큐의 총 메시지 수가 30개에 도달한 경우에 발생합니다.

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a>자동 크기 조정 설정에 여러 프로필이 구성된 경우 크기 조정에 대한 고려 사항
자동 크기 조정 설정에서 일정이나 시간에 종속되지 않고 항상 적용되는 기본 프로필을 선택하거나, 날짜 및 시간 범위가 있는 고정된 기간의 프로필 또는 되풀이 프로필을 선택할 수 있습니다.

자동 크기 조정 서비스는 이를 처리할 때 항상 다음 순서대로 확인합니다.

1. 고정된 날짜 프로필
2. 되풀이 프로필
3. 기본("항상") 프로필

프로필 조건이 충족된 경우 자동 크기 조정은 그 아래의 다음 프로필 조건을 확인하지 않습니다. 자동 크기 조정에서는 한 번에 하나의 프로필만 처리합니다. 따라서 하위 계층 프로필의 처리 조건을 포함하려는 경우 이러한 규칙을 현재 프로필에도 포함해야 합니다.

예제를 사용하여 이를 검토해 보겠습니다.

아래 그림에는 최소 인스턴스 = 2이고 최대 인스턴스 = 10인 기본 프로필의 자동 크기 조정 설정을 보여 줍니다. 이 예제에서는 큐의 메시지 수가 10보다 큰 경우 규모를 확장하고, 큐의 메시지 수가 3보다 작은 경우 규모를 감축하도록 규칙이 구성되어 있습니다. 따라서 지금은 리소스의 크기를 2에서 10 사이로 조정할 수 있습니다.

또한 월요일에 설정된 되풀이 프로필이 있습니다. 이는 최소 인스턴스 = 3, 최대 인스턴스 = 10에 대해 설정되어 있습니다. 따라서 월요일에는 자동 크기 조정에서 처음이 이 조건을 확인하여 인스턴스 수가 2인 경우 새 최소값 3으로 크기를 조정합니다. 자동 크기 조정에서 일치하는 이 프로필 조건을 계속 찾는 한 이 프로필에 대해 구성된 CPU 기반 규모 확장/감축 규칙만 처리합니다. 이 경우 큐 길이를 확인하지 않습니다. 그러나 큐 길이 조건도 확인하려는 경우 기본 프로필의 이러한 규칙을 월요일 프로필에도 포함해야 합니다.

마찬가지로, 자동 크기 조정이 다시 기본 프로필로 전환하는 경우에는 먼저 최솟값 및 최댓값 조건이 충족되는지 확인합니다. 이때 인스턴스 수가 12인 경우 기본 프로필에 허용되는 최댓값인 10으로 규모를 감축합니다.

![자동 크기 조정 설정](./media/autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a>하나의 프로필에 여러 규칙이 구성된 경우 크기 조정에 대한 고려 사항
하나의 프로필에 여러 규칙을 설정해야 할 수 있는 경우가 있습니다. 여러 규칙이 설정된 경우 다음과 같은 자동 크기 조정 규칙 집합이 서비스에서 사용됩니다.

*규모 확장*의 경우 임의의 규칙이 충족되면 자동 크기 조정이 실행됩니다.
*규모 감축*의 경우 모든 규칙이 충족되어야 자동 크기 조정이 실행됩니다.

이를 설명하기 위해 다음 4가지 자동 크기 조정 규칙이 있다고 가정합니다.

* CPU가 30% 미만인 경우 1만큼 규모 감축
* 메모리가 50% 미만인 경우 1만큼 규모 감축
* CPU가 75% 초과인 경우 1만큼 규모 확장
* 메모리가 75%를 초과하는 경우 1만큼 규모 확장

이 경우 다음 상황이 발생합니다.

* CPU가 76%이고 메모리가 50%인 경우 규모가 확장됩니다.
* CPU가 50%이고 메모리가 76%인 경우 규모가 확장됩니다.

반면, CPU가 25%이고 메모리가 51%인 경우 자동 크기 조정에서 규모를 감축하지 **않습니다**. 규모를 감축하려면 CPU가 29%이고 메모리가 49%여야 합니다.

### <a name="always-select-a-safe-default-instance-count"></a>항상 안전한 기본 인스턴스 수 선택
기본 인스턴스 수는 메트릭을 사용할 수 없을 때 자동 크기 조정에서 서비스 크기를 조정하는 인스턴스 수이므로 중요합니다. 따라서 워크로드에 안전한 기본 인스턴스 수를 선택해야 합니다.

### <a name="configure-autoscale-notifications"></a>자동 크기 조정 알림 구성
자동 크기 조정은 다음 조건 중 하나가 발생할 경우 활동 로그에 게시됩니다.

* 자동 크기 조정에서 크기 조정 작업이 생성되는 경우
* 자동 크기 조정 서비스에서 크기 조정 작업을 성공적으로 완료하는 경우
* 자동 크기 조정 서비스에서 크기 조정 작업에 실패한 경우.
* 자동 크기 조정 서비스에서 크기 조정 결정을 내리는 데 메트릭을 사용할 수 없는 경우.
* 크기 조정 결정을 내리는 데 메트릭을 다시 사용할 수 있게 된(복구) 경우.

또한 활동 로그 경고를 사용하여 자동 크기 조정 엔진의 상태를 모니터링할 수도 있습니다. 다음은 [구독의 모든 자동 크기 조정 엔진 작업을 모니터링하기 위한 활동 로그 경고 만들기](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) 또는 [구독에서 실패한 모든 자동 크기 조정 규모 감축/규모 확장 작업을 모니터링하기 위한 활동 로그 경고 만들기](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert) 예제입니다.

활동 로그 경고를 사용하는 것 외에, 크기 조정 설정의 알림 탭을 통해 성공적인 크기 조정 작업에 대한 알림을 받도록 전자 메일 또는 웹후크 알림을 구성할 수도 있습니다.

## <a name="next-steps"></a>다음 단계
- [구독의 모든 자동 크기 조정 엔진 작업을 모니터링하기 위한 활동 로그 경고를 만듭니다.](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [구독에서 실패한 모든 자동 크기 조정 규모 감축/규모 확장 작업을 모니터링하기 위한 활동 로그 경고를 만듭니다.](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)

