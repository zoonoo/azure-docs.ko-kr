---
title: Azure AD Domain Services에서 동기화가 작동하는 방식 | Microsoft Docs
description: Azure AD 테넌트나 온-프레미스 Active Directory Domain Services 환경에서 Azure Active Directory Domain Services 관리되는 도메인으로 개체와 자격 증명을 동기화하는 프로세스가 작동하는 방법을 알아봅니다.
services: active-directory-ds
author: justinha
manager: daveba
ms.assetid: 57cbf436-fc1d-4bab-b991-7d25b6e987ef
ms.service: active-directory
ms.subservice: domain-services
ms.workload: identity
ms.topic: conceptual
ms.date: 03/26/2021
ms.author: justinha
ms.openlocfilehash: 6b61bfbc1419b59d21e8db583b3a8aad5145494e
ms.sourcegitcommit: 7f59e3b79a12395d37d569c250285a15df7a1077
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 06/02/2021
ms.locfileid: "110785917"
---
# <a name="how-objects-and-credentials-are-synchronized-in-an-azure-active-directory-domain-services-managed-domain"></a>Azure Active Directory Domain Services 관리되는 도메인에서 개체 및 자격 증명을 동기화하는 방법

Azure AD DS(Azure Active Directory Domain Services) 관리되는 도메인의 개체와 자격 증명은 도메인에 로컬로 만들거나 Azure AD(Azure Active Directory) 테넌트에서 동기화할 수 있습니다. Azure AD DS를 처음 배포하면 자동 단방향 동기화가 구성되고 Azure AD에서 개체를 복제하기 시작합니다. 이 단방향 동기화는 백그라운드에서 계속 실행되므로 Azure AD의 변경된 내용을 적용하여 Azure AD DS 관리되는 도메인을 최신 상태로 유지합니다. Azure AD DS에서 Azure AD로 다시 동기화되지 않습니다.

하이브리드 환경에서는 Azure AD Connect를 사용하여 온-프레미스 AD DS 도메인의 개체와 자격 증명을 Azure AD에 동기화할 수 있습니다. 해당 개체가 Azure AD에 동기화되면 관리되는 도메인을 사용하는 애플리케이션에서 자동 백그라운드 동기화를 통해 해당 개체와 자격 증명을 사용할 수 있습니다.

온-프레미스 AD DS 및 Azure AD가 ADFS를 사용하는 페더레이션된 인증에 대해 구성된 경우 Azure DS에서 사용할 수 있는 (현재/유효한) 암호 해시가 없습니다. 공급 인증이 구현되기 전에 만든 Azure AD 사용자 계정에는 이전 암호 해시가 있지만 이는 온-프레미스 암호의 해시와 일치하지 않을 수 있습니다. 따라서 Azure AD DS는 사용자 자격 증명의 유효성을 검사할 수 없습니다.

다음 다이어그램은 Azure AD DS, Azure AD 및 선택적 온-프레미스 AD DS 환경 간에 동기화가 작동하는 방식을 보여 줍니다.

![Azure AD Domain Services 관리되는 도메인의 동기화 개요](./media/active-directory-domain-services-design-guide/sync-topology.png)

## <a name="synchronization-from-azure-ad-to-azure-ad-ds"></a>Azure AD에서 Azure AD DS로 동기화

사용자 계정, 그룹 멤버십 및 자격 증명 해시는 Azure AD에서 Azure AD DS로 단방향으로 동기화됩니다. 이 동기화 프로세스는 자동입니다. 이 동기화 프로세스를 구성하거나 모니터링하거나 관리할 필요가 없습니다. 초기 동기화는 Azure AD 디렉터리에 있는 개체의 수에 따라 몇 시간에서 며칠이 걸릴 수 있습니다. 초기 동기화가 완료된 후 암호 또는 특성 변경과 같이 Azure AD에서 변경된 내용은 Azure AD DS에 자동으로 동기화됩니다.

Azure AD에서 사용자를 만들면 Azure AD에서 암호를 변경해야 Azure AD DS에 동기화됩니다. 이 암호 변경 프로세스로 인해 Kerberos 및 NTLM 인증용 암호 해시가 생성되어 Azure AD에 저장됩니다. Azure AD DS에서 사용자를 인증하려면 암호 해시가 필요합니다.

동기화 프로세스는 설계상 단방향입니다. Azure AD DS에서 다시 Azure AD로 변경 내용을 역으로 동기화하지 않습니다. 관리되는 도메인은 사용자가 만들 수 있는 사용자 지정 OU를 제외하고는 대부분 읽기 전용입니다. 관리되는 도메인에서는 사용자 특성, 사용자 암호 또는 그룹 멤버 자격을 변경할 수 없습니다.

## <a name="attribute-synchronization-and-mapping-to-azure-ad-ds"></a>Azure AD DS의 특성 동기화와 매핑

다음 테이블에서는 일반적인 특성과 Azure AD DS에 동기화되는 방법을 보여 줍니다.

| Azure AD DS의 특성 | 원본 | 참고 |
|:--- |:--- |:--- |
| UPN | Azure AD 테넌트에 있는 사용자의 *UPN* 특성 | Azure AD 테넌트의 UPN 특성은 있는 그대로 Azure AD DS에 동기화됩니다. 관리되는 도메인에 로그인하는 가장 신뢰할 수 있는 방법은 UPN을 사용하는 것입니다. |
| SAMAccountName | Azure AD 테넌트에서 사용되거나 자동 생성된 사용자의 *mailNickname* 특성 | *SAMAccountName* 특성은 Azure AD 테넌트의 *mailNickname* 특성에서 제공됩니다. 여러 사용자 계정에 같은 *mailNickname* 특성이 있으면 *SAMAccountName* 이 자동으로 생성됩니다. 사용자의 *mailNickname* 또는 *UPN* 접두사가 20자보다 긴 경우에는 *SAMAccountName* 특성에 대한 20자 제한을 충족하기 위해 *SAMAccountName* 이 자동으로 생성됩니다. |
| 암호 | Azure AD 테넌트의 사용자 암호 | NTLM 또는 Kerberos 인증에 필요한 레거시 암호 해시는 Azure AD 테넌트에서 동기화됩니다. Azure AD Connect를 사용하여 하이브리드 동기화를 수행하도록 Azure AD 테넌트를 구성한 경우 해당 암호 해시는 온-프레미스 AD DS 환경에서 제공됩니다. |
| 기본 사용자/그룹 SID | Autogenerated | 사용자/그룹 계정의 주 SID는 Azure AD DS에서 자동으로 생성됩니다. 이 특성은 온-프레미스 AD DS 환경에 있는 개체의 기본 사용자/그룹 SID와 일치하지 않습니다. 이 불일치는 관리되는 도메인에 온-프레미스 AD DS 도메인과 다른 SID 네임스페이스가 있기 때문입니다. |
| 사용자 및 그룹에 대한 SID 기록 | 온-프레미스 기본 사용자 및 그룹 SID | Azure AD DS에 있는 사용자와 그룹의 *SidHistory* 특성은 온-프레미스 AD DS 환경의 해당 기본 사용자나 그룹 SID와 일치하도록 설정됩니다. 이 기능을 사용하면 리소스 ACL을 다시 만들 필요가 없으므로 온-프레미스 애플리케이션을 Azure AD DS로 더 쉽게 리프트 앤 시프트할 수 있습니다. |

> [!TIP]
> **UPN 형식을 사용하여 관리되는 도메인에 로그인** 관리되는 도메인의 일부 사용자 계정에 대해 `AADDSCONTOSO\driley`와 같은 *SAMAccountName* 특성이 자동으로 생성될 수 있습니다. 사용자의 자동 생성 *SAMAccountName* 은 UPN 접두사와 다를 수 있으므로, 항상 신뢰할 수 있는 로그인 방법은 아닙니다.
>
> 예를 들어 여러 사용자가 같은 *mailNickname* 특성을 사용하거나 사용자의 UPN 접두사가 너무 긴 경우 해당 사용자의 *SAMAccountName* 이 자동으로 생성될 수 있습니다. `driley@aaddscontoso.com`과 같은 UPN 형식을 사용하여 관리되는 도메인에 안정되게 로그인할 수 있습니다.

### <a name="attribute-mapping-for-user-accounts"></a>사용자 계정에 대한 특성 매핑

다음 테이블에서는 Azure AD의 사용자 개체에 대한 특정 특성이 Azure AD DS의 해당 특성에 동기화되는 방식을 보여 줍니다.

| Azure AD의 사용자 특성 | Azure AD DS의 사용자 특성 |
|:--- |:--- |
| accountEnabled |userAccountControl(ACCOUNT_DISABLED 비트를 설정하거나 지움) |
| city |l |
| companyName |companyName |
| country |co |
| department |department |
| displayName |displayName |
| employeeId |employeeId |
| facsimileTelephoneNumber |facsimileTelephoneNumber |
| givenName |givenName |
| jobTitle |title |
| mail |mail |
| mailNickname |msDS-AzureADMailNickname |
| mailNickname |SAMAccountName(자동 생성되는 경우도 있음) |
| manager |manager |
| mobile |mobile |
| objectid |msDS-AzureADObjectId |
| onPremiseSecurityIdentifier |sidHistory |
| passwordPolicies |userAccountControl(DONT_EXPIRE_PASSWORD 비트를 설정하거나 지움) |
| physicalDeliveryOfficeName |physicalDeliveryOfficeName |
| postalCode |postalCode |
| preferredLanguage |preferredLanguage |
| proxyAddresses | proxyAddresses |
| state |st |
| streetAddress |streetAddress |
| surname |sn |
| telephoneNumber |telephoneNumber |
| userPrincipalName |userPrincipalName |

### <a name="attribute-mapping-for-groups"></a>그룹에 대한 특성 매핑

다음 테이블에서는 Azure AD의 그룹 개체에 대한 특정 특성이 Azure AD DS의 해당 특성에 동기화되는 방식을 보여 줍니다.

| Azure AD의 그룹 특성 | Azure AD DS의 그룹 특성 |
|:--- |:--- |
| displayName |displayName |
| displayName |SAMAccountName(자동 생성되는 경우도 있음) |
| mail |mail |
| mailNickname |msDS-AzureADMailNickname |
| objectid |msDS-AzureADObjectId |
| onPremiseSecurityIdentifier |sidHistory |
| proxyAddresses | proxyAddresses |
| securityEnabled |groupType |

## <a name="synchronization-from-on-premises-ad-ds-to-azure-ad-and-azure-ad-ds"></a>온-프레미스 AD DS에서 Azure AD와 Azure AD DS로 동기화

Azure AD Connect는 사용자 계정, 그룹 멤버 자격, 자격 증명 해시를 온-프레미스 AD DS 환경에서 Azure AD로 동기화하는 데 사용됩니다. UPN과 온-프레미스 SID(보안 식별자)와 같은 사용자 계정의 특성이 동기화됩니다. Azure AD DS를 사용하여 로그인하려면 NTLM과 Kerberos 인증에 필요한 레거시 암호 해시도 Azure AD에 동기화됩니다.

> [!IMPORTANT]
> Azure AD Connect는 온-프레미스 AD DS 환경과의 동기화를 위해서만 설치되고 구성되어야 합니다. 개체를 Azure AD로 개체를 다시 동기화하기 위해 관리되는 도메인에 Azure AD Connect를 설치하는 것은 지원되지 않습니다.

다시 쓰기를 구성하면 Azure AD의 변경 사항이 온-프레미스 AD DS 환경으로 다시 동기화됩니다. 예를 들어 사용자가 Azure AD 셀프 서비스 암호 관리를 사용하여 암호를 변경하면 온-프레미스 AD DS 환경에서 암호가 다시 업데이트됩니다.

> [!NOTE]
> 모든 알려진 버그에 대한 수정 프로그램을 유지할 수 있도록 항상 최신 버전의 Azure AD Connect를 사용합니다.

### <a name="synchronization-from-a-multi-forest-on-premises-environment"></a>다중 포리스트 온-프레미스 환경에서의 동기화

많은 조직에는 여러 포리스트를 포함하는 상당히 복잡한 온-프레미스 AD DS 환경이 있습니다. Azure AD Connect는 다중 포리스트 환경에서 Azure AD로의 사용자, 그룹 및 자격 증명 해시 동기화를 지원합니다.

Azure AD에는 훨씬 간단한 단일 구조 네임스페이스가 있습니다. 사용자가 Azure AD에서 보호되는 애플리케이션에 안정적으로 액세스할 수 있도록 하려면 서로 다른 포리스트의 사용자 계정 간에 발생하는 UPN 충돌을 해결해야 합니다. 관리되는 도메인에서는 Azure AD와 비슷한 단일 OU 구조를 사용합니다. 온-프레미스에 계층적 OU 구조를 구성한 경우에도, 모든 사용자 계정과 그룹은 다른 온-프레미스 도메인이나 포리스트에서 동기화되더라도 *AADDC 사용자* 컨테이너에 저장됩니다. 관리되는 도메인은 모든 계층적 OU 구조를 평면화합니다.

앞서 설명한 대로 Azure AD DS에서 Azure AD로 다시 동기화하지 않습니다. Azure AD DS에서 [사용자 지정 OU(조직 구성 단위) 만들기](create-ou.md)를 수행한 다음, 해당 사용자 지정 OU의 사용자, 그룹 또는 서비스 계정을 만들 수 있습니다. 사용자 지정 OU에서 만든 개체는 Azure AD에 다시 동기화되지 않습니다. 해당 개체는 관리되는 도메인에서만 사용할 수 있으며 Azure AD PowerShell cmdlet, Microsoft Graph API 또는 Azure AD 관리 UI를 사용하여 표시되지 않습니다.

## <a name="what-isnt-synchronized-to-azure-ad-ds"></a>Azure AD DS에 동기화되지 않는 항목

다음 개체 또는 특성은 온-프레미스 AD DS 환경에서 Azure AD 또는 Azure AD DS로 동기화되지 않습니다.

* **제외된 특성:** Azure AD Connect를 사용하여 온-프레미스 AD DS 환경에서 Azure AD로의 동기화에서 특정 속성을 제외하도록 선택할 수 있습니다. 그러면 제외된 특성은 Azure AD DS에서 사용할 수 없습니다.
* **그룹 정책:** 온-프레미스 AD DS 환경에 구성된 그룹 정책은 Azure AD DS에 동기화되지 않습니다.
* **Sysvol 폴더:** 온-프레미스 AD DS 환경에 있는 *Sysvol* 폴더의 콘텐츠는 Azure AD DS에 동기화되지 않습니다.
* **컴퓨터 개체:** 온-프레미스 AD DS 환경에 조인된 컴퓨터의 컴퓨터 개체는 Azure AD DS와 동기화되지 않습니다. 해당 컴퓨터는 관리되는 도메인과 신뢰 관계가 없으며 온-프레미스 AD DS 환경에만 속합니다. Azure AD DS에서는 관리되는 도메인에 명시적으로 도메인 조인된 컴퓨터의 컴퓨터 개체만 표시됩니다.
* **사용자와 그룹의 SidHistory 특성:** 온-프레미스 AD DS 환경의 기본 사용자와 기본 그룹 SID는 Azure AD DS에 동기화됩니다. 그러나 사용자와 그룹의 기존 *SidHistory* 특성은 온-프레미스 AD DS 환경에서 Azure AD DS로 동기화되지 않습니다.
* **OU(조직 구성 단위) 구조:** 온-프레미스 AD DS 환경에 정의된 조직 구성 단위는 Azure AD DS와 동기화되지 않습니다. Azure AD DS에는 두 개의 기본 제공 OU가 있습니다. 하나는 사용자용이고 다른 하나는 컴퓨터용입니다. 관리되는 도메인은 단일 OU 구조를 가집니다. [관리되는 도메인에서 사용자 지정 OU 만들기](create-ou.md)를 선택할 수 있습니다.

## <a name="password-hash-synchronization-and-security-considerations"></a>암호 해시 동기화 및 보안 고려 사항

Azure AD DS를 사용하도록 설정하면 NTLM + Kerberos 인증을 위한 레거시 암호 해시가 필요합니다. Azure AD는 일반 텍스트 암호를 저장하지 않으므로 기존 사용자 계정에 대해 해당 해시를 자동으로 생성할 수 없습니다. 생성되어 저장되고 나면 NTLM과 Kerberos 호환 암호 해시는 Azure AD에서 항상 암호화된 방식으로 저장됩니다.

암호화 키는 Azure AD 테넌트마다 고유합니다. Azure AD DS가 암호 해독 키에 액세스할 수 있도록 해당 해시가 암호화됩니다. Azure AD의 다른 서비스나 구성 요소는 암호 해독 키에 액세스할 수 없습니다.

그런 다음 레거시 암호 해시는 Azure AD에서 관리되는 도메인의 도메인 컨트롤러로 동기화됩니다. Azure AD DS에서 관리되는 도메인 컨트롤러의 디스크는 미사용 시 암호화됩니다. 해당 암호 해시는 암호를 온-프레미스 AD DS 환경에서 저장하고 보호하는 방법과 비슷한 도메인 컨트롤러에 저장되고 보호됩니다.

클라우드 전용 Azure AD 환경에서 필요한 암호 해시를 생성하고 Azure AD에 저장하려면 [사용자가 암호를 재설정/변경해야 합니다 ](tutorial-create-instance.md#enable-user-accounts-for-azure-ad-ds). Azure AD Domain Services를 사용하도록 설정한 후에 Azure AD에서 만든 클라우드 사용자 계정의 경우 암호 해시는 NTLM 및 Kerberos 호환 형식으로 생성되고 저장됩니다. 모든 클라우드 사용자 계정은 Azure AD DS에 동기화되기 전에 암호를 변경해야 합니다.

Azure AD Connect를 사용하여 온-프레미스 AD DS 환경에서 동기화된 하이브리드 사용자 계정의 경우 [NTLM과 Kerberos 호환 형식으로 암호 해시를 동기화하도록 Azure AD Connect를 구성](tutorial-configure-password-hash-sync.md)해야 합니다.

## <a name="next-steps"></a>다음 단계

암호 동기화의 세부 사항에 관한 자세한 내용은 [Azure AD Connect에서 암호 해시 동기화가 작동하는 방식](../active-directory/hybrid/how-to-connect-password-hash-synchronization.md?context=/azure/active-directory-domain-services/context/azure-ad-ds-context)을 참조하세요.

Azure AD DS를 시작하려면 [관리되는 도메인을 만듭니다](tutorial-create-instance.md).
