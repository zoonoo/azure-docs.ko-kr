---
title: 방화벽 및 VNet 뒤로 액세스할 수 있는 스토리지 계정에 취약성 평가 검사 결과 저장
description: 방화벽 또는 VNet을 통해 액세스할 수 있는 스토리지 계정에서 VA(취약성 평가) 검색을 저장하는 방법에 대한 지침을 제공합니다.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: c2a8d9420485b10716619388f58afb01af5ea623
ms.sourcegitcommit: 80d311abffb2d9a457333bcca898dfae830ea1b4
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 05/26/2021
ms.locfileid: "110468844"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>방화벽 및 VNet 뒤로 액세스할 수 있는 스토리지 계정에 취약성 평가 검사 결과 저장
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

특정 VNet 또는 서비스에 대해 Azure에서 스토리지 계정에 대한 액세스를 제한하는 경우 SQL Database 또는 Managed Instances에 대한 VA(취약성 평가) 검색이 해당 스토리지 계정에 액세스할 수 있도록 적절한 구성을 사용해야 합니다.

## <a name="prerequisites"></a>전제 조건

SQL 취약성 평가 서비스는 기본 및 검사 결과를 저장하기 위해 스토리지 계정에 대한 권한이 필요합니다.  세 가지 방법이 있습니다. 
- **스토리지 계정 키 사용**: Azure가 SAS 키를 만들어 저장합니다(계정 키는 저장하지 않음).
- **스토리지 SAS 키 사용**: SAS 키에는 다음이 있어야 합니다. 쓰기 | 나열 | 읽기 | 권한 삭제
- **SQL Server 관리 ID 사용**: SQL Server에는 관리 ID가 있어야 합니다. 스토리지 계정에 StorageBlobContributor로 SQL 관리 ID에 대한 역할 할당이 있어야 합니다. 설정을 적용할 때 VA 필드 storageContainerSasKey 및 storageAccountAccessKey는 비어 있어야 합니다. 스토리지가 방화벽 또는 가상 네트워크 뒤에 있으면 SQL 관리 ID가 필요합니다. 

Azure Portal 사용하여 SQL VA 설정을 저장하는 경우 Azure는 관리 ID에 대한 새 역할 할당을 스토리지에 StorageBlobContributor로 할당할 수 있는 권한이 있는지 확인합니다. 사용 권한이 할당된 경우 Azure는 SQL Server 관리 ID를 사용하고 그렇지 않으면 Azure에서 키 메서드를 사용합니다. 

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>스토리지 계정에 대한 Azure SQL Database VA 검사 액세스 사용

특정 네트워크 또는 서비스에서만 액세스할 수 있도록 VA 스토리지 계정을 구성한 경우 Azure SQL Database 대한 VA 검사에서 스토리지 계정에 검색을 저장할 수 있는지 확인해야 합니다. 기존 스토리지 계정을 사용하거나 새 스토리지 계정을 만들어 [논리 SQL 서버](logical-servers.md)의 모든 데이터베이스에 대한 VA 검사 결과를 저장할 수 있습니다.

> [!NOTE]
> 취약성 평가 서비스는 스토리지 액세스 키가 필요한 경우 방화벽 또는 VNet으로 보호되는 스토리지 계정에 액세스할 수 없습니다.

스토리지 계정이 포함된 **리소스 그룹** 으로 이동하고 **스토리지 계정** 창에 액세스합니다. **설정** 에서 **방화벽 및 가상 네트워크** 를 선택합니다.

**이 스토리지 계정에 대한 신뢰할 수 있는 Microsoft 서비스 허용** 이 선택되어 있는지 확인합니다.

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="스크린샷은 신뢰할 수 있는 Microsoft 서비스가 이 스토리지 계정에 액세스하도록 허용이 선택된 방화벽 및 가상 네트워크 대화 상자를 보여 줍니다.":::

사용 중인 스토리지 계정을 확인하려면 [Azure Portal](https://portal.azure.com)의 **SQL 서버** 창으로 이동하고 **보안** 에서 **보안 센터** 를 선택합니다.

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="취약성 평가 설정":::

> [!NOTE]
> 조직의 사용자에게 검사 보고서를 보거나 액세스할 수 있도록 이메일 경고를 설정할 수 있습니다. 이렇게 하려면 SQL 보안 관리자 및 Storage Blob 데이터 읽기 권한자 권한이 있는지 확인합니다.

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>방화벽 또는 VNet 뒤에서 액세스할 수 있는 스토리지 계정에 Azure SQL Managed Instance에 대한 VA 검사 결과를 저장합니다.

Managed Instance 신뢰할 수 있는 Microsoft 서비스가 아니며 스토리지 계정과 다른 VNet을 가지고 있기 때문에 VA 검사를 실행하면 오류가 발생합니다.

Managed Instance에서 VA 검사를 지원하려면 다음 단계를 수행합니다.

1. **SQL 관리 인스턴스** 창의 **개요** 제목 아래에서 **가상 네트워크/서브넷** 링크를 클릭합니다. **가상 네트워크** 창으로 이동합니다.

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="mi-overview2":::

1. **설정** 에서 **서브넷** 을 선택합니다. 새 창에서 **서브넷** 을 클릭하여 서브넷을 추가하고 *Microsoft.Sql\managedInstance* 에 위임합니다. 자세한 내용은 [서브넷 관리](../../virtual-network/virtual-network-manage-subnet.md)를 참조하세요.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="스크린샷은 Microsoft.sql\managedInstance에 위임된 서브넷을 보여 줍니다.":::

1. **가상 네트워크** 창의 **설정** 에서 **서비스 엔드포인트** 를 선택합니다. 새 창에서 **추가** 를 클릭하고 *Microsoft.Storage* 서비스를 새 서비스 엔드포인트로 추가합니다. *ManagedInstance* 서브넷이 선택되었는지 확인합니다. **추가** 를 클릭합니다.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="스크린샷은 Microsoft.Storage 서비스를 엔드포인트로 추가하는 서비스 엔드포인트 추가를 보여 줍니다.":::

1. VA 검사를 저장하기 위해 선택한 **스토리지 계정** 으로 이동합니다. **설정** 에서 **방화벽 및 가상 네트워크** 를 선택합니다. **기존 가상 네트워크 추가** 를 클릭합니다. 관리되는 인스턴스 가상 네트워크 및 서브넷을 선택하고 **추가** 를 클릭합니다.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="스크린샷은 기존 가상 네트워크 추가 링크가 포함된 방화벽 및 가상 네트워크 창을 보여 줍니다.":::

이제 스토리지 계정에 Managed Instance에 대한 VA 검사를 저장할 수 있습니다.

## <a name="troubleshoot-vulnerability-assessment-scan-related-issues"></a>취약성 평가 검사 관련 문제 해결 

취약성 평가 검사와 관련된 일반적인 문제를 해결합니다.

### <a name="failure-to-save-vulnerability-assessment-settings"></a>취약성 평가 설정을 저장하지 못함

스토리지 계정이 일부 필수 구성을 충족하지 않거나 권한이 부족한 경우 취약성 평가 설정에 대한 변경 내용을 저장하지 못할 수 있습니다.

#### <a name="storage-account-requirements"></a>스토리지 계정 요구 사항

취약성 평가 검사 결과를 저장하는 스토리지 계정은 다음 요구 사항을 충족해야 합니다.

- **유형**: StorageV2(범용 V2) 또는 스토리지(범용 V1)
- **성능**: Standard(전용)
- **지역**: Azure SQL Server의 인스턴스와 동일한 지역에 스토리지가 있어야 합니다.

이러한 요구 사항이 충족되지 않으면 취약성 평가 설정에 대한 변경 내용 저장이 실패합니다.

#### <a name="permissions"></a>권한 

취약성 평가 설정에 대한 변경 내용을 저장하려면 다음 권한이 필요합니다.

- SQL 보안 관리자
- Storage Blob 데이터 읽기 권한자

새 역할 할당을 설정하려면 스토리지 계정에 대한 소유자 또는 사용자 관리자 액세스 권한과 다음 권한이 필요합니다.

- Storage Blob 데이터 소유자

### <a name="storage-account-isnt-visible-for-selection-in-vulnerability-assessment-settings"></a>취약성 평가 설정에서 스토리지 계정을 선택할 수 없습니다.

스토리지 계정은 다음과 같은 여러 가지 이유로 스토리지 계정 선택기에 표시되지 않을 수 있습니다.

- 찾고 있는 스토리지 계정이 선택한 구독에 없습니다.
- 찾고있는 스토리지 계정이 Azure SQL Server 인스턴스와 동일한 지역에 없습니다.
- 스토리지 계정에 대한 Microsoft.Storage/storageAccounts/read 권한이 없습니다.

### <a name="failure-to-open-an-email-link-for-scan-results-or-cant-view-scan-results"></a>검사 결과에 대한 이메일 링크를 열지 못하거나 검사 결과를 볼 수 없습니다.

필요한 권한이 없거나 검색 결과 열기 또는 표시를 지원하지 않는 브라우저를 사용하는 경우 검색 결과에 대한 알림 이메일의 링크를 열거나 검사 결과를 볼 수 없습니다.

#### <a name="permissions"></a>권한

검사 결과에 대한 이메일 알림의 링크를 열거나 검사 결과를 보려면 다음 권한이 필요합니다.

- SQL 보안 관리자
- Storage Blob 데이터 읽기 권한자

#### <a name="browser-requirements"></a>브라우저 요구 사항

Firefox 브라우저는 검사 결과 보기 열기 또는 표시를 지원하지 않습니다. Chrome 또는 Microsoft Edge 사용하여 취약성 평가 검사 결과를 보는 것이 좋습니다.

## <a name="next-steps"></a>다음 단계

- [취약성 평가](sql-vulnerability-assessment.md)
- [Azure Storage 계정 만들기](../../storage/common/storage-account-create.md)
- [Azure Defender for SQL](azure-defender-for-sql.md)
