---
ms.assetid: ''
title: Azure Key Vault 일시 삭제 | Microsoft Docs
ms.service: key-vault
ms.topic: conceptual
author: msmbaldwin
ms.author: mbaldwin
manager: barbkess
ms.date: 09/25/2017
ms.openlocfilehash: 526b0b135c8d5c1741ddf5f3fe6fb32f259a3e2c
ms.sourcegitcommit: 2d0fb4f3fc8086d61e2d8e506d5c2b930ba525a7
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/18/2019
ms.locfileid: "58092993"
---
# <a name="azure-key-vault-soft-delete-overview"></a>Azure Key Vault 일시 삭제 개요

Key Vault의 일시 삭제 기능을 사용하면 삭제된 자격 증명 모음 및 자격 증명 모음 개체를 복구할 수 있습니다. 특히 다음과 같은 시나리오를 다룹니다.

- Key Vault의 복구 가능한 삭제 지원
- 주요 자격 증명 모음 개체(예: 키, 암호, 인증서)의 복구 가능한 삭제 지원

## <a name="supporting-interfaces"></a>인터페이스 지원

일시 삭제 기능은 처음에 REST, .NET/C#, PowerShell 및 CLI 인터페이스를 통해 제공됩니다.

일반적인 정보는 다음을 참조하고 자세한 내용은 [Key Vault 참조](https://docs.microsoft.com/azure/key-vault/)를 참조하세요.

## <a name="scenarios"></a>시나리오

Azure Key Vault는 Azure Resource Manager에서 관리하는 추적된 리소스입니다. Azure Resource Manager는 삭제 작업에 성공할 경우 리소스에 더 이상 액세스할 수 없도록 요구하는 잘 정의된 삭제 동작도 지정합니다. 일시 삭제 기능은 삭제가 실수인지, 의도적인 것인지에 관계없이 삭제된 개체의 복구를 처리합니다.

1. 일반적인 시나리오에서 사용자가 주요 자격 증명 모음 또는 주요 자격 증명 모음 개체를 실수로 삭제했을 수도 있습니다. 해당 주요 자격 증명 모음 또는 주요 자격 증명 모음 개체가 미리 정해진 기간 동안 복구할 수 있는 경우 사용자가 삭제를 취소하고 해당 데이터를 복구할 수 있습니다.

2. 다른 시나리오에서는 Rogue 사용자가 주요 자격 증명 모음 또는 주요 자격 증명 모음 개체(예: 자격 증명 모음 내의 키)를 삭제하려고 시도하여 비즈니스 중단이 발생할 수 있습니다. 예를 들어 데이터 삭제 권한을 다른 신뢰할 수 있는 역할로 제한하여 주요 자격 증명 모음 또는 주요 자격 증명 모음 개체 삭제와 기본 데이터의 실제 삭제 분리를 보안 조치로 사용할 수 있습니다. 이 접근법에는 즉각적인 데이터 손실을 초래할 수 있는 작업에 대한 쿼럼이 필요합니다.

### <a name="soft-delete-behavior"></a>일시 삭제 동작

이 기능을 사용할 경우 Key Vault 또는 Key Vault 개체에 대한 DELETE 작업은 일시 삭제로 수행됩니다. 즉, 지정된 보존 기간(90일) 동안 리소스가 유지되며 개체는 삭제된 것으로 표시됩니다. 또한 서비스는 삭제된 개체를 복구하고 기본적으로 삭제를 취소하는 메커니즘을 제공합니다. 

일시 삭제는 선택적 Key Vault 동작이며, 이 릴리스에서 **기본적으로 사용되지 않습니다**. 

### <a name="purge-protection--flag"></a>보호 플래그 제거
제거 보호(Azure CLI의 **--enable-purge-protection**) 플래그는 기본적으로 해제되어 있습니다. 이 플래그를 설정하면 보존 기간인 90일이 지날 때까지 삭제된 상태의 자격 증명 모음이나 개체를 제거할 수 없습니다. 즉, 이러한 자격 증명 모음 또는 개체는 여전히 복구할 수 있는 상태입니다. 고객은 이 플래그를 설정함으로써 보존 기간이 지날 때까지는 자격 증명 모음이나 개체가 영구적으로 삭제되지 않도록 할 수 있습니다. 제거 보호 플래그는 일시 삭제 플래그가 설정되어 있는 경우에만 설정할 수 있습니다. 또는 자격 증명 모음 생성 시에 일시 삭제와 제거 보호를 모두 설정할 수 있습니다.

> [!NOTE]
>    제거 보호 설정을 위한 필수 조건은 일시 삭제를 설정해야 한다는 것입니다.
> Azure CLI 2에서 일시 삭제를 설정하는 명령은 다음과 같습니다.

```
az keyvault create --name "VaultName" --resource-group "ResourceGroupName" --location westus --enable-soft-delete true --enable-purge-protection true
```

### <a name="permitted-purge"></a>허용된 제거

프록시 리소스에 대한 POST 작업을 통해 주요 자격 증명 모음을 영구 삭제, 즉 제거할 수 있으며, 특별한 권한이 필요합니다. 일반적으로 구독 소유자만 주요 자격 증명 모음을 제거할 수 있습니다. POST 작업은 해당 자격 증명 모음에 대해 즉각적이고 복구할 수 없는 삭제를 트리거합니다. 

이 규칙의 예외는 다음과 같습니다.
- Azure 구독이 *삭제할 수 없음*으로 표시된 경우. 이 경우 서비스는 실제 삭제만 수행할 수 있으며, 예약된 프로세스로 삭제합니다. 
- 자격 증명 모음 자체에서 --enable-purge-protection 플래그가 사용하도록 설정되어 있는 경우. 이 경우 Key Vault는 원래 비밀 개체가 삭제 대상으로 표시된 시점으로부터 90일 동안 기다렸다가 개체를 영구적으로 삭제합니다.

### <a name="key-vault-recovery"></a>주요 자격 증명 모음 복구

Key Vault를 삭제하면 서비스가 구독 아래에 프록시 리소스를 만들고 복구하는 데 충분한 메타데이터를 추가합니다. 프록시 리소스는 삭제된 주요 자격 증명 모음과 동일한 위치에서 사용할 수 있는 저장된 개체입니다. 

### <a name="key-vault-object-recovery"></a>주요 자격 증명 모음 개체 복구

키 등의 주요 자격 증명 모음 개체를 삭제하면 서비스가 개체를 삭제된 상태로 배치하므로 검색 작업에서 개체에 액세스할 수 없게 됩니다. 이 상태의 Key Vault 개체는 나열, 복구 또는 강제로/영구 삭제할 수만 있습니다. 

이와 동시에 주요 Key Vault는 미리 정해진 보존 간격 후에 실행하기 위해 삭제된 주요 자격 증명 모음 또는 주요 자격 증명 모음 개체에 해당하는 기본 데이터의 삭제를 예약합니다. 자격 증명 모음에 해당하는 DNS 레코드도 보존 간격 기간 동안 유지됩니다.

### <a name="soft-delete-retention-period"></a>일시 삭제 보존 기간

일시 삭제된 리소스는 설정된 기간, 즉 90일 동안 유지됩니다. 일시 삭제 보존 간격 중에는 다음이 적용됩니다.

- 구독에 대한 일시 삭제 상태의 주요 자격 증명 모음 및 주요 자격 증명 모음 개체를 모두 나열하고 해당 항목에 대한 삭제 및 복구 정보에 액세스할 수 있습니다.
    - 특수 사용 권한이 있는 사용자만 삭제된 자격 증명 모음을 나열할 수 있습니다. 사용자가 삭제된 자격 증명 모음 처리를 위해 이러한 특수 사용 권한을 가진 사용자 지정 역할을 만드는 것이 좋습니다.
- 동일한 위치에 동일한 이름의 주요 자격 증명 모음을 만들 수는 없습니다. 마찬가지로, 주요 자격 증명 모음에 삭제된 상태인 동일한 이름의 개체가 포함된 경우 지정된 자격 증명 모음에 해당 주요 자격 증명 모음 개체를 만들 수 없습니다. 
- 특별한 권한이 있는 사용자만 해당 프록시 리소스에서 복구 명령을 실행하여 주요 자격 증명 모음 또는 주요 자격 증명 모음 개체를 복원할 수 있습니다.
    - 리소스 그룹 아래에 주요 자격 증명 모음을 만들 수 있는 권한을 가진, 사용자 지정 역할의 멤버인 사용자는 자격 증명 모음을 복원할 수 있습니다.
- 특별한 권한이 있는 사용자만 해당 프록시 리소스에서 삭제 명령을 실행하여 주요 자격 증명 모음 또는 주요 자격 증명 모음 개체를 강제로 삭제할 수 있습니다.

Key Vault 또는 Key Vault 개체를 복구하지 않으면 보존 간격이 끝난 후 서비스가 일시 삭제된 Key Vault 또는 Key Vault 개체와 해당 내용을 제거합니다. 리소스 삭제를 다시 예약하지 못할 수 있습니다.

### <a name="billing-implications"></a>요금 청구 영향

일반적으로 개체(키 자격 증명 모음 또는 암호)가 삭제된 상태인 경우 '제거' 및 '복구'라는 두 개의 작업만 가능합니다. 다른 모든 작업이 실패합니다. 따라서 개체가 있는 경우라도 어떤 작업도 수행할 수 없게 되고 사용량이 발생하지 않아 청구도 없습니다. 그러나 다음과 같은 예외가 있습니다.

- '제거' 및 '복구' 작업은 일반 키 자격 증명 모음 작업에 포함됨에 따라 요금이 청구됩니다.
- 개체가 HSM 키인 경우 키 버전이 지난 30일 안에 사용됐다면 월 요금별 키 버전당 'HSM 보호 키' 요금이 적용됩니다. 그 후 개체가 삭제된 상태이기 때문에 아무 작업도 수행할 수 없게 되고 요금도 적용되지 않습니다.

## <a name="next-steps"></a>다음 단계

다음 두 가이드는 일시 삭제 사용에 대한 기본 사용 시나리오를 제공합니다.

- [PowerShell로 Key Vault 일시 삭제를 사용하는 방법](key-vault-soft-delete-powershell.md) 
- [CLI로 Key Vault 일시 삭제를 사용하는 방법](key-vault-soft-delete-cli.md)

