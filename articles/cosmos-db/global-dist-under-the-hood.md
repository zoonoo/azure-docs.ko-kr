---
title: Azure Cosmos DB를 사용한 전역 배포 - 기본적인 이해
description: 이 문서에서는 Azure Cosmos DB의 글로벌 배포와 관련된 기술 세부 정보를 제공합니다.
author: dharmas-cosmos
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 03/31/2019
ms.author: dharmas
ms.reviewer: sngun
ms.openlocfilehash: 84ce13ae3bb0a4b66b8167e61b720fe6cecbe95c
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/23/2019
ms.locfileid: "60888836"
---
# <a name="global-data-distribution-with-azure-cosmos-db---under-the-hood"></a>Azure Cosmos DB를 사용한 전역 데이터 배포 - 기본적인 이해

Azure Cosmos DB, Azure의 기본 서비스 이므로 공용, sovereign, 국방부 (DoD) 및 government 클라우드를 포함 하 여 전 세계 모든 Azure 지역에서 배포 됩니다. 데이터 센터 내에서 Azure Cosmos DB를 각각 전용 로컬 스토리지가 있는 대규모 스탬프의 머신에 배포 및 관리합니다. 데이터 센터 내에서 Azure Cosmos DB는 여러 클러스터로 배포되며 각각은 여러 세대의 하드웨어를 잠재적으로 실행할 수 있습니다. 클러스터 내 컴퓨터 10 ~ 20 개의 장애 도메인 지역 내에서 고가용성을 위해 일반적으로 분산 됩니다. 다음 이미지에서는 Cosmos DB 글로벌 배포 시스템 토폴로지를 보여 줍니다.

![시스템 토폴로지](./media/global-dist-under-the-hood/distributed-system-topology.png)

**턴키 글로벌 배포 Azure Cosmos DB에 같습니다.** 언제 든 몇 번의 클릭으로 또는 단일 API 호출을 사용 하 여 프로그래밍 방식으로 추가 하 하거나 Cosmos 데이터베이스와 연결 된 지리적 영역을 제거할 수 있습니다. 차례로 Cosmos 데이터베이스 Cosmos 컨테이너의 집합으로 구성 됩니다. Cosmos DB에서 컨테이너는 배포 및 확장성의 논리 단위 역할을 합니다. 사용자가 만든 컬렉션, 테이블 및 그래프는 (내부적으로) Cosmos 컨테이너입니다. 컨테이너 완전히 스키마 독립적 이며 쿼리에 대 한 범위를 제공 합니다. Cosmos 컨테이너의 데이터는 수집 시 자동으로 인덱싱됩니다. 자동 인덱싱을 사용 하면 특히 전역 분산된 설정에서에서 스키마 나 인덱스 관리의 번거로움이 데이터를 쿼리할 수 있습니다.  

- 지정 된 지역의 컨테이너 내에서 데이터를 파티션 키를 제공 하 고는 기본 물리적 파티션에 투명 하 게 관리 되는 사용 하 여 배포 됩니다 (*로컬 배포*).  

- 각 실제 파티션 지리적 지역 간에 복제 됩니다 (*전역 배포*). 

탄력적으로 Cosmos DB를 사용 하 여 앱을 Cosmos 컨테이너의 처리량을 확장 또는 더 많은 저장소를 사용 하는 경우 Cosmos DB 파티션 관리 작업을 투명 하 게 처리 (분할 복제, 삭제)는 모든 지역입니다. Cosmos DB는 확장, 배포 또는 장애와는 독립적으로 컨테이너 내에 있는 데이터의 단일 시스템 이미지를 지속적으로 제공하며, 이는 모든 지역에 걸쳐 전역적으로 배포됩니다.  

다음 이미지와 같이 데이터 컨테이너 내에서 두 차원을-지역 내 및 지역에서 전 세계에 걸쳐 배포 됩니다.  

![실제 파티션](./media/global-dist-under-the-hood/distribution-of-resource-partitions.png)

실제 파티션 라는 복제본의 그룹에 의해 구현 되는 *복제본 세트*합니다. 각 컴퓨터는 수백을 개의 파티션에 해당 하는 다양 한 실제 프로세스의 고정된 된 집합 내에서 위의 이미지에서와 같이 복제본을 호스팅합니다. 실제 파티션에 해당하는 복제본은 클러스터 내의 머신과 지역 내의 데이터 센터 간에 동적으로 배치되고 부하가 분산됩니다.  

복제본은 고유하게 Azure Cosmos DB 테넌트에 속합니다. 각 복제본은 Cosmos DB [데이터베이스 엔진](https://www.vldb.org/pvldb/vol8/p1668-shukla.pdf)의 인스턴스를 호스트합니다. 이는 연결된 인덱스뿐만 아니라 리소스도 관리합니다. Cosmos DB 데이터베이스 엔진은 ARS(atom-record-sequence) 기반 형식 시스템에서 작동합니다. 이 엔진은 레코드의 구조 및 인스턴스 값 사이의 경계를 모호 하는 스키마의 개념을 알 수 없는 합니다. Cosmos DB는 수집 시 모든 항목을 효율적인 방법으로 자동으로 인덱싱하여 사용자가 스키마나 인덱스 관리를 처리하지 않고도 전역적으로 분산된 데이터를 쿼리할 수 있도록 함으로써 완전한 스키마 불가지론성을 실현합니다.

Cosmos 데이터베이스 엔진의 몇 가지 조정 기본형, 언어 런타임, 쿼리 프로세서를, 저장소 및 인덱싱 하위 시스템 트랜잭션 저장소에 대 한 책임 및 인덱싱 데이터의 구현을 포함 하는 구성 요소로 이루어져 각각. 내구성과 고가용성을 제공하기 위해 데이터베이스 엔진은 해당 데이터 및 SSD에 대한 인덱스를 유지하고 복제본 집합 내에서 각각 데이터베이스 엔진 인스턴스 간에 복제합니다. 더 큰 테 넌 트 처리량 및 저장소의 더 높은 규모에 대응 하며 했거나 클수록 더 많은 복제본 또는 둘 다. 시스템의 모든 구성 요소는 완전히 비동기식입니다. 즉, 스레드는 전혀 차단되지 않으며, 각 스레드는 불필요한 스레드 스위치를 발생시키지 않고 단시간 동안 작동합니다. 속도 제한 및 역 압력은 승인 제어에서 모든 I/O 경로까지 전체 스택에 걸쳐 연결됩니다. Cosmos 데이터베이스 엔진은 세분화 된 동시성을 악용 하 고 빠르면서도 양의 시스템 리소스 내에서 작동 하는 동안 높은 처리량을 제공 하도록 설계 되었습니다.

두 가지 주요 추상화 – 의존 하는 cosmos DB의 전역 배포 *복제본 세트* 하 고 *파티션 집합*합니다. 복제본 세트는 조정을 위한 모듈식 레고 블록이며, 파티션 세트는 지리적으로 분산된 하나 이상의 실제 파티션에 대한 동적 오버레이입니다. 글로벌 배포의 작동 방식을 이해하려면 이러한 두 가지 주요 추상화를 이해해야 합니다. 

## <a name="replica-sets"></a>복제본 집합

실제 파티션은 자체 관리되고 여러 장애 도메인에 걸쳐 동적으로 부하가 분산된 복제본 그룹으로 구체화됩니다(복제본 세트라고 함). 이 세트는 복제된 상태 머신 프로토콜을 전체적으로 구현하여 실제 파티션 내 데이터를 고가용성, 내구성 및 일관성 있게 만듭니다. 복제본 집합 멤버 자격 *N* 동적 – 간에 변동 유지 *NMin* 하 고 *최대* 실패에 대 한 오류, 관리 작업 및 시간에 따라 복구를 다시 생성/복제본입니다. 멤버 자격 변경에 따라 복제본 프로토콜도 읽기 및 쓰기 쿼럼의 크기를 재구성합니다. 지정 된 물리적 파티션에 할당 된 처리량에 균일 하 게 배포 하려면 두 아이디어 사용: 

- 먼저 리더에 쓰기 요청 처리 비용의 팔로 워에 업데이트를 적용 하는 비용 보다 높습니다. 이에 따라, 리더는 팔로워에 비해 더 많은 시스템 리소스를 예산으로 충당합니다. 

- 둘째, 가급적 지정된 일관성 수준에 대한 읽기 쿼럼은 팔로워 복제본으로만 구성됩니다. 필요 없는 경우 읽기를 제공하기 위해 리더에게 연락하지 않습니다. 다양 한 관계에서 수행한 조사에서 아이디어를 사용 하는 것 [부하 및 용량](https://www.cs.utexas.edu/~lorenzo/corsi/cs395t/04S/notes/naor98load.pdf) 에 대 한 쿼럼 기반 시스템에는 [5 개의 일관성 모델](consistency-levels.md) Cosmos DB를 지 합니다.  

## <a name="partition-sets"></a>파티션 집합

구성 된 모든 지역에서 복제 하는 키의 동일한 집합을 관리 하 고 Cosmos 데이터베이스 영역으로 구성 된 각에서 실제 파티션의 그룹으로 구성 됩니다. 이 더 높은 조정 기본 이라고를 *파티션 집합* -지정 된 키 집합을 관리 하는 실제 파티션의 지리적으로 분산 된 동적 오버레이 합니다. 파티션 집합을 클러스터에 걸쳐 있을 수는 지정 된 물리적 파티션에 (복제 집합)의 클러스터 내에서 범위가 지정 되는 동안 데이터 센터와 아래 그림에 표시 된 대로 지리적 지역:  

![파티션 세트](./media/global-dist-under-the-hood/dynamic-overlay-of-resource-partitions.png)

파티션 집합을 동일한 키 집합을 소유하는 여러 복제본 집합으로 구성된, 지리적으로 분산된 “슈퍼 복제본 집합”으로 생각할 수 있습니다. 비슷하게 복제 집합을 파티션 집합의 멤버 이기도 동적 – 지정된 된 파티션 집합에서 새 파티션 추가/제거에 암시적 실제 파티션 관리 작업에 따라 변동 것 (예를 들어 경우에서 스케일 아웃 처리량을 컨테이너 한 오류가 발생할 때 또는 Cosmos 데이터베이스에 지역 추가/제거). 각 파티션 (파티션 집합)의 자체 복제본 세트 내에서 파티션 집합 멤버 자격을 관리 하는 것을 멤버 자격은 완벽 하 게 분산 및 고가용성을 제공 합니다. 파티션 세트를 재구성하는 동안 실제 파티션 간 오버레이의 토폴로지도 설정됩니다. 토폴로지는 일관성 수준, 지리적 거리 및 원본 서버와 대상 실제 파티션 간에 사용 가능한 네트워크 대역폭에 따라 동적으로 선택 됩니다.  

서비스를 사용하면 Cosmos 데이터베이스를 단일 쓰기 지역 또는 다중 쓰기 지역으로 구성할 수 있으며, 선택에 따라 파티션 집합은 단 하나의 지역 또는 모든 지역에서 쓰기를 허용하도록 구성됩니다. 시스템은 2단계의 중첩된 일치 프로토콜을 사용합니다. 한 레벨은 쓰기를 허용하는 실제 파티션의 복제본 세트의 복제본에서 작동하고, 다른 한 레벨은 파티션 세트 수준에서 작동하여 파티션 세트 내 모든 커밋된 쓰기에 대해 완벽한 순서를 보장합니다. 이 다층적이고 중첩된 일치는 고가용성을 위한 엄격한 SLA를 구현하고, 동시에 Cosmos DB가 고객에게 제공하는 일관성 모델을 구현하는 데 매우 중요합니다.  

## <a name="conflict-resolution"></a>충돌 해결

업데이트 전파, 충돌 해결 및 인과 관계 추적을 위한 설계는 [유행병 알고리즘](https://www.cs.utexas.edu/~lorenzo/corsi/cs395t/04S/notes/naor98load.pdf) 및 [Bayou](https://zoo.cs.yale.edu/classes/cs422/2013/bib/terry95managing.pdf) 시스템에 대한 이전 작업에서 영감을 받았습니다. 아이디어의 핵심은 살아남아 Cosmos DB의 시스템 설계를 전달하는 데 편리한 참조 프레임을 제공하는 한편, Cosmos DB 시스템에 적용되면서 상당한 변화를 겪기도 했습니다. 이 필요 해 서 이전 시스템 리소스 거 버 넌 스를 사용 하 여 아니고는 Cosmos DB 해야 작동에 기능 (예를 들어 제한 된 부실 일관성) 및 엄격한를 제공 하기 위해 확장을 사용 하 여 설계 되었습니다 및 Cosmos DB 고객에 게 제공 하는 포괄적인 Sla  

파티션 세트는 여러 지역에 분산되어 있으며 Cosmos DB(다중 마스터) 복제 프로토콜에 따라 지정된 파티션 세트로 구성된 실제 파티션 간에 데이터를 복제합니다. 파티션 세트의 각 실제 파티션은 쓰기를 허용하며 일반적으로 해당 지역에 있는 클라이언트에 읽기를 제공합니다. 지역 내의 실제 파티션에서 수락된 쓰기는 지속력 있게 커밋되며 클라이언트에서 승인되기 전에 해당 실제 파티션 내에서 높은 가용성을 제공합니다. 이러한 쓰기는 임시 쓰기이며, 엔트로피 방지 채널을 사용하여 파티션 세트 내의 다른 실제 파티션으로 전파됩니다. 클라이언트는 요청 헤더를 전달하여 임시 쓰기나 커밋된 쓰기를 요청할 수 있습니다. 엔트로피 방지 전파(전파 빈도 포함)는 파티션 세트의 토폴로지, 실제 파티션의 지역적 근접성 및 구성된 일관성 수준에 따라 동적입니다. 파티션 집합 내에서 Cosmos DB는 동적으로 선택된 중재자 파티션과 함께 기본 커밋 체계를 따릅니다. 중재자 선택은 동적이며 오버레이의 토폴로지에 따라 파티션 집합을 재구성하는 데 필수적인 부분입니다. 커밋된 쓰기(다중 행/일괄 처리 업데이트 포함)는 순서가 보장됩니다. 

인과 관계 추적 및 버전 벡터를 위한 인코딩된 벡터 클록(복제본 집합과 파티션 집합 각각에서 각 일치 수준에 해당하는 지역 ID 및 논리적 클록 포함)을 사용하여 업데이트 충돌을 탐지하고 해결합니다. 토폴로지 및 피어 선택 알고리즘은 버전 벡터의 고정적이며 최소한의 저장소와 최소한의 네트워크 오버헤드를 보장하도록 설계되었습니다. 알고리즘은 엄격한 수렴 속성을 보장합니다.  

여러 쓰기 지역으로 구성된 Cosmos 데이터베이스의 경우, 시스템은 다음을 포함하여 개발자가 선택할 수 있는 유연하며 다양한 자동 충돌 해결 정책을 제공합니다. 

- **마지막 쓰기 우선 LWW ()** 에 기본적으로 사용 하 여 시스템에 정의 된 타임 스탬프 속성 (기반으로 하는 시간 동기화 클록 프로토콜). 또한 Cosmos DB를 사용하면 충돌 해결에 사용할 다른 사용자 지정 숫자 속성을 지정할 수 있습니다.  
- **응용 프로그램 정의 (사용자 지정) 충돌 해결 정책** (병합 프로시저를 통해 표현)는 충돌 응용 프로그램 정의 의미 체계 조정에 대 한 설계 되었습니다. 이러한 프로시저는 서버 쪽의 데이터베이스 트랜잭션에서 쓰기-쓰기 충돌이 검색될 때 호출됩니다. 시스템 제공 정확 하 게 약정 프로토콜의 일부로 병합 프로시저의 실행을 위해 한 번 보장 합니다. 가지 [여러 충돌 해결 샘플](how-to-manage-conflicts.md) 사용 하 여 재생 하는 데 사용할 수 있습니다.  

## <a name="consistency-models"></a>일관성 모델

단일 또는 여러 개의 쓰기 지역 Cosmos 데이터베이스를 구성 하는지 여부를 5 개의 잘 정의 된 일관성 모델에서 선택할 수 있습니다. 여러 개의 쓰기 하위 지역에 다음은 몇 가지 주목할 만한 측면의 일관성 수준:  

제한 된 부실 일관성 내에서 모든 읽기 되도록 보장 *K* 접두사 또는 *T* 에서 모든 지역에서 최신 쓰기 시간 (초)입니다. 또한 제한 된 부실 일관성 읽기 단조 하 고 일관 된 접두사 보증을 포함 되도록 보장 됩니다. 엔트로피 방지 프로토콜은 속도 제한 방식으로 작동하며, 접두사가 누적되지 않고 쓰기에서 역 압력을 적용할 필요가 없음을 보장합니다. 고유한 쓰기 읽기 세션 일관성은 단조 읽기, 단조 쓰기, 쓰기, 읽기 및 일관 된 접두사 보증을 전 세계를 따릅니다. 강력한 일관성을 사용 하 여 구성 데이터베이스에 대해 여러 쓰기 지역의 이점 (낮은 쓰기 대기 시간, 높은 쓰기 가용성)에 적용 되지 않지만 지역에 걸쳐 동기 복제로 인해 합니다.

Cosmos DB의 5 가지 일관성 모델의 의미 체계에 설명 되어 있습니다 [여기](consistency-levels.md)에 한 수학적으로 높은 수준의 TLA + 사양을 사용 하 여 설명 [여기](https://github.com/Azure/azure-cosmos-tla).

## <a name="next-steps"></a>다음 단계

이제 다음 문서를 사용하여 글로벌 배포를 구성하는 방법을 알아봅니다.

* [데이터베이스 계정에서 지역 추가/제거](how-to-manage-database-account.md#addremove-regions-from-your-database-account)
* [클라이언트에서 멀티 호밍(multi-homing)을 구성하는 방법](how-to-manage-database-account.md#configure-clients-for-multi-homing)
* [사용자 지정 충돌 해결 정책을 만드는 방법](how-to-manage-conflicts.md#create-a-custom-conflict-resolution-policy)
