---
title: Azure Cosmos DB의 고가용성
description: 이 문서에서는 Azure Cosmos DB에서 고가용성을 제공하는 방법을 설명합니다.
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 02/05/2021
ms.author: mjbrown
ms.reviewer: sngun
ms.openlocfilehash: ac1e77d99707cdaa34ef42eb9b327a62f4e864c0
ms.sourcegitcommit: dddd1596fa368f68861856849fbbbb9ea55cb4c7
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/13/2021
ms.locfileid: "107365368"
---
# <a name="how-does-azure-cosmos-db-provide-high-availability"></a>Azure Cosmos DB에서 고가용성을 제공하는 방법
[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

Azure Cosmos DB는 두 가지의 주요 방법으로 고가용성을 제공합니다. 첫 번째로, Azure Cosmos DB는 Cosmos 계정 내에서 구성된 지역 전체에서 데이터를 복제합니다. 두 번째로, Azure Cosmos DB는 지역 내에서 4개의 데이터 복제본을 유지 관리합니다.

Azure Cosmos DB는 전역적으로 배포된 기본적인 데이터베이스 서비스로, [Azure를 사용할 수 있는 모든 지역에서 사용](https://azure.microsoft.com/global-infrastructure/services/?products=cosmos-db&regions=all)할 수 있습니다. 제한 없는 수의 Azure 지역을 Azure Cosmos 계정과 연결할 수 있으며 데이터는 자동으로 투명하게 복제됩니다. 언제든지 Azure Cosmos 계정에서 지역을 추가 또는 제거할 수 있습니다. Cosmos DB는 고객이 사용할 수 있는 5개의 고유한 Azure 클라우드 환경에서 사용할 수 있습니다.

* **Azure 공용** 클라우드: 전역적으로 사용할 수 있습니다.

* **Azure 중국 21Vianet** 은 Microsoft와 중국 최대의 인터넷 공급자인 21Vianet 간의 제휴를 통해 사용할 수 있습니다.

* **Azure 독일** 은 데이터 트러스티 모델에 따라 서비스를 제공하며, Deutsche Telekom의 자회사인 T-Systems International GmbH가 독일 데이터 트러스티로서 기능하여 고객 데이터를 독일에서 관리되도록 합니다.

* **Azure Government**: 미국 4개 지역에서 미국 정부 기관 및 해당 파트너가 사용할 수 있습니다.

* **DoD(Department of Defense)용 Azure Government** 는 미국 2개 지역에서 미국 국방부가 사용할 수 있습니다.

다음 이미지에 표시된 것처럼 지역 내에서 Azure Cosmos DB는 4개의 데이터 복사본을 물리적 파티션 내의 복제본으로 유지 관리합니다.

:::image type="content" source="./media/high-availability/cosmosdb-data-redundancy.png" alt-text="물리적 분할" border="false":::

* Azure Cosmos 컨테이너 내의 데이터는 [수평 분할](partitioning-overview.md)됩니다.

* 파티션 집합은 여러 복제본 집합의 컬렉션입니다. 각 지역 내에서 모든 파티션은 모든 쓰기가 복제되는 복제본 세트로 보호되며, 대부분의 복제본에서 지속적으로 커밋됩니다. 복제본은 10 ~ 20개의 장애 도메인 간에 분산됩니다.

* 모든 지역에 걸쳐 있는 각 파티션이 복제됩니다. 각 지역에는 Azure Cosmos 컨테이너의 모든 데이터 파티션이 포함되며, 다중 지역 쓰기를 사용하는 경우 읽기 뿐만 아니라 쓰기를 제공할 수 있습니다.  

Azure Cosmos 계정이 *N* 개의 Azure 지역에 배포되는 경우 모든 데이터의 최소 *N* x 4 복사본이 있습니다. 2개 이상의 지역에 Azure Cosmos 계정이 있으면 애플리케이션의 가용성이 향상되고 연결된 지역에서 짧은 대기 시간을 제공합니다.

## <a name="slas-for-availability"></a>가용성 SLA

Azure Cosmos DB는 처리량, 99번째 백분위수의 대기 시간, 일관성, 고가용성을 포함하는 종합적인 SLA를 제공합니다. 다음 표에서는 Azure Cosmos DB가 제공하는 단일 및 다중 지역 계정에 대한 고가용성 보장 관련 내용을 보여줍니다. 쓰기 가용성을 높이려면 Azure Cosmos 계정에 다중 쓰기 지역이 있도록 구성합니다.

|작업 유형  | 단일 지역 |다중 지역(단일 지역 쓰기)|다중 지역(다중 지역 쓰기) |
|---------|---------|---------|-------|
|쓰기    | 99.99    |99.99   |99.999|
|읽기     | 99.99    |99.999  |99.999|

> [!NOTE]
> 실제로, 제한된 부실, 세션, 일관된 접두사, 결과적 일관성 모델의 실제 쓰기 가용성은 게시된 SLA보다 훨씬 높습니다. 모든 일관성 수준에 대한 실제 읽기 가용성은 게시된 SLA보다 훨씬 높습니다.

## <a name="high-availability-with-azure-cosmos-db-in-the-event-of-regional-outages"></a>지역 가동 중단이 발생하는 경우 Cosmos DB를 통한 고가용성

드물지만 지역 가동 중단이 발생하는 경우에 Azure Cosmos DB는 데이터베이스가 항상 고가용성을 유지하도록 합니다. 다음 세부 정보는 Azure Cosmos 계정의 구성에 따라 가동 중단 동안의 Azure Cosmos DB 동작을 캡처한 것입니다.

* Cosmos DB를 사용하면, 쓰기 작업이 클라이언트에서 승인되기 전에 쓰기 작업을 허용하는 지역 내에서 복제본의 쿼럼에 의해 데이터가 지속적으로 커밋됩니다. 자세한 내용은 [일관성 수준 및 처리량](./consistency-levels.md#consistency-levels-and-throughput)을 참조하세요.

* 다중 쓰기 지역으로 구성된 다중 지역 계정은 쓰기 및 읽기 모두에 대해 고가용성을 유지합니다. 지역 장애 조치(failover)는 Azure Cosmos DB 클라이언트에서 검색되고 핸들됩니다. 지역별 장애 조치는 즉각적이며, 애플리케이션에서 변경할 필요가 없습니다.

* 단일 지역 계정은 지역 중단으로 인해 가용성이 손실될 수도 있습니다. 항상 고가용성을 보장하기 위해 Azure Cosmos 계정에 **둘 이상의 지역**(가급적 둘 이상의 쓰기 지역)을 설정하는 것이 좋습니다.

> [!IMPORTANT]
> SQL API를 사용하는 경우 지정된 모든 읽기 영역을 사용하여 증가된 가용성을 활용하도록 Cosmos DB SDK를 구성해야 합니다. 자세한 내용은 [이 문서](troubleshoot-sdk-availability.md)를 참조하세요.

### <a name="multi-region-accounts-with-a-single-write-region-write-region-outage"></a>단일 쓰기 지역이 있는 다중 지역 계정(쓰기 지역 가동 중단)

* Azure Cosmos 계정은 쓰기 지역 가동 중단 중에 자동으로 보조 지역을 새로운 주 쓰기 지역으로 승격하고, **이 자동 장애 조치를 사용하도록 설정하면 Azure Cosmos 계정에** 를 구성합니다. 이를 사용하도록 설정하면 지정한 지역 우선 순위에 따라 다른 지역에서 장애 조치가 발생합니다.

* 수동 장애 조치는 트리거되지 않으며 원본 또는 대상 지역이 가동 중단되는 경우에는 성공하지 않습니다. 이는 장애 조치 프로시저에서 지역 간에 연결을 요구하는 일관성 확인을 수행하기 때문입니다.

* 이전에 영향을 받은 지역이 다시 온라인 상태가 되면 해당 지역이 실패했을 때 복제되지 않은 모든 쓰기 데이터는 [충돌 피드](how-to-manage-conflicts.md#read-from-conflict-feed)를 통해 사용할 수 있게 됩니다. 애플리케이션은 충돌 피드를 읽고, 애플리케이션별 논리에 따라 충돌을 해결하고, 업데이트된 데이터를 적절하게 Azure Cosmos 컨테이너에 다시 쓸 수 있습니다.

* 이전에 영향을 받는 쓰기 지역이 복구되고 나면, 자동으로 읽기 지역으로 사용할 수 있게 됩니다. 쓰기 지역으로 복구된 지역으로 다시 전환할 수 있습니다. [PowerShell, Azure CLI 또는 Azure Portal](how-to-manage-database-account.md#manual-failover)을 사용하여 지역을 전환할 수 있습니다. 쓰기 지역을 전환하여 애플리케이션의 가용성이 계속 높게 유지되는 동안이나 그 이후에는 **데이터나 가용성 손실이 발생하지** 않습니다.

> [!IMPORTANT]
> **자동 장애 조치를 사용하도록 설정** 하려면 프로덕션 워크로드에 사용되는 Azure Cosmos 계정을 구성하는 것이 좋습니다. 이를 통해 Cosmos DB는 계정 데이터베이스를 자동으로 사용 가능한 지역으로 장애 조치할 수 있습니다. 이 구성이 없는 경우, 지역 연결이 부족하여 수동 장애 조치가 성공하지 않으므로 계정의 쓰기 지역 가동 중단 시간에 대한 쓰기 가용성이 손실됩니다.

### <a name="multi-region-accounts-with-a-single-write-region-read-region-outage"></a>단일 쓰기 지역이 있는 다중 지역 계정(읽기 지역 가동 중단)

* 읽기 지역 가동 중단 중에는 3개 이상의 읽기 지역에서 일관성 수준 또는 강력한 일관성을 사용하는 Azure Cosmos 계정이 항상 읽기 및 쓰기에 대해 고가용성을 유지합니다.

* 3개 지역(1개의 쓰기 지역 및 2개의 읽기 지역)에서 강력한 일관성을 사용하는 Azure Cosmos 계정은 읽기 지역 가동 중단 중에 쓰기 가용성을 유지합니다. 자동 장애 조치를 사용하는 것으로 설정된 두 지역을 지닌 계정의 경우, 해당 지역이 실패로 표시되고 자동 장애 조치가 발생할 때까지 계정이 쓰기 수신을 중지합니다.

* 영향을 받는 지역은 자동으로 연결이 해제되며 오프라인으로 표시됩니다. [Azure Cosmos DB SDK](sql-api-sdk-dotnet.md)는 기본 지역 목록에서 사용 가능한 다음 지역으로 읽기 호출을 리디렉션합니다.

* 기본 설정 지역 목록의 어느 지역도 사용할 수 없는 경우 호출은 현재 쓰기 지역으로 자동으로 대체됩니다.

* 읽기 지역 중단을 처리하기 위해 애플리케이션 코드를 변경할 필요가 없습니다. 결국 영향을 받은 지역이 다시 온라인 상태가 되면 그 지역은 현재 쓰기 지역과 자동으로 동기화되고 읽기 요청을 제공하는 데 다시 사용할 수 있게 됩니다.

* 후속 읽기는 애플리케이션 코드를 변경하지 않고도 복구된 지역으로 리디렉션됩니다. 이전에 실패한 지역에 대한 장애 조치와 다시 가입하기 중에는 Azure Cosmos DB에서 읽기 일관성이 계속해서 보장됩니다.

* Azure 지역이 영구적으로 복구할 수 없는 극히 드물고 불운한 경우에도, 다중 지역 Azure Cosmos 계정을 *강력한* 일관성 수준으로 구성하면 데이터가 손실되지 않습니다. 영구적으로 복구할 수 없는 쓰기 지역의 경우, 제한된 부실 일관성으로 구성된 다중 지역 Azure Cosmos 계정에서 잠재적 데이터 손실 기간은 K=100,000 업데이트 또는 T=5분(가장 먼저 발생)인 부실 기간(*K* 또는 *T*)으로 제한됩니다. 세션, 일관된 접두사, 최종 일관성 수준에 대한 잠재적인 데이터 손실 기간은 최대 15분으로 제한됩니다. Azure Cosmos DB의 RTO 및 RPO 대상에 대한 자세한 내용은 [일관성 수준 및 데이터](./consistency-levels.md#rto) 내구성을 참조하세요.

## <a name="availability-zone-support"></a>가용성 영역 지원

지역 간 복원력 외에도, Azure Cosmos DB는 Azure Cosmos 계정에 연결할 지역을 선택할 때 지원되는 지역에서 **영역 중복** 을 지원합니다.

AZ(가용성 영역) 지원을 사용하면 Azure Cosmos DB는 복제본이 지정된 지역 내의 다중 영역에 배치되어 영역 오류에 대한 고가용성 및 복원력을 제공하도록 합니다. 가용성 영역은 대기 시간에 대한 변경 없이 99.995% 가용성 SLA를 제공합니다. 단일 영역 장애가 발생하는 경우, 영역 중복은 RPO=0인 전체 데이터 내구성 및 RTO=0인 가용성을 제공합니다. 영역 중복은 지역 복제에 대한 추가 기능입니다. 영역 중복만으로는 지역 복원력을 달성할 수 없습니다.

Azure Cosmos 계정에 새 지역을 추가하는 경우에만 영역 중복을 구성할 수 있습니다. 기존 지역의 경우 영역을 제거한 후 영역 중복을 사용하여 다시 추가하면 영역 중복을 사용하도록 설정할 수 있습니다. 단일 지역 계정의 경우에는 임시로 장애 조치를 수행할 추가 지역을 하나 추가하고, 영역 중복을 사용하도록 설정된 원하는 지역을 제거하고 추가해야 합니다.

Azure Cosmos 계정에 대한 다중 지역 쓰기를 구성하는 경우 추가 비용 없이 영역 중복을 옵트인할 수 있습니다. 그렇지 않으면 영역 중복 지원에 대한 가격 책정과 관련된 아래 표를 참조하세요. 가용성 영역을 사용할 수 있는 지역 목록은 [가용성 영역](../availability-zones/az-region.md)을 참조하세요.

다음 표에는 다양한 계정 구성의 고가용성 기능이 요약되어 있습니다.

|KPI|AZs를 사용하지 않는 단일 지역|AZs를 사용하는 단일 지역|AZs를 사용하여 다중 지역, 단일 지역 쓰기|AZs를 사용하여 다중 지역, 다중 지역 쓰기|
|---------|---------|---------|---------|---------|
|쓰기 가용성 SLA | 99.99% | 99.995% | 99.995% | 99.999% |
|가용성 SLA 읽기  | 99.99% | 99.995% | 99.995% | 99.999% |
|영역 오류 - 데이터 손실 | 데이터 손실 | 데이터 손실 없음 | 데이터 손실 없음 | 데이터 손실 없음 |
|영역 오류 - 가용성 | 가용성 손실 | 가용성 손실 없음 | 가용성 손실 없음 | 가용성 손실 없음 |
|지역 가동 중단 - 데이터 손실 | 데이터 손실 |  데이터 손실 | 일관성 수준에 따라 달라집니다. 자세한 내용은 [일관성, 가용성 및 성능 장단점](./consistency-levels.md)을 참조하세요. | 일관성 수준에 따라 달라집니다. 자세한 내용은 [일관성, 가용성 및 성능 장단점](./consistency-levels.md)을 참조하세요.
|지역 가동 중단 - 가용성 | 가용성 손실 | 가용성 손실 | 읽기 지역 오류에 대한 가용성 손실 없음, 쓰기 지역 오류에 대해서는 임시 | 가용성 손실 없음 |
|가격 (***1** _) | 해당 없음 | 프로비전된 RU/초 x 1.25 비율 | 프로비전된 RU/초 x 1.25 비율(_*_2_**) | 다중 지역 쓰기율 |

***1*** 서버리스 계정의 경우에는 1.25의 계수를 사용하여 RU(요청 단위를) 곱합니다.

***2*** 1.25 비율은 AZ를 사용하는 지역에만 적용됩니다.

다음을 통해 가용성 영역을 사용하도록 설정할 수 있습니다.

* [Azure Portal](how-to-manage-database-account.md#addremove-regions-from-your-database-account)

* [Azure PowerShell](manage-with-powershell.md#create-account)

* [Azure CLI](manage-with-cli.md#add-or-remove-regions)

* [Azure 리소스 관리자 템플릿](./manage-with-templates.md)

## <a name="building-highly-available-applications"></a>고가용성 애플리케이션 빌드

* 이러한 이벤트 중에 [Azure Cosmos SDK의 예상 동작](troubleshoot-sdk-availability.md)을 검토하고 이에 영향을 주는 구성입니다.

* 높은 쓰기 및 읽기 가용성을 보장하려면 여러 쓰기 지역이 있는 두 개 이상의 지역에 걸쳐 Azure Cosmos 계정을 구성합니다. 이 구성은 SLA를 기반으로 하는 읽기 및 쓰기 작업의 가용성, 최소 대기 시간, 확장성을 제공합니다. 자세한 내용은 [여러 쓰기 영역을 사용하여 Azure Cosmos 계정을 구성](tutorial-global-distribution-sql-api.md)하는 방법을 참조하세요.

* 단일 쓰기 지역으로 구성된 다중 지역 Cosmos 계정의 경우 [Azure CLI 또는 Azure Portal을 사용하여 자동 장애 조치를 사용하도록 설정](how-to-manage-database-account.md#automatic-failover)합니다. 자동 장애 조치(failover)를 사용하도록 설정하면, Cosmos DB는 지역 재해가 있을 때마다 자동으로 사용자 계정을 장애 조치(failover)합니다.  

* Azure Cosmos 계정의 가용성이 높더라도 애플리케이션이 고가용성을 유지하도록 올바르게 설계되지 않았을 수도 있습니다. 애플리케이션 테스트 또는 DR(재해 복구) 드릴의 일환으로 애플리케이션의 엔드투엔드 고가용성을 테스트하려면, 계정에 대해 자동 장애 조치를 일시적으로 사용하지 않도록 설정하고 [PowerShell, Azure CLI 또는 Azure Portal을 사용하여 수동 장애 조치](how-to-manage-database-account.md#manual-failover)를 호출한 다음 애플리케이션의 장애 조치를 모니터링합니다. 완료되면 주 지역으로 장애 복구하고 계정에 대한 자동 장애 조치를 복원할 수 있습니다.

> [!IMPORTANT]
> 원본 또는 대상 지역에서 Cosmos DB 가동 중단 시 수동 장애 조치를 호출해서는 안 됩니다. 데이터 일관성을 유지하기 위해 지역 연결이 필요하고, 호출이 되지 않습니다.

* 전역적으로 분산된 데이터베이스 환경에서 지역 전체 가동 중단이 발생할 경우, 일관성 수준과 데이터 내구성 사이에 직접적인 관계가 있습니다. 비즈니스 연속성 계획을 개발할 때는 중단 이벤트가 발생한 후 애플리케이션이 완전히 복구되기까지 허용되는 최대 시간을 이해해야 합니다. 애플리케이션을 완전히 복구하는 데 필요한 시간을 RTO(복구 시간 목표)라고 합니다. 또한 중단 이벤트가 발생한 후 복구될 때 애플리케이션에서 손실을 허용할 수 있는 최근 데이터 업데이트의 최대 기간도 이해해야 합니다. 손실될 수 있는 업데이트 기간을 RPO(복구 지점 목표)라고 합니다. Azure Cosmos DB의 RPO 및 RTO를 확인하려면 [일관성 수준 및 데이터 내구성](./consistency-levels.md#rto)을 참조하세요.

## <a name="what-to-expect-during-a-cosmos-db-region-outage"></a>Cosmos DB 지역 가동 중단 중에 발생할 수 있는 작업

단일 지역 계정의 경우 클라이언트에서 읽기 및 쓰기 가용성을 잃게 됩니다.

다중 지역 계정에서는 다음 표에 따라 다양한 동작이 발생합니다.

| 쓰기 지역 | 자동 장애 조치(automatic failover) | 필요한 항목 | 수행할 작업 |
| -- | -- | -- | -- |
| 단일 쓰기 지역 | 사용 안 함 | 읽기 지역에서 가동 중단이 발생하는 경우, 모든 클라이언트는 다른 지역으로 리디렉션됩니다. 읽기 또는 쓰기 가용성이 손실되지 않습니다. 데이터가 손실되지 않습니다. <p/> 쓰기 지역에서 가동 중단이 발생하는 경우, 클라이언트에게 쓰기 가용성 손실이 발생합니다. 강력한 일관성 수준을 선택하지 않으면 일부 데이터가 나머지 활성 영역으로 복제되지 않을 수 있습니다. [이 섹션](consistency-levels.md#rto)에 설명된 대로 선택한 일관성 수준에 따라 달라집니다. 영향을 받는 지역에 영구적인 데이터 손실이 발생하면 복제되지 않은 데이터는 손실될 수 있습니다. <p/> 가동 중단이 종료되면 Cosmos DB가 자동으로 쓰기 가용성을 복원합니다. | 가동 중단 중에는 읽기 트래픽을 지원하기 위해 남은 지역에 프로비전된 RU가 충분한지 확인합니다. <p/> 장애 조치 중에는 수동 장애 조치가 트리거되지 않으므로, 이를 트리거하면 *안 됩니다*. <p/> 가동 중단이 발생하면 프로비전된 RU를 적절하게 다시 조정합니다. |
| 단일 쓰기 지역 | 사용 | 읽기 지역에서 가동 중단이 발생하는 경우, 모든 클라이언트는 다른 지역으로 리디렉션됩니다. 읽기 또는 쓰기 가용성이 손실되지 않습니다. 데이터가 손실되지 않습니다. <p/> 쓰기 지역에서 가동 중단이 발생하는 경우, Cosmos DB가 기본 설정에 따라 새 지역을 새 쓰기 지역으로 자동으로 선택하기 전까지는 클라이언트에게 쓰기 가용성 손실이 발생합니다. 강력한 일관성 수준을 선택하지 않으면 일부 데이터가 나머지 활성 영역으로 복제되지 않을 수 있습니다. [이 섹션](consistency-levels.md#rto)에 설명된 대로 선택한 일관성 수준에 따라 달라집니다. 영향을 받는 지역에 영구적인 데이터 손실이 발생하면 복제되지 않은 데이터는 손실될 수 있습니다. | 가동 중단 중에는 읽기 트래픽을 지원하기 위해 남은 지역에 프로비전된 RU가 충분한지 확인합니다. <p/> 장애 조치 중에는 수동 장애 조치가 트리거되지 않으므로, 이를 트리거하면 *안 됩니다*. <p/> 가동 중단이 발생하면 쓰기 지역을 원래 영역으로 다시 이동하고, 프로비전된 RU를 적절히 조정할 수 있습니다. SQL API를 사용하는 계정은 [충돌 피드](how-to-manage-conflicts.md#read-from-conflict-feed)의 실패한 지역에서 복제되지 않은 데이터를 복구할 수도 있습니다. |
| 다중 쓰기 지역 | 해당 없음 | 읽기 또는 쓰기 가용성이 손실되지 않습니다. <p/> 실패한 지역의 최근 업데이트된 데이터는 나머지 활성 영역에서 사용하지 못할 수 있습니다. 최종, 일관된 접두사 및 세션 일관성 수준은 <15mins의 부실을 보장합니다. 제한된 부실은 구성에 따라 K 업데이트 또는 T 초 미만으로 보장됩니다. 영향을 받는 지역에 영구적인 데이터 손실이 발생하면 복제되지 않은 데이터는 손실될 수 있습니다. | 가동 중단 중에는 추가 트래픽을 지원하기 위해 남은 지역에 프로비전된 RU가 충분한지 확인합니다. <p/> 가동 중단이 발생하면 프로비전된 RU를 적절하게 다시 조정할 수 있습니다. 가능하면 Cosmos DB는SQL API 계정에 대해 구성된 충돌 해결 방법을 사용하여 실패한 지역에서 복제되지 않은 데이터를 자동으로 복구하고, 다른 API를 사용하는 계정에 대해 마지막으로 성공한 쓰기를 자동으로 복구합니다. |

## <a name="next-steps"></a>다음 단계

이제 다음 문서를 읽을 수 있습니다.

* [다양한 일관성 수준의 가용성 및 성능 절충](./consistency-levels.md)

* [전역적으로 프로비전된 처리량 크기 조정](./request-units.md)

* [글로벌 배포 - 내부 살펴보기](global-dist-under-the-hood.md)

* [Azure Cosmos DB의 일관성 수준](consistency-levels.md)

* [다중 쓰기 지역으로 Cosmos 계정을 구성하는 방법](how-to-multi-master.md)

* [다중 지역 환경의 SDK 동작](troubleshoot-sdk-availability.md)