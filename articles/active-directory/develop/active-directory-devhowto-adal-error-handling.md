---
title: ADAL(Azure Active Directory 인증 라이브러리) 클라이언트에 대한 오류 처리 모범 사례
description: ADAL 클라이언트 응용 프로그램에 대한 오류 처리 지침 및 모범 사례를 제공합니다.
services: active-directory
documentationcenter: ''
author: danieldobalian
manager: mtillman
ms.author: celested
ms.service: active-directory
ms.component: develop
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 02/27/2017
ms.custom: ''
ms.openlocfilehash: 27315262ff64b640acc3af16a26fc3887d852a00
ms.sourcegitcommit: e14229bb94d61172046335972cfb1a708c8a97a5
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 05/14/2018
ms.locfileid: "34157640"
---
# <a name="error-handling-best-practices-for-azure-active-directory-authentication-library-adal-clients"></a>ADAL(Azure Active Directory 인증 라이브러리) 클라이언트에 대한 오류 처리 모범 사례

이 문서는 ADAL을 사용하여 사용자를 인증하는 경우 개발자에게 발생할 수 있는 오류 유형에 대한 지침을 제공합니다. ADAL을 사용하는 경우 개발자가 개입하여 오류를 처리해야 하는 여러 사례가 있습니다. 오류를 적절하게 처리하면 최종 사용자 환경이 개선되며 최종 사용자가 로그인해야 하는 횟수도 줄어듭니다.

이 문서에서는 ADAL에서 지원되는 각 플랫폼의 구체적인 사례와 응용 프로그램이 각 사례를 적절하게 처리할 수 있는 방법을 살펴봅니다. 오류 지침은 ADAL API에서 제공되는 토큰 획득 패턴에 따라 다음 두 개의 광범위한 범주로 분할됩니다.

- **AcquireTokenSilent**: 클라이언트가 자동으로 토큰을 가져오려고 시도하며(UI 없음) ADAL이 성공적이지 않은 경우 실패할 수 있습니다. 
- **AcquireToken**: 클라이언트가 자동 획득을 시도할 수 있지만 로그인이 필요한 대화형 요청도 수행할 수 있습니다.

> [!TIP]
> ADAL 및 Azure AD를 사용하는 경우 모든 오류 및 예외를 기록하는 것이 좋습니다. 로그는 응용 프로그램의 전체 상태를 이해하는 데 유용할 뿐만 아니라 광범위한 문제점을 디버그하는 경우에도 중요합니다. 응용 프로그램을 특정 오류로부터 복구할 수 있으나 오류는 해결을 위해 코드를 변경해야 하는 광범위한 디자인 문제를 암시할 수도 있습니다. 
> 
> 이 문서에서 다루는 오류 조건을 구현하는 경우 앞에 설명된 이유에 대한 오류 코드 및 설명을 기록해야 합니다. 로깅 코드 예제는 [오류 및 로깅 참조](#error-and-logging-reference)를 확인하세요. 
>

## <a name="acquiretokensilent"></a>AcquireTokenSilent

AcquireTokenSilent는 최종 사용자가 UI(사용자 인터페이스)를 보지 않도록 보장하면서 토큰을 가져오려고 시도합니다. 자동 획득이 실패하여 대화형 요청 또는 기본 처리기를 통해 처리해야 하는 여러 사례가 있습니다. 다음 섹션에서는 각 사례를 적용하는 경우와 방법에 대해 알아봅니다.

운영 체제에서 생성되며 응용 프로그램별 오류 처리가 필요한 오류 집합이 있습니다. 자세한 내용은 [오류 및 로깅 참조](#error-and-logging-reference)의 “운영 체제” 오류 섹션을 참조하세요. 

### <a name="application-scenarios"></a>응용 프로그램 시나리오

- [네이티브 클라이언트](active-directory-dev-glossary.md#native-client) 응용 프로그램(iOS, Android, .NET 데스크톱 또는 Xamarin)
- [리소스](active-directory-dev-glossary.md#resource-server)(.NET)를 호출하는 [웹 클라이언트](active-directory-dev-glossary.md#web-client) 응용 프로그램

### <a name="error-cases-and-actionable-steps"></a>오류 사례 및 실행 가능한 단계

기본적으로 AcquireTokenSilent 오류는 두 가지 사례가 있습니다.

| 사례 | 설명 |
|------|-------------|
| **사례 1**: 대화형 로그인으로 해결 가능한 오류 | 유효한 토큰이 부족하여 오류가 발생하면 대화형 요청이 필요합니다. 특히 캐시 조회 및 잘못된/만료된 새로 고침 토큰을 해결하려면 AcquireToken을 호출해야 합니다.<br><br>이러한 경우 최종 사용자에게 로그인하라는 메시지가 표시되어야 합니다. 응용 프로그램은 최종 사용자 조작(예: 로그인 단추 누르기) 이후 또는 나중에 대화형 요청을 수행하도록 선택할 수 있습니다. 선택 사항은 원하는 응용 프로그램 동작에 따라 달라집니다.<br><br>구체적인 사례와 진단되는 오류는 다음 섹션의 코드를 참조하세요.|
| **사례 2**: 대화형 로그인으로 해결 가능하지 않은 오류 | 네트워크 오류 및 일시적/임시 오류 또는 기타 실패의 경우 대화형 AcquireToken 요청을 수행해도 문제가 해결되지 않습니다. 불필요한 대화형 로그인 프롬프트는 최종 사용자에게 불편을 줄 수도 있습니다. AcquireTokenSilent 실패 시 ADAL은 대부분의 오류에 대해 자동으로 다시 시도를 한 번 수행합니다.<br><br>클라이언트 응용 프로그램에서 나중에 다시 시도할 수도 있지만 수행하는 시기와 방법은 응용 프로그램 동작 및 원하는 최종 사용자 경험에 따라 달라집니다. 예를 들어 응용 프로그램은 몇 분 후 또는 일부 최종 사용자 작업에 대한 응답으로 AcquireTokenSilent 다시 시도를 수행할 수 있습니다. 즉시 다시 시도는 응용 프로그램이 제한되는 결과를 가져오므로 수행하지 않아야 합니다.<br><br>후속 다시 시도가 동일한 오류로 실패해도 클라이언트에서 AcquireToken을 사용하여 대화형 요청을 수행해야 한다는 것을 의미하지 않습니다. 오류가 해결되지 않기 때문입니다.<br><br>구체적인 사례와 진단되는 오류는 다음 섹션의 코드를 참조하세요. |

### <a name="net"></a>.NET

다음 지침에서는 ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

- acquireTokenSilentAsync(…)
- acquireTokenSilentSync(…) 
- [사용되지 않음] acquireTokenSilent(…)
- [사용되지 않음] acquireTokenByRefreshToken(…) 

코드는 다음과 같이 구현됩니다.

```csharp
try{
    AcquireTokenSilentAsync(…);
} 

catch (AdalSilentTokenAcquisitionException e) {
    // Exception: AdalSilentTokenAcquisitionException
    // Caused when there are no tokens in the cache or a required refresh failed. 

    // Action: Case 1, resolvable with an interactive request. 
} 

catch(AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Action: Case 2, not resolvable with an interactive request.
    // Attempt retry after a timed interval or user action.
} 
    
catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET. 
    // e.ErrorCode contains the error code. 

    // Action: Case 2, not resolvable with an interactive request.
    // Attempt retry after a timed interval or user action.
    // Example Error: network_not_available, default case.
}
```

### <a name="android"></a>Android

다음 지침에서는 ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

- acquireTokenSilentSync(…)
- acquireTokenSilentAsync(...)
- [사용되지 않음] acquireTokenSilent(…)

코드는 다음과 같이 구현됩니다.

```java
// *Inside callback*
public void onError(Exception e) {

    if (e instanceof AuthenticationException) {
        // Exception: AdalException
        // Represents a library exception generated by ADAL Android.
        // Error Code: e.getCode().

        // Errors: ADALError.ERROR_SILENT_REQUEST,
        // ADALError.AUTH_REFRESH_FAILED_PROMPT_NOT_ALLOWED,
        // ADALError.INVALID_TOKEN_CACHE_ITEM
        // Description: Request failed due to no tokens in
        // cache or failed a required refresh. 

        // Action: Case 1, resolvable with an interactive request. 

        // Action: Case 2, not resolvable with an interactive request.
        // Attempt retry after a timed interval or user action.
        // Example Errors: default case,
        // DEVICE_CONNECTION_IS_NOT_AVAILABLE, 
        // BROKER_AUTHENTICATOR_ERROR_GETAUTHTOKEN,
    }
}
```

### <a name="ios"></a>iOS

다음 지침에서는 ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

- acquireTokenSilentWithResource(…)

코드는 다음과 같이 구현됩니다.

```objc
[context acquireTokenSilentWithResource:[ARGS], completionBlock:^(ADAuthenticationResult *result) {
    if (result.status == AD_FAILED) {
        if ([error.domain isEqualToString:ADAuthenticationErrorDomain]){
            // Exception: AD_FAILED 
            // Represents a library error generated by ADAL Objective-C.
            // Error Code: result.error.code

            // Errors: AD_ERROR_SERVER_REFRESH_TOKEN_REJECTED, AD_ERROR_CACHE_NO_REFRESH_TOKEN
            // Description: No tokens in cache or failed a required token refresh failed. 
            // Action: Case 1, resolvable with an interactive request. 

            // Error: AD_ERROR_CACHE_MULTIPLE_USERS
            // Description: There was ambiguity in the silent request resulting in multiple cache items.
            // Action: Special Case, application should perform another silent request and specify the user using ADUserIdentifier. 
            // Can be caused in cases of a multi-user application. 

            // Action: Case 2, not resolvable with an interactive request.
            // Attempt retry after some time or user action.
            // Example Errors: default case,
            // AD_ERROR_CACHE_BAD_FORMAT
        }
    }
}]
```

## <a name="acquiretoken"></a>AcquireToken

AcquireToken은 토큰을 가져오는 데 사용되는 기본 ADAL 메서드입니다. 사용자 ID가 필요한 경우 AcquireToken은 먼저 토큰을 자동으로 가져오려고 시도한 다음 필요한 경우 UI를 표시합니다(PromptBehavior.Never가 전달되지 않는 경우). 응용 프로그램 ID가 필요한 경우 AcquireToken은 토큰을 가져오려고 시도하지만 최종 사용자가 없으므로 UI를 표시하지 않습니다. 

AcquireToken 오류를 처리하는 경우 응용 프로그램이 달성하려고 하는 시나리오와 플랫폼에 따라 오류 처리가 달라집니다. 

응용 프로그램별로 다른 오류 처리가 필요한 오류 집합이 운영 체제에서 생성될 수도 있습니다. 자세한 내용은 [오류 및 로깅 참조](#error-and-logging-reference)의 “운영 체제 오류”를 참조하세요. 

### <a name="application-scenarios"></a>응용 프로그램 시나리오

- 네이티브 클라이언트 응용 프로그램(iOS, Android, .NET Desktop 또는 Xamarin)
- 리소스 API를 호출하는 웹 응용 프로그램(.NET)
- 단일 페이지 응용 프로그램(JavaScript)
- 서비스 간 응용 프로그램(.NET, Java)
  - On-behalf-of를 포함한 모든 시나리오
  - On-Behalf-of 특정 시나리오

### <a name="error-cases-and-actionable-steps-native-client-applications"></a>오류 사례 및 실행 가능한 단계: 네이티브 클라이언트 응용 프로그램

네이티브 클라이언트 응용 프로그램을 빌드하는 경우 네트워크 문제, 일시적 오류 및 기타 플랫폼별 오류와 관련된 사항을 고려해야 하는 몇 가지 오류 처리 사례가 있습니다. 대부분의 경우 응용 프로그램은 즉시 다시 시도를 수행하지 않고 로그인 메시지를 표시하여 최종 사용자 조작을 기다립니다. 

단일 다시 시도로 문제를 해결할 수 있는 몇 가지 특수 사례가 있습니다. 사용자가 장치에서 데이터를 사용하도록 설정해야 하거나 초기 실패 후 Azure AD Broker 다운로드를 완료한 경우를 예로 들 수 있습니다. 

실패하는 경우 응용 프로그램에서 다시 시도 메시지가 표시되는 조작을 최종 사용자가 수행할 수 있도록 UI를 표시할 수 있습니다. 예를 들어 장치가 오프라인 오류로 실패한 경우 실패를 즉시 다시 시도하지 말고 AcquireToken 다시 시도 메시지를 표시하는 “다시 로그인 시도” 단추를 누릅니다. 

네이티브 응용 프로그램의 오류 처리는 다음 두 가지 사례로 정의될 수 있습니다.

|  |  |
|------|-------------|
| **사례 1**:<br>다시 시도할 수 없는 오류(대부분의 경우) | 1. 즉시 다시 시도하지 마세요. 특정 오류에 따라 다시 시도를 호출하는 최종 사용자 UI를 제시합니다(“다시 로그인 시도”, “Azure AD Broker 응용 프로그램 다운로드” 등). |
| **사례 2**:<br>다시 시도 가능한 오류 | 1. 최종 사용자가 성공하는 상태를 입력했을 수 있으므로 다시 한 번 시도합니다.<br><br>2. 다시 시도가 실패하면 특정 오류에 따라 다시 시도를 호출하는 최종 사용자 UI를 제시합니다(“다시 로그인 시도”, “Azure AD Broker 앱 다운로드” 등). |

> [!IMPORTANT]
> 사용자 계정이 자동 호출로 ADAL로 전달되고 실패하는 경우 후속 대화형 요청을 사용하면 최종 사용자가 다른 계정을 사용하여 로그인할 수 있습니다. 사용자 계정을 사용하여 AcquireToken이 성공적으로 완료되면 응용 프로그램에서 로그인한 사용자가 응용 프로그램의 로컬 사용자 개체와 일치하는지 확인해야 합니다. 불일치해도 예외가 생성되지 않지만(Objective C 제외) 사용자가 인증 요청 전에 로컬에 알려져 있는 경우 불일치가 고려되어야 합니다(예: 실패한 자동 호출).
>

#### <a name="net"></a>.NET

다음 지침에서는 아래 메서드를 *제외한* 모든 비자동 AcquireToken(…) ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

- AcquireTokenAsync(…, IClientAssertionCertification, …)
- AcquireTokenAsync(…,ClientCredential, …)
- AcquireTokenAsync(…,ClientAssertion, …)
- AcquireTokenAsync(…,UserAssertion,…)   

코드는 다음과 같이 구현됩니다.

```csharp
try {
    AcquireTokenAsync(…);
} 
    
catch(AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.
    
    // Design time consideration: Certain errors may be caused at development and exposed through this exception. 
    // Looking inside the description will give more guidance on resolving the specific issue. 

    // Action: Case 1: Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: default case

    } 

catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET.
    // e.ErrorCode contains the error code

    // Action: Case 1, Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: network_not_available, default case
}
```

> [!NOTE]
> ADAL .NET은 AcquireTokenSilent와 같은 동작이 있는 PromptBehavior.Never를 지원하므로 추가 고려 사항이 있습니다.
>

다음 지침에서는 ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

- acquireToken(…, PromptBehavior.Never)

코드는 다음과 같이 구현됩니다.

```csharp
    try {acquireToken(…, PromptBehavior.Never);
    } 

catch(AdalServiceException e) {
    // Exception: AdalServiceException represents 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Action: Case 1: Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: default case

} catch (AdalException e) {
    // Error Code: e.ErrorCode == "user_interaction_required"
    // Description: user_interaction_required indicates the silent request failed 
    // in a way that's resolvable with an interactive request.
    // Action: Resolvable with an interactive request. 

    // Action: Case 1, Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: network_not_available, default case
}
```

#### <a name="android"></a>Android

다음 지침에서는 모든 비자동 AcquireToken(…) ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

코드는 다음과 같이 구현됩니다.

```java
AcquireTokenAsync(…);

// *Inside callback*
public void onError(Exception e) {
    if (e instanceof AuthenticationException) {
        // Exception: AdalException 
        // Represents a library exception generated by ADAL Android.
        // Error Code: e.getCode();

        // Error: ADALError.BROKER_APP_INSTALLATION_STARTED
        // Description: Broker app not installed, user will be prompted to download the app. 

        // Action: Case 2, Retriable Error 
        // Perform a single retry. If that fails, only try again after user action. 

        // Action: Case 1, Non-Retriable 
        // Do not perform an immediate retry. Only retry after user action. 
        // Example Errors: default case, DEVICE_CONNECTION_IS_NOT_AVAILABLE
    }
}
```

#### <a name="ios"></a>iOS

다음 지침에서는 모든 비자동 AcquireToken(…) ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

코드는 다음과 같이 구현됩니다.

```objc
[context acquireTokenWithResource:[ARGS], completionBlock:^(ADAuthenticationResult *result) {
    if (result.status == AD_FAILED) {
        if ([error.domain isEqualToString:ADAuthenticationErrorDomain]){
            // Exception: AD_FAILED 
            // Represents a library error generated by ADAL ObjC.
            // Error Code: result.error.code 

            // Error: AD_ERROR_SERVER_WRONG_USER
            // Description: App passed a user into ADAL and the end user signed in with a different account. 
            // Action: Case 1, Non-retriable (as is) and up to the application on how to handle this case. 
            // It can attempt a new request without specifying the user, or use UI to clarify the user account to sign in. 

            // Action: Case 1, Non-Retriable 
            // Do not perform an immediate retry. Only retry after user action. 
            // Example Errors: default case
        }
    }
}]
```

### <a name="error-cases-and-actionable-steps-web-applications-that-call-a-resource-api-net"></a>오류 사례 및 실행 가능한 단계: 리소스 API를 호출하는 웹 응용 프로그램(.NET)

리소스에 대한 권한 부여 코드를 사용하여 토큰을 호출하는 .NET 웹앱을 빌드하는 경우 필요한 유일한 코드는 일반 사례에 대한 기본 처리기입니다. 

다음 지침에서는 ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

- AcquireTokenByAuthorizationCodeAsync(…)

코드는 다음과 같이 구현됩니다.

```csharp
try {
    AcquireTokenByAuthorizationCodeAsync(…);
} 

catch (AdalException e) {
    // Exception: AdalException
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action or wait until much later. 
    // Example Errors: default case
}
```

### <a name="error-cases-and-actionable-steps-single-page-applications-adaljs"></a>오류 사례 및 실행 가능한 단계: 단일 페이지 응용 프로그램(adal.js)

AcquireToken과 adal.js를 사용하여 단일 페이지 응용 프로그램을 빌드하는 경우 오류 처리 코드는 일반적인 자동 호출 코드와 유사합니다. 특히 adal.js에서는 AcquireToken에서 UI를 표시하지 않습니다. 

실패한 AcquireToken의 사례는 다음과 같습니다.

|  |  |
|------|-------------|
| **사례 1**:<br>대화형 요청으로 해결 가능합니다. | 1. login()이 실패하는 경우 즉시 다시 시도하지 마세요. 사용자 작업 이후 다시 시도에서만 다시 시도 메시지가 표시됩니다.|
| **사례 2**:<br>대화형 요청으로 해결 가능하지 않습니다. 오류가 다시 시도 가능합니다. | 1. 최종 사용자가 성공하는 상태를 입력했을 수 있으므로 다시 한 번 시도합니다.<br><br>2. 다시 시도가 실패하면 특정 오류에 따라 다시 시도를 호출할 수 있는 작업을 최종 사용자에게 제시합니다(“다시 로그인 시도”). |
| **사례 3**:<br>대화형 요청으로 해결 가능하지 않습니다. 오류로 인해 다시 시도할 수 없습니다. | 1. 즉시 다시 시도하지 마세요. 특정 오류에 따라 다시 시도를 호출할 수 있는 작업을 최종 사용자에게 제시합니다(“다시 로그인 시도”). |

코드는 다음과 같이 구현됩니다.

```javascript
AuthContext.acquireToken(…, function(error, errorDesc, token) {
    if (error || errorDesc) {
        // Represents any token acquisition failure that occurred. 
        // Error Code: error.indexOf("<ERROR_STRING>")

        // Errors: if (error.indexOf("interaction_required"))
        //         if (error.indexOf("login required"))
        // Description: ADAL wasn't able to silently acquire a token because of expire or fresh session. 
        // Action: Case 1, Resolvable with an interactive login() request. 

        // Error: if (error.indexOf("Token Renewal Failed")) 
        // Description: Timeout when refreshing the token.
        // Action: Case 2, Not resolvable interactively, error is retriable.
        // Perform a single retry. Only try again after user action.

        // Action: Case 3, Not resolvable interactively, error is not retriable. 
        // Do not perform an immediate retry. Only retry after user action.
        // Example Errors: default case
    }
}
```

### <a name="error-cases-and-actionable-steps-service-to-service-applications-net-only"></a>오류 사례 및 실행 가능한 단계: 서비스 간 응용 프로그램(.NET만 해당)

AcquireToken을 사용하는 서비스 간 응용 프로그램을 빌드하는 경우 코드에서 처리해야 하는 몇 가지 주요 오류가 있습니다. 유일한 오류 해결 방법은 호출 앱으로 오류를 반환하거나(on-behalf-of 사례의 경우) 다시 시도 전략을 적용하는 것입니다. 

#### <a name="all-scenarios"></a>모든 시나리오

On-behalf-of를 포함한 *모든* 서비스 간 응용 프로그램 시나리오의 경우:

- 즉시 다시 시도하지 마세요. ADAL은 실패한 특정 요청에 대해 단일 다시 시도를 합니다. 
- 사용자 또는 앱 작업에서 다시 시도 메시지가 표시된 후에만 다시 시도를 계속합니다. 예를 들어 설정된 간격에서 작동하는 디먼 응용 프로그램은 다음 다시 시도 간격까지 기다려야 합니다.

다음 지침에서는 ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

- AcquireTokenAsync(…, IClientAssertionCertification, …)
- AcquireTokenAsync(…,ClientCredential, …)
- AcquireTokenAsync(…,ClientAssertion, …)
- AcquireTokenAsync(…,UserAssertion, …)

코드는 다음과 같이 구현됩니다.

```csharp
try {
    AcquireTokenAsync(…);
} 

catch (AdalException e) {
    // Exception: AdalException
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action (if applicable) or wait until much later. 
    // Example Errors: default case
}  
```

#### <a name="on-behalf-of-scenarios"></a>On-behalf-of 시나리오

*on-behalf-of* 서비스 간 응용 프로그램 시나리오의 경우입니다.

다음 지침에서는 ADAL 메서드 사용과 관련된 오류 처리 예를 제공합니다. 

- AcquireTokenAsync(…, UserAssertion, …)

코드는 다음과 같이 구현됩니다.

```csharp
try {
AcquireTokenAsync(…);
} 

catch (AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Error: On-Behalf-Of Error Handler
    if (e.ErrorCode == "interaction_required") {
        // Description: The client needs to perform some action due to a config from admin. 
        // Action: Capture `claims` parameter inside ex.InnerException.InnerException.
        // Generate HTTP error 403 with claims, throw back HTTP error to client.
        // Wait for client to retry. 
    }
} 
        
catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action (if applicable) or wait until much later. 
    // Example Error: default case
}
```

이 시나리오를 보여 주는 [전체 샘플](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca)을 작성했습니다.

## <a name="error-and-logging-reference"></a>오류 및 로깅 참조

### <a name="logging-personal-identifiable-information-pii--organizational-identifiable-information-oii"></a>PII(개인 식별이 가능한 정보) 및 OII(조직 식별이 가능한 정보) 로깅
기본적으로 ADAL 로깅은 PII 또는 OII를 캡처하거나 로그하지 않습니다. 라이브러리는 앱 개발자가 로거 클래스의 setter를 통해 이를 켜도록 허용합니다. PII 또는 OII를 켜면 앱은 매우 중요한 데이터를 안전하게 처리하고 모든 규정 준수에 대한 책임을 지게 됩니다.

### <a name="net"></a>.NET

#### <a name="adal-library-errors"></a>ADAL 라이브러리 오류

특정 ADAL 오류를 살펴보려면 [azure-activedirectory-library-for-dotnet 리포지토리](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/8f6d560fbede2247ec0e217a21f6929d4375dcaa/src/ADAL.PCL/Utilities/Constants.cs#L58)의 소스 코드 오류를 참조하는 것이 가장 좋습니다.

#### <a name="guidance-for-error-logging-code"></a>오류 로깅 코드에 대한 지침

ADAL .NET 로깅은 작업 중인 플랫폼에 따라 다릅니다. 로깅을 사용하도록 설정하는 방법에 대한 코드는 [로깅 위키](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/wiki/Logging-in-ADAL.Net)를 참조하세요.

### <a name="android"></a>Android

#### <a name="adal-library-errors"></a>ADAL 라이브러리 오류

특정 ADAL 오류를 살펴보려면 [azure-activedirectory-library-for-android 리포지토리](https://github.com/AzureAD/azure-activedirectory-library-for-android/blob/dev/adal/src/main/java/com/microsoft/aad/adal/ADALError.java#L33)의 소스 코드 오류를 참조하는 것이 가장 좋습니다.

#### <a name="operating-system-errors"></a>운영 체제 오류

Android OS 오류는 ADAL의 AuthenticationException을 통해 공개되며, “SERVER_INVALID_REQUEST”로 식별할 수 있고, 오류 설명을 통해 더 세분화할 수 있습니다. 

일반적인 오류 및 앱이나 최종 사용자가 오류를 발견할 경우 수행할 단계의 전체 목록은 [ADAL Android 위키](https://github.com/AzureAD/azure-activedirectory-library-for-android/wiki)를 참조하세요. 

#### <a name="guidance-for-error-logging-code"></a>오류 로깅 코드에 대한 지침

```java
// 1. Configure Logger
Logger.getInstance().setExternalLogger(new ILogger() {    
    @Override   
    public void Log(String tag, String message, String additionalMessage, LogLevel level, ADALError errorCode) { 
    // …
    // You can write this to logfile depending on level or errorcode. 
    writeToLogFile(getApplicationContext(), tag +":" + message + "-" + additionalMessage);    
    }
}

// 2. Set the log level
Logger.getInstance().setLogLevel(Logger.LogLevel.Verbose);

// By default, the `Logger` does not capture any PII or OII

// PII or OII will be logged
Logger.getInstance().setEnablePII(true);

// To STOP logging PII or OII, use the following setter
Logger.getInstance().setEnablePII(false);


// 3. Send logs to logcat.
adb logcat > "C:\logmsg\logfile.txt";
```

### <a name="ios"></a>iOS

#### <a name="adal-library-errors"></a>ADAL 라이브러리 오류

특정 ADAL 오류를 살펴보려면 [azure-activedirectory-library-for-objc 리포지토리](https://github.com/AzureAD/azure-activedirectory-library-for-objc/blob/dev/ADAL/src/ADAuthenticationError.m#L295)의 소스 코드 오류를 참조하는 것이 가장 좋습니다.

#### <a name="operating-system-errors"></a>운영 체제 오류

사용자가 웹 보기 및 인증 특성을 사용하는 경우 로그인 중에 iOS 오류가 발생할 수 있습니다. SSL 오류, 시간 제한 또는 네트워크 오류와 같은 조건 때문에 발생할 수 있습니다.

- 권리 유형 공유의 경우 로그인이 영구적이지 않으며 캐시가 비어 있는 것으로 나타납니다. 키 집합에 다음 코드 줄을 추가하여 해결할 수 있습니다. `[[ADAuthenticationSettings sharedInstance] setSharedCacheKeychainGroup:nil];`
- NsUrlDomain 오류 집합의 경우 앱 논리에 따라 작업이 달라집니다. 처리할 수 있는 구체적인 인스턴스는 [NSURLErrorDomain 참조 설명서](https://developer.apple.com/documentation/foundation/nsurlerrordomain#declarations)를 참조하세요.
- Objective-C 팀에서 유지관리하는 일반 오류 목록은 [ADAL Obj-C 일반 문제](https://github.com/AzureAD/azure-activedirectory-library-for-objc#adauthenticationerror)를 참조하세요.

#### <a name="guidance-for-error-logging-code"></a>오류 로깅 코드에 대한 지침

```objc
// 1. Enable NSLogging
[ADLogger setNSLogging:YES];

// 2. Set the log level (if you want verbose)
[ADLogger setLevel:ADAL_LOG_LEVEL_VERBOSE];

// 3. Set up a callback block to simply print out
[ADLogger setLogCallBack:^(ADAL_LOG_LEVEL logLevel, NSString *message, NSString *additionalInformation, NSInteger errorCode, NSDictionary *userInfo) {
     NSString* log = [NSString stringWithFormat:@"%@ %@", message, additionalInformation];    
     NSLog(@"%@", log);
}];
```

### <a name="guidance-for-error-logging-code---javascript"></a>오류 로깅 코드에 대한 지침 - JavaScript 

```javascript
0: Error1: Warning2: Info3: Verbose
window.Logging = {
    level: 3,
    log: function (message) {
        console.log(message);
    }
};
```
## <a name="related-content"></a>관련 콘텐츠

* [Azure AD 개발자 가이드][AAD-Dev-Guide]
* [Azure AD 인증 라이브러리][AAD-Auth-Libraries]
* [Azure AD 인증 시나리오][AAD-Auth-Scenarios]
* [Azure Active Directory와 응용 프로그램 통합][AAD-Integrating-Apps]

아래의 의견 섹션을 사용하여 피드백을 제공하고 콘텐츠를 구체화하고 모양을 갖출 수 있습니다.

[![로그인 단추][AAD-Sign-In]][AAD-Sign-In]
<!--Reference style links -->
[AAD-Auth-Libraries]: ./active-directory-authentication-libraries.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AZURE-portal]: https://portal.azure.com

<!--Image references-->
[AAD-Sign-In]:./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png

