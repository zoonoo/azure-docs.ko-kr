---
title: Azure에서 온-프레미스로 Hyper-v VM 재해 복구 중 장애 복구(failback) 실행 | Microsoft Docs
description: Azure Site Recovery 서비스를 사용하여 Azure로 재해 복구 중 Hyper-V VM을 온-프레미스 사이트로 장애 복구(Failback)하는 방법을 알아봅니다.
services: site-recovery
author: rajani-janaki-ram
manager: gauravd
ms.service: site-recovery
ms.topic: article
ms.date: 11/27/2018
ms.author: rajanaki
ms.openlocfilehash: 4030b1905f8d5b50ef6be3ffa61eda74d8a27951
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/23/2019
ms.locfileid: "60552419"
---
# <a name="run-a-failback-for-hyper-v-vms"></a>Hyper-V VM에 대한 장애 복구(failback) 실행

이 문서에서는 Site Recovery에서 보호하는 Hyper-V 가상 머신을 장애 복구(failback)하는 방법에 대해 설명합니다.

## <a name="prerequisites"></a>필수 조건
1. [다양한 장애 복구(failback) 유형](concepts-types-of-failback.md) 및 해당 주의 사항에 대한 세부 정보를 읽어야 합니다.
1. 기본 사이트 VMM 서버 또는 Hyper-V 호스트 서버가 Azure에 연결되어 있어야 합니다.
2. 가상 머신에서 **커밋**을 수행해야 합니다.

## <a name="perform-failback"></a>장애 복구(failback) 수행
기본 위치에서 보조 위치로 장애 조치한 후에는 Site Recovery에서 복제된 가상 머신을 보호하지 않으며 보조 위치가 현재 활성 위치로 작동합니다. 복구 계획에서 VM을 장애 복구(failback)하려면 다음과 같이 계획된 장애 조치(failover)를 보조 사이트에서 기본 사이트까지 실행합니다. 
1. **복구 계획** > *recoveryplan_name*을 선택합니다. **장애 조치(Failover)** > **Planned 장애 조치(Failover)** 에서 의견이나 질문을 게시합니다.
2. **계획된 장애 조치(failover) 확인** 페이지에서 원본 및 대상 위치를 선택합니다. 장애 조치 방향을 유의하십시오. 기본으로부터 장애 조치가 예상대로 작동하고 모든 가상 머신이 보조 위치에 있다면 이것은 정보 제공용입니다.
3. Azure로부터 장애 복구하는 경우 **데이터 동기화**:에서 설정을 선택합니다.
    - **장애 조치(failover) 전 데이터 동기화(델타 변경 내용만 동기화)** - 가상 머신을 종료하지 않고 동기화할 때 가상 머신의 가동 중지 시간을 최소화하는 옵션입니다. 다음 단계를 수행합니다.
        - 1단계: Azure에서 가상 머신의 스냅숏을 찍고 온-프레미스 Hyper-V 호스트에 복사합니다. 컴퓨터가 Azure에서 계속 실행됩니다.
        - 2단계: 새로운 변경 사항이 발생할 수 있도록 Azure에서 가상 머신을 종료합니다. 최종 델타 변경 집합을 온-프레미스 서버로 보내고, 온-프레미스 가상 머신을 시작합니다.

    - **장애 조치(failover) 중에만 데이터 동기화(전체 다운로드)**. 이 옵션은 속도가 더 빠릅니다.
        - 대부분의 디스크가 변경되고 체크섬 계산에 시간을 소모하지 않으므로 이 옵션이 더 빠릅니다. 디스크의 다운로드를 수행합니다. 온-프레미스 가상 머신이 삭제되었을 때도 유용합니다.
        - Azure를 한 달 이상 실행했거나 온-프레미스 가상 머신을 삭제한 경우 이 옵션을 사용하는 것이 좋습니다. 이 옵션은 체크섬 계산을 수행하지 않습니다.


4. 클라우드에 대해 데이터 암호화를 사용하는 경우 VMM 서버에 공급자를 설치하는 중에 데이터 암호화를 사용하도록 설정할 때 발행된 인증서를 **암호화 키**에서 선택합니다.
5. 장애 조치를 시작합니다. **작업** 탭에서 장애 조치 진행 상황을 따를 수 있습니다.
6. 장애 조치(failover) 이전에 데이터를 동기화하는 옵션을 선택한 경우 초기 데이터 동기화를 완료하고 Azure에서 가상 머신을 종료할 준비가 되었을 때 **작업** > 작업 이름 > **장애 조치(failover) 완료**를 차례로 클릭합니다. 그러면 Azure 컴퓨터가 종료되고, 온-프레미스 가상 머신으로 최신 변경 내용이 전송되며, 온-프레미스 VM이 시작됩니다.
7. 이제 가상 머신에 로그인하여 예상대로 사용 가능한지 확인할 수 있습니다.
8. 가상 머신이 커밋 보류 상태입니다. **커밋** 을 클릭하여 장애 조치를 커밋합니다.
9. 장애 복구(failback)를 완료하려면 **역방향 복제**를 클릭하여 기본 사이트의 가상 머신 보호를 시작합니다.


이들 절차를 따라 원래 기본 사이트로 장애 복구합니다. 이 절차는 복구 계획에 대해 계획된 장애 조치를 실행하는 방법을 설명합니다. 또는 **Virtual Machines** 탭에서 단일 Virtual Machines에 대한 장애 조치를 실행할 수 있습니다.


## <a name="failback-to-an-alternate-location-in-hyper-v-environment"></a>Hyper-V 환경에서 대체 위치로 장애 복구(failback)
[Hyper-V 사이트와 Azure](site-recovery-hyper-v-site-to-azure.md) 사이에서 보호를 배포했다면 Azure로부터 대체 온-프레미스 위치로 장애 복구할 수 있습니다. 이것은 새 온-프레미스 하드웨어를 설정해야 하는 경우 유용합니다. 그 방법은 다음과 같습니다.

1. 새 하드웨어를 설정하는 경우 서버에서 Windows Server 2012 R2 및 Hyper-V역할을 설치 합니다.
2. 원본 서버에 있던 동일한 이름의 가상 네트워크 스위치를 만듭니다.
3. 선택 **보호 된 항목** -> **보호 그룹** -> \<보호 >-> \<VirtualMachineName > 장애 복구 하려면 선택한 **계획 된 장애 조치**합니다.
4. **계획된 장애 조치 확인** select **존재하지 않는 경우 온-프레미스 가상 머신 만들기**에서 의견이나 질문을 게시합니다.
5. 호스트 이름**에서 가상 머신을 배치하려는 새 Hyper-V 호스트 서버를 선택합니다.
6. 데이터 동기화에서 장애 조치(failover) 전에 데이터 동기화 옵션을 선택하는 것이 좋습니다. 이 옵션은 가상 머신을 종료하지 않고 동기화하므로 가상 머신에 대한 가동 중지 시간을 최소화합니다. 이 에이전트는 다음을 수행합니다.

    - 1단계: Azure에서 가상 머신의 스냅숏을 찍고 온-프레미스 Hyper-V 호스트에 복사합니다. 컴퓨터가 Azure에서 계속 실행됩니다.
    - 2단계: 새로운 변경 사항이 발생할 수 있도록 Azure에서 가상 머신을 종료합니다. 최종 변경 집합이 온-프레미스 서버로 전송되면 온-프레미스 가상 머신이 시작됩니다.
    
7. 확인 표시를 클릭하여 장애 조치(장애 복구)를 시작합니다.
8. 초기 동기화가 완료 된 후 Azure에서 가상 머신을 종료 하려면 클릭 준비가 **작업** > \<계획 된 장애 조치 작업이 >> **완전 한 장애 조치** . 그러면 Azure 컴퓨터가 종료되고 마지막 변경 내용이 온-프레미스 가상 컴퓨터에 전송된 다음 시작됩니다.
9. 온-프레미스 가상 머신에 로그인하여 모든 것이 예상대로 작동되는지 확인할 수 있습니다. 그 다음 **커밋** 을 클릭하여 장애 조치를 완료합니다. 커밋은 Azure 가상 머신과 해당 디스크를 삭제하고 VM을 다시 보호할 수 있도록 준비합니다.
10. **역방향 복제** 를 클릭하여 온-프레미스 가상 머신의 보호를 시작합니다.

    > [!NOTE]
    > 데이터 동기화 단계 중에 장애 복구 작업을 취소하면 온-프레미스 VM이 손상됩니다. 이는 데이터 동기화가 Azure VM 디스크에서 온-프레미스 데이터 디스크로 최신 데이터를 복사하고, 동기화를 완료할 때까지 디스크 데이터가 일관되지 않을 수 있기 때문입니다. 데이터 동기화를 취소한 후 온-프레미스 VM이 부팅되면 부팅되지 않을 수 있습니다. 장애 조치(failover)를 다시 트리거하여 데이터 동기화를 완료합니다.


## <a name="why-is-there-no-button-called-failback"></a>장애 복구라는 단추가 없는 이유는 무엇입니까?
포털에는 장애 복구라는 명시적인 제스처가 없습니다. 장애 복구는 기본 사이트로 다시 돌아오는 단계입니다. 기본적으로 장애 복구(failback)는 가상 머신을 복구에서 기본 사이트로 다시 장애 조치(failover)하는 경우입니다.

장애 조치(failover)를 시작하면 블레이드에서 가상 머신 이동 방향을 알려줍니다. Azure에서 온-프레미스로의 방향인 경우 장애 복구(failback)입니다.

## <a name="why-is-there-only-a-planned-failover-gesture-to-failback"></a>장애 조치에 계획된 장애 조치 제스처만 있는 이유는 무엇입니까?
Azure는 항상 사용 가능한 환경이며 가상 머신을 항상 사용할 수 있습니다. 장애 복구는 온-프레미스에서 워크로드를 다시 실행할 수 있도록 짧은 가동 중지를 수행하도록 결정한 계획된 작업입니다. 이 경우 데이터 손실이 없어야 합니다. 따라서 Azure에서 VM을 해제하고, 최신 변경 내용을 다운로드하고, 데이터 손실이 없는지 확인하는 계획된 장애 조치 제스처만 사용할 수 있습니다.

## <a name="do-i-need-a-process-server-in-azure-to-failback-to-hyper-v"></a>Hyper-v에 장애 복구하기 위해 Azure에서 프로세스 서버가 필요한가요?
아니요, VMware 가상 머신을 보호하는 경우에만 프로세스 서버가 필요합니다. Hyper-V 가상 머신을 보호/장애 복구할 때 배포되어야 하는 추가 구성 요소가 없습니다.


## <a name="time-taken-to-failback"></a>장애 복구 소요 시간
데이터 동기화를 완료하고 가상 머신을 부팅하는 데 걸린 시간은 다양한 요인에 따라 달라집니다. 소요 시간에 대한 정보를 알아보기 위해 데이터 동기화 중 진행 상황을 설명하겠습니다.

데이터 동기화는 가상 머신 디스크의 스냅숏을 만들고 블록 단위로 검사를 시작하여 해당 체크섬을 계산합니다. 이 계산된 체크섬은 온-프레미스로 전송되어 동일한 블록의 온-프레미스 체크섬과 비교합니다. 체크섬이 일치하는 경우에 데이터 블록이 전송되지 않습니다. 일치하지 않는 경우 데이터 블록이 온-프레미스로 전송됩니다. 이 전송 시간은 사용 가능한 대역폭에 따라 달라집니다. 체크섬의 속도는 분당 GB로 측정됩니다. 

데이터의 다운로드 속도를 높이려면 다운로드를 직렬화하기 위해 더 많은 스레드를 사용하도록 MARS 에이전트를 구성할 수 있습니다. 에이전트에서 다운로드 스레드를 변경하는 방법은 [여기 문서](https://support.microsoft.com/en-us/help/3056159/how-to-manage-on-premises-to-azure-protection-network-bandwidth-usage)를 참조합니다.


## <a name="next-steps"></a>다음 단계

**커밋** 후에는 *역방향 복제*를 시작할 수 있습니다. 그러면 가상 머신이 온-프레미스에서 Azure로 다시 보호되기 시작합니다. 이 경우 VM이 Azure에서 해제되어 차별적인 변경 내용만 보내기 때문에 변경 내용만 복제합니다.
